<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>JumpSam with Limited Running Energy</title>
    <link rel="stylesheet" href="../../build/css/live-editor.core_deps.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.audio.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.tooltips.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.ui.css"/>
<style>
        body {
            padding: 20px;
        }
        h1 {
            padding: 0;
            margin: 0 0 20px 0;
        }
        #sample-live-editor {
            padding: 0;
        }
    </style>
</head>
<body>
    <h1>JumpSam with Limited Running Energy</h1>
    <div id="sample-live-editor"></div>
    <script src="../../build/js/live-editor.core_deps.js"></script>
    <script src="../../build/js/live-editor.editor_ace_deps.js"></script>
    <script src="../../build/js/live-editor.audio.js"></script>
    <script src="../../build/js/live-editor.shared.js"></script>
    <script src="../../build/js/live-editor.tooltips.js"></script>
    <script src="../../build/js/live-editor.ui.js"></script>
    <script src="../../build/js/live-editor.editor_ace.js"></script>
    <script>
    var outputUrl = "../output.html";
var code = "/**JumpSam with Limited Running Energy by David Elijah de Siqueira Campos McLaughlin\nOriginal size(400, 400);\nOriginally Created on 2013-04-07T21:18:07Z by kaid_976851263300560061760577\nLast Edited: 2013-04-07T21:18:07Z\nVotes/Spinoffs: 4/2\nOriginally Created: 2013-04-08T00:14:32Z from origin 1022766604 with similarity of 0.9962568426215084\nOriginal Link: https://www.khanacademy.org/computer-programming/jumpsam-with-limited-running-energy/1526601408\nRetrieved On: 07-Nov-2022 (17:06:52.549403)**/\
";

code = code + "\n/***********************************************************\n * As you can see, this is now the highest voted jumpgirl\n * spin-off. However, spin-offs are not calculated by\n * votes, but by page views, so it still is only the fifth\n * highest spin off.\n * If you want to help this program, you can share it on\n * facebook, twitter or E-mail.\n * Thank you in advance!\n * \n * Thank you to everyone who voted this up, making it the\n * second highest-voted Jumpgirl spin-off!\n * \n * If you make a game based off of mine, please give me\n * credit.\n * \n * I HAVE WORKED ON THIS GAME FOR COUNTLESS HOURS, SO PLEASE,\n * DO NOT VOTE THIS DOWN WITHOUT SAYING WHY.\n * \n * ~Controls~\n * Movement: WAD\n * Run: S\n * Pause: P\n * Talk to NPC: Space\n ***********************************************************/\nvar energy = 100;\nvar level = 1;\nvar weaponDurability = 1;\nvar TILE_HEIGHT = 40;\nvar TILE_WIDTH = 100;\nvar GRAVITY = 2;\nvar health = 12;\nvar ingame = false;\nvar menu = \'m\';\nvar FONT = createFont(\"verdana\", 20);\nvar mouseState = 0;\nvar oldMouse = mouseState;\nvar gameStarted = false;\nvar overButton;\nvar whichButton;\nvar whichButtonMetadata;\nvar buttonFill;\nvar putInYet;\nvar itemEquipped = false;\nvar ENEMY_VELOCITY = 2;\nvar itemIdEquipped = -1;\nvar win = false;\nvar won = false;\nvar bg = createGraphics(400, 400, JAVA2D);\nvar swordIm = createGraphics(32, 32, JAVA2D);\nvar clubIm = createGraphics(32, 32, JAVA2D);\nvar daggerIm = createGraphics(32, 32, JAVA2D);\nvar bowIm = createGraphics(32, 32, JAVA2D);\nvar arrowIm = createGraphics(64, 16, JAVA2D);\nvar dudeIm = createGraphics(42, 69, JAVA2D);\nvar initialized = false;\nvar currentNPC = false;\nvar equippedItemLocation = -1;\nvar arrowFrameFiredAgo = 100;\nvar coins = 0;\nvar oldCoins = 0;\nvar heroMouseDiffX;\nvar heroMouseDiffY;\nvar time = 0;\nvar inventory = [3, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n\nvar invMetadata = [1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n\nvar popups = [];\n\nvar stats = {\n    kills: 0,\n    coins: 0,\n    spent: 0\n};\n\nvar sword = {\n    id: 1,\n    durability: 8,\n    damage: 5,\n    type: \"weapon\",\n    cost: 10\n};\n\nvar club = {\n    id: 2,\n    durability: 12,\n    damage: 8,\n    type: \"weapon\",\n    cost: 13\n};\n\nvar dagger = {\n    id: 3,\n    durability: 1,\n    damage: 6,\n    type: \"weapon\",\n    cost: 2\n};\n\nvar bow = {\n    id: 4,\n    durability: 10,\n    damage: 6,\n    type: \"ranged\",\n    cost: 15\n};\n\nvar itemForId = [0, sword, club, dagger, bow];\n\nvar initialize = function()\n{\n    //player image\n    var DUDE_IMAGE_ARRAY = [\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(73,53,6,255),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(44,102,35,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(44,102,35,255),color(16,35,13,255),color(73,53,6,255),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(16,35,13,255),color(44,102,35,255),color(67,152,54,255),color(44,102,35,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(16,35,13,255),color(16,35,13,255),color(237,182,17,255),color(254,215,97,255),color(73,53,6,255),color(74,0,154,0)],\n[color(74,0,154,0),color(16,35,13,255),color(67,152,54,255),color(44,102,35,255),color(16,35,13,255),color(53,119,42,255),color(67,152,54,255),color(16,35,13,255),color(237,182,17,255),color(237,182,17,255),color(237,182,17,255),color(237,182,17,255),color(73,53,6,255),color(74,0,154,0)],\n[color(74,0,154,0),color(16,35,13,255),color(67,152,54,255),color(16,35,13,255),color(44,102,35,255),color(53,119,42,255),color(16,35,13,255),color(237,182,17,255),color(73,53,6,255),color(73,53,6,255),color(73,53,6,255),color(237,182,17,255),color(222,219,209,255),color(73,53,6,255)],\n[color(16,35,13,255),color(44,102,35,255),color(44,102,35,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(124,55,40,255),color(73,53,6,255),color(235,147,136,255),color(235,147,136,255),color(235,147,136,255),color(73,53,6,255),color(73,53,6,255),color(74,0,154,0)],\n[color(16,35,13,255),color(44,102,35,255),color(16,35,13,255),color(16,35,13,255),color(254,215,97,255),color(124,55,40,255),color(235,147,136,255),color(73,53,6,255),color(222,219,209,255),color(1,0,179,255),color(235,147,136,255),color(50,31,29,255),color(74,0,154,0),color(74,0,154,0)],\n[color(16,35,13,255),color(16,35,13,255),color(74,0,154,0),color(16,35,13,255),color(16,35,13,255),color(237,182,17,255),color(235,147,136,255),color(235,147,136,255),color(222,219,209,255),color(1,0,179,255),color(235,147,136,255),color(50,31,29,255),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(16,35,13,255),color(183,127,120,255),color(235,147,136,255),color(235,147,136,255),color(235,147,136,255),color(235,147,136,255),color(235,147,136,255),color(50,31,29,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(53,119,42,255),color(119,179,59,255),color(50,31,29,255),color(183,127,120,255),color(235,147,136,255),color(235,147,136,255),color(235,147,136,255),color(50,31,29,255),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(53,119,42,255),color(119,179,59,255),color(67,152,54,255),color(119,179,59,255),color(50,31,29,255),color(50,31,29,255),color(50,31,29,255),color(50,31,29,255),color(119,179,59,255),color(16,35,13,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(53,119,42,255),color(119,179,59,255),color(16,35,13,255),color(67,152,54,255),color(119,179,59,255),color(119,179,59,255),color(119,179,59,255),color(119,179,59,255),color(67,152,54,255),color(16,35,13,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(53,119,42,255),color(119,179,59,255),color(16,35,13,255),color(53,119,42,255),color(53,119,42,255),color(53,119,42,255),color(67,152,54,255),color(53,119,42,255),color(67,152,54,255),color(16,35,13,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(53,119,42,255),color(119,179,59,255),color(16,35,13,255),color(53,119,42,255),color(53,119,42,255),color(67,152,54,255),color(53,119,42,255),color(67,152,54,255),color(16,35,13,255),color(16,35,13,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(50,31,29,255),color(124,55,40,255),color(124,55,40,255),color(183,127,120,255),color(50,31,29,255),color(53,119,42,255),color(53,119,42,255),color(53,119,42,255),color(53,119,42,255),color(50,31,29,255),color(183,127,120,255),color(50,31,29,255)],\n[color(74,0,154,0),color(74,0,154,0),color(50,31,29,255),color(235,147,136,255),color(235,147,136,255),color(183,127,120,255),color(50,31,29,255),color(73,53,6,255),color(73,53,6,255),color(237,182,17,255),color(73,53,6,255),color(50,31,29,255),color(183,127,120,255),color(50,31,29,255)],\n[color(74,0,154,0),color(74,0,154,0),color(50,31,29,255),color(235,147,136,255),color(235,147,136,255),color(183,127,120,255),color(50,31,29,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(50,31,29,255),color(183,127,120,255),color(50,31,29,255)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(50,31,29,255),color(50,31,29,255),color(50,31,29,255),color(67,152,54,255),color(67,152,54,255),color(67,152,54,255),color(53,119,42,255),color(67,152,54,255),color(16,35,13,255),color(50,31,29,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(53,119,42,255),color(53,119,42,255),color(53,119,42,255),color(16,35,13,255),color(53,119,42,255),color(16,35,13,255),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(183,127,120,255),color(222,219,209,255),color(222,219,209,255),color(222,219,209,255),color(16,35,13,255),color(222,219,209,255),color(16,35,13,255),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(183,127,120,255),color(222,219,209,255),color(222,219,209,255),color(124,55,40,255),color(16,35,13,255),color(124,55,40,255),color(16,35,13,255),color(74,0,154,0),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(124,55,40,255),color(124,55,40,255),color(124,55,40,255),color(124,55,40,255),color(124,55,40,255),color(16,35,13,255),color(124,55,40,255),color(16,35,13,255),color(74,0,154,0)],\n[color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(74,0,154,0),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(16,35,13,255),color(74,0,154,0)]\n];\ndudeIm.beginDraw();\ndudeIm.background(0, 0, 0, 0);\nfor(var i = 0; i < 23; i++)\n{\n    for(var j = 0; j < 14; j++)\n    {\n        dudeIm.noStroke();\n        dudeIm.fill(DUDE_IMAGE_ARRAY[i][j]);\n        dudeIm.rect(j * 3, i * 3, 3, 3);\n    }\n}\ndudeIm.endDraw();\n    //background\n    bg.beginDraw();\n    bg.background(100, 205, 255);\n    strokeWeight(1);\n    for(var k = 0; k < 400; k++)\n    {\n        bg.stroke(lerpColor(color(100, 205, 255), color(0, 108, 158), 1 / i));\n        bg.line(0, i, 400, i);\n    }\n    bg.fill(255, 255, 0);\n    bg.endDraw();\n    \n    //weapons\n    //sword\n    swordIm.beginDraw();\n    swordIm.noStroke();\n    swordIm.background(134, 204, 106);\n    swordIm.fill(128, 128, 128);\n    swordIm.triangle(0, 0, 24, 28, 28, 24);\n    swordIm.strokeWeight(4);\n    swordIm.stroke(128, 76, 40);\n    swordIm.line(25, 25, 31, 31);\n    swordIm.line(19, 28, 28, 19);\n    swordIm.endDraw();\n    //club\n    clubIm.beginDraw();\n    clubIm.background(134, 204, 106);\n    clubIm.stroke(128, 76, 40);\n    clubIm.strokeWeight(5);\n    clubIm.line(10, 10, 29, 29);\n    clubIm.strokeWeight(7);\n    clubIm.line(10, 10, 21, 21);\n    clubIm.strokeWeight(12);\n    clubIm.line(10, 10, 14, 14);\n    clubIm.endDraw();\n    //dagger\n    daggerIm.beginDraw();\n    daggerIm.noStroke();\n    daggerIm.background(134, 204, 106);\n    daggerIm.fill(128, 128, 128);\n    daggerIm.triangle(5, 27, 18, 10, 22, 14);\n    daggerIm.strokeWeight(3);\n    daggerIm.stroke(128, 76, 40);\n    daggerIm.line(20, 12, 26, 6);\n    daggerIm.line(14, 9, 23, 18);\n    daggerIm.endDraw();\n    //bow\n    bowIm.beginDraw();\n    bowIm.noFill();\n    bowIm.background(134, 204, 106);\n    bowIm.stroke(247, 247, 247);\n    bowIm.line(4, 28, 28, 4);\n    bowIm.strokeWeight(3);\n    bowIm.stroke(128, 76, 40);\n    bowIm.bezier(4, 28, 6, 12, 12, 6, 28, 4);\n    bowIm.endDraw();\n    //arrow\n    arrowIm.beginDraw();\n    arrowIm.background(0, 0);\n    arrowIm.strokeWeight(2);\n    arrowIm.stroke(247, 247, 247);\n    arrowIm.noFill();\n    arrowIm.bezier(4, 5.7, 16, 6, 16, 10, 4, 10.3);\n    arrowIm.strokeWeight(2);\n    arrowIm.stroke(128, 76, 40);\n    arrowIm.line(2, 8, 60, 8);\n    arrowIm.noStroke();\n    arrowIm.fill(128, 128, 128);\n    arrowIm.triangle(56, 4, 64, 8, 56, 12);\n    arrowIm.endDraw();\n    \n    initialized = true;\n};\n\nvar resetInGame = function()\n{\n    strokeWeight(1);\n    whichButton = 0;\n    textAlign(CENTER, BASELINE);\n    oldCoins = coins;\n};\n\nvar block = {\n    air:{\n        image: getImage(\"cute/Blank\"),\n        color: color(0, 0, 0, 0),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 0\n    },\n    brownBlock:{\n        image: getImage(\"cute/BrownBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 1\n    },\n    chestClosed:{\n        image: getImage(\"cute/ChestClosed\"),\n        color: color(255, 255, 0),\n        height: 1.2,\n        isSolid: true,\n        isPowerup: true,\n        id: 2\n    },\n    chestLid:{\n        image: getImage(\"cute/ChestLid\"),\n        color: color(0, 0, 0),\n        height: 0.2,\n        isSolid: true,\n        isPowerup: false,\n        id: 3\n    },\n    chestOpen:{\n        image: getImage(\"cute/ChestOpen\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 4\n    },\n    dirt:{\n        image: getImage(\"cute/DirtBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 5\n    },\n    doorClosed:{\n        image: getImage(\"cute/DoorTallClosed\"),\n        color: color(255, 0, 255),\n        height: 2,\n        isSolid: true,\n        isPowerup: false,\n        id: 6\n    },\n    doorOpen:{\n        image: getImage(\"cute/DoorTallOpen\"),\n        color: color(255, 222, 255),\n        height: 2,\n        isSolid: false,\n        isPowerup: false,\n        id: 7\n    },\n    grass:{\n        image: getImage(\"cute/GrassBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 8\n    },\n    grayBlock:{\n        image: getImage(\"cute/PlainBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 9\n    },\n    rampEast:{\n        image: getImage(\"cute/RampEast\"),\n        color: color(26, 26, 26),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 10\n    },\n    rampNorth:{\n        image: getImage(\"cute/RampNorth\"),\n        color: color(26, 26, 26),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 11\n    },\n    rampSouth:{\n        image: getImage(\"cute/RampSouth\"),\n        color: color(26, 26, 26),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 12\n    },\n    rampWest:{\n        image: getImage(\"cute/RampWest\"),\n        color: color(26, 26, 26),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 13\n    },\n    rock:{\n        image: getImage(\"cute/Rock\"),\n        color: color(128, 128, 128),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 14\n    },\n    roofEast:{\n        image: getImage(\"cute/RoofEast\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 15\n    },\n    roofNorth:{\n        image: getImage(\"cute/RoofNorth\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 16\n    },\n    roofNortheast:{\n        image: getImage(\"cute/RoofNorthEast\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 17\n    },\n    roofNorthwest:{\n        image: getImage(\"cute/RoofNorthWest\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 18\n    },\n    roofSouth:{\n        image: getImage(\"cute/RoofSouth\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 19\n    },\n    roofSoutheast:{\n        image: getImage(\"cute/RoofSouthEast\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 20\n    },\n    roofSouthwest:{\n        image: getImage(\"cute/RoofSouthWest\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 21\n    },\n    roofWest:{\n        image: getImage(\"cute/RoofWest\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 22\n    },\n    shadowEast:{\n        image: getImage(\"cute/ShadowEast\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 23\n    },\n    shadowNorth:{\n        image: getImage(\"cute/ShadowNorth\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 24\n    },\n    shadowNortheast:{\n        image: getImage(\"cute/ShadowNorthEast\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 25\n    },\n    shadowNorthwest:{\n        image: getImage(\"cute/ShadowNorthWest\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 26\n    },\n    shadowSideWest:{\n        image: getImage(\"cute/ShadowSideWest\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 27\n    },\n    shadowSouth:{\n        image: getImage(\"cute/ShadowSouth\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 28\n    },\n    shadowSoutheast:{\n        image: getImage(\"cute/ShadowSouthEast\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 29\n    },\n    shadowSouthwest:{\n        image: getImage(\"cute/ShadowSouthWest\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 30\n    },\n    shadowWest:{\n        image: getImage(\"cute/ShadowWest\"),\n        color: color(255, 255, 255),\n        height: 0,\n        isSolid: false,\n        isPowerup: false,\n        id: 31\n    },\n    stone:{\n        image: getImage(\"cute/StoneBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 32\n    },\n    stoneTall:{\n        image: getImage(\"cute/StoneBlockTall\"),\n        color: color(0, 0, 0),\n        height: 2,\n        isSolid: true,\n        isPowerup: false,\n        id: 33\n    },\n    bush:{\n        image: getImage(\"cute/TreeShort\"),\n        color: color(52, 184, 40),\n        height: 1,\n        isSolid: false,\n        isPowerup: false,\n        id: 34\n    },\n    tree:{\n        image: getImage(\"cute/TreeTall\"),\n        color: color(52, 184, 40),\n        height: 1,\n        isSolid: false,\n        isPowerup: false,\n        id: 35\n    },\n    bush2:{\n        image: getImage(\"cute/TreeUgly\"),\n        color: color(52, 184, 40),\n        height: 1,\n        isSolid: false,\n        isPowerup: false,\n        id: 36\n    },\n    wall:{\n        image: getImage(\"cute/WallBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 37\n    },\n    wallTall:{\n        image: getImage(\"cute/WallBlockTall\"),\n        color: color(0, 0, 0),\n        height: 2,\n        isSolid: true,\n        isPowerup: false,\n        id: 38\n    },\n    water:{\n        image: getImage(\"cute/WaterBlock\"),\n        color: color(0, 0, 255),\n        height: 1,\n        isSolid: false,\n        isPowerup: false,\n        id: 39\n    },\n    window:{\n        image: getImage(\"cute/WindowTall\"),\n        color: color(72, 131, 133),\n        height: 2,\n        isSolid: true,\n        isPowerup: false,\n        id: 40\n    },\n    wood:{\n        image: getImage(\"cute/WoodBlock\"),\n        color: color(0, 0, 0),\n        height: 1,\n        isSolid: true,\n        isPowerup: false,\n        id: 41\n    }\n};\n   \nvar tileForId = [block.air, block.brownBlock, block.chestClosed, block.chestLid, block.chestOpen, block.dirt, block.doorClosed, block.doorOpen, block.grass, block.grayBlock, block.rampEast, block.rampNorth, block.rampSouth, block.rampWest, block.rock, block.roofEast, block.roofNorth, block.roofNortheast, block.roofNorthwest, block.roofSouth, block.roofSoutheast, block.roofSouthwest, block.roofWest, block.shadowEast, block.shadowNorth, block.shadowNortheast, block.shadowNorthwest, block.shadowSideWest, block.shadowSouth, block.shadowSoutheast, block.shadowSouthwest, block.shadowWest, block.stone, block.stoneTall, block.bush, block.tree, block.bush2, block.wall, block.wallTall, block.water, block.window, block.wood];\n\nvar SCREEN_ROWS = 17;\nvar SCREEN_COLS = 8;\n/*\n    1: getImage(\"cute/BrownBlock\"),\n    2: getImage(\"cute/ChestClosed\"),\n    3: getImage(\"cute/ChestLid\"),\n    4: getImage(\"cute/ChestOpen\"),\n    5: getImage(\"cute/DirtBlock\"),\n    6: getImage(\"cute/DoorTallClosed\"),\n    7: getImage(\"cute/DoorTallOpen\"),\n    8: getImage(\"cute/GrassBlock\"),\n    9: getImage(\"cute/PlainBlock\"),\n    10: getImage(\"cute/RampEast\"),\n    11: getImage(\"cute/RampNorth\"),\n    12: getImage(\"cute/RampSouth\"),\n    13: getImage(\"cute/RampWest\"),\n    14: getImage(\"cute/Rock\"),\n    15: getImage(\"cute/RoofEast\"),\n    16: getImage(\"cute/RoofNorth\"),\n    17: getImage(\"cute/RoofNorthEast\"),\n    18: getImage(\"cute/RoofNorthWest\"),\n    19: getImage(\"cute/RoofSouth\"),\n    20: getImage(\"cute/RoofSouthEast\"),\n    21: getImage(\"cute/RoofSouthWest\"),\n    22: getImage(\"cute/RoofWest\"),\n    23: getImage(\"cute/ShadowEast\"),\n    24: getImage(\"cute/ShadowNorth\"),\n    25: getImage(\"cute/ShadowNorthEast\"),\n    26: getImage(\"cute/ShadowNorthWest\"),\n    27: getImage(\"cute/ShadowSideWest\"),\n    28: getImage(\"cute/ShadowSouth\"),\n    29: getImage(\"cute/ShadowSouthEast\"),\n    30: getImage(\"cute/ShadowSouthWest\"),\n    31: getImage(\"cute/ShadowWest\"),\n    32: getImage(\"cute/StoneBlock\"),\n    33: getImage(\"cute/StoneBlockTall\"),\n    34: getImage(\"cute/TreeShort\"),\n    35: getImage(\"cute/TreeTall\"),\n    36: getImage(\"cute/TreeUgly\"),\n    37: getImage(\"cute/WallBlock\"),\n    38: getImage(\"cute/WallBlockTall\"),\n    39: getImage(\"cute/WaterBlock\"),\n    40: getImage(\"cute/WindowTall\"),\n    41: getImage(\"cute/WoodBlock\")\n*/\nvar TILE_MAP = [\n[0,0,0,0,0,0,2,0,0,0,0,21,19,19,19,0,19,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,41,0,0,0,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,33,0,0,0,0,0,0,0,0,0,41,0,0,0,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,41,0,0,23,41,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0, 0, 0, 0, 0, 0, 0, 0, 0, 41, 0, 2, 41, 41, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n[0,0,0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 41, 0, 0, 0, 41, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n[0,0, 0, 0, 0, 23, 8, 0, 0, 35, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n[0,0,0,0, 23, 8, 5, 39, 39, 8, 14, 0, 6, 0, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n[8, 8, 8, 8, 8, 5, 5, 5, 5, 5, 8, 8, 8, 8, 8, 8, 8, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32]\n];\nvar TILE_MAP_ROWS = TILE_MAP.length;\nvar TILE_MAP_COLS = TILE_MAP[0].length;\n\nvar tileMetadata = [\n[0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]\n];\n\n// enemies\nvar ENEMY_MAP = [\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 2, 0, 0, 0, 3, 3, 0, 0, 0, 0, 0, 0, 3, 0, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 2, 2, 2, 0, 0, 2, 0, 0, 0, 2, 2],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n];\n\nvar NPC_MAP = [\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n\n[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n];\n// tile access\n// -----------\nvar tileIsTall = function(tile)\n{\n    return tile === 2 && tile === 6 && tile === 7 && tile === 33 && tile === 35 && tile === 38 && tile === 40;\n};\n\n// turns some point (x, y) into the (tX, tY) covering that point\nvar tileCoordsForPoint = function(x, y)\n{\n    if (typeof x === \"object\")\n    {\n        // passed [x, y]\n        y = x[1];\n        x = x[0];\n    }\n    return [floor(x / TILE_WIDTH), floor(y / TILE_HEIGHT)];\n};\n\nvar tileFor = function(tX, tY)\n{\n    if (typeof tX === \"object\")\n    {\n        // someone passed in tileFor([tX, tY])\n        tY = tX[1];\n        tX = tX[0];\n    }\n    if (tY < TILE_MAP_ROWS && tX < TILE_MAP_COLS && tY >= 0 && tX >= 0)\n    {\n        return tileForId[TILE_MAP[tY][tX]];\n    }\n    else\n    {\n        return block.air;\n    }\n};\n\nvar tileForPoint = function(x, y)\n{\n    if (y < TILE_MAP_ROWS * TILE_HEIGHT && x < TILE_MAP_COLS * TILE_WIDTH && y >= -1 && x >= 0)\n    {\n        if(tileFor(tileCoordsForPoint(x, y + TILE_HEIGHT)).height === 1)\n        {\n            if(y < 0)\n            {\n                return block.air;\n            }\n            else\n            {\n                return tileFor(tileCoordsForPoint(x, y));\n            }\n        }\n        else if(tileFor(tileCoordsForPoint(x, y + TILE_HEIGHT)).height === 2)\n        {\n            return tileFor(tileCoordsForPoint(x, y + TILE_HEIGHT));\n        }\n    }\n    else\n    {\n        return block.air;\n    }\n};\n\n/*for(var a = 0; a < TILE_MAP_ROWS; a++)\n{\n    for(var b = 0; b < TILE_MAP_COLS; b++)\n    {\n        if(tileForId[TILE_MAP[a][b]].height === 2 && b > 0)\n        {\n            TILE_MAP[a][b - 1] = 42;\n        }\n    }\n}*/\n\nhealth -= 1;\n\nvar rectIntersectsRect = function(x1, y1, w1, h1, x2, y2, w2, h2)\n{\n    return(((x1 <= x2) && (x2 <= x1 + w1)) || ((x2 <= x1) && (x1 <= x2 + w2))) && (((y1 <= y2) && (y2 <= y1 + h1)) || ((y2 <= y1) && (y1 <= y2 + h2)));\n};\n\nvar rectIntersectsTile = function(x, y, w, h, tX, tY)\n{\n    return rectIntersectsRect(x, y, w, h,\n    \n        tX * TILE_WIDTH,\n        tY * TILE_HEIGHT,\n        tX * TILE_WIDTH + TILE_WIDTH,\n        tY * TILE_HEIGHT + TILE_HEIGHT);\n};\n\nvar pointIntersectsTile = function(x, y, tX, tY)\n{\n    return rectIntersectsTile(x, y, 1000, 1000, tX, tY);\n};\n\nvar arrowIntersectsDude = function(arrow, dude)\n{\n    return rectIntersectsRect(\n        arrow.x,\n        arrow.y - 80,\n        1,\n        1,\n        \n        dude.x + dude.cXOffset,\n        dude.y + dude.cYOffset,\n        dude.cWidth,\n        dude.cHeight);\n};\n\nvar dudeIntersectsTile = function(dude, tX, tY)\n{\n    return rectIntersectsTile(\n        dude.x + dude.cXOffset,\n        dude.y + dude.cYOffset,\n        dude.cWidth,\n        dude.cHeight,\n        \n        tX, tY);\n};\n\nvar dudeIntersectsDude = function(dude1, dude2)\n{\n    return rectIntersectsRect(\n        dude1.x + dude1.cXOffset,\n        dude1.y + dude1.cYOffset,\n        dude1.cWidth,\n        dude1.cHeight,\n        \n        dude2.x + dude2.cXOffset,\n        dude2.y + dude2.cYOffset,\n        dude2.cWidth,\n        dude2.cHeight);\n};\n\nvar t = 0;\nvar scrollX = 0, scrollY = 0;\nvar animMap = {};\n\nvar tileImages = {\n    1: getImage(\"cute/BrownBlock\"),\n    2: getImage(\"cute/ChestClosed\"),\n    3: getImage(\"cute/ChestLid\"),\n    4: getImage(\"cute/ChestOpen\"),\n    5: getImage(\"cute/DirtBlock\"),\n    6: getImage(\"cute/DoorTallClosed\"),\n    7: getImage(\"cute/DoorTallOpen\"),\n    8: getImage(\"cute/GrassBlock\"),\n    9: getImage(\"cute/PlainBlock\"),\n    10: getImage(\"cute/RampEast\"),\n    11: getImage(\"cute/RampNorth\"),\n    12: getImage(\"cute/RampSouth\"),\n    13: getImage(\"cute/RampWest\"),\n    14: getImage(\"cute/Rock\"),\n    15: getImage(\"cute/RoofEast\"),\n    16: getImage(\"cute/RoofNorth\"),\n    17: getImage(\"cute/RoofNorthEast\"),\n    18: getImage(\"cute/RoofNorthWest\"),\n    19: getImage(\"cute/RoofSouth\"),\n    20: getImage(\"cute/RoofSouthEast\"),\n    21: getImage(\"cute/RoofSouthWest\"),\n    22: getImage(\"cute/RoofWest\"),\n    23: getImage(\"cute/ShadowEast\"),\n    24: getImage(\"cute/ShadowNorth\"),\n    25: getImage(\"cute/ShadowNorthEast\"),\n    26: getImage(\"cute/ShadowNorthWest\"),\n    27: getImage(\"cute/ShadowSideWest\"),\n    28: getImage(\"cute/ShadowSouth\"),\n    29: getImage(\"cute/ShadowSouthEast\"),\n    30: getImage(\"cute/ShadowSouthWest\"),\n    31: getImage(\"cute/ShadowWest\"),\n    32: getImage(\"cute/StoneBlock\"),\n    33: getImage(\"cute/StoneBlockTall\"),\n    34: getImage(\"cute/TreeShort\"),\n    35: getImage(\"cute/TreeTall\"),\n    36: getImage(\"cute/TreeUgly\"),\n    37: getImage(\"cute/WallBlock\"),\n    38: getImage(\"cute/WallBlockTall\"),\n    39: getImage(\"cute/WaterBlock\"),\n    40: getImage(\"cute/WindowTall\"),\n    41: getImage(\"cute/WoodBlock\")\n};\n\nvar tileColors = {\n    0: color(255, 255, 255),\n    1: color(0, 0, 0),\n    2: color(255, 255, 0),\n    3: color(255, 255, 255),\n    4: color(0, 0, 0),\n    5: color(0, 0, 0),\n    6: color(255, 0, 255),\n    7: color(255, 222, 255),\n    8: color(0, 0, 0),\n    9: color(0, 0, 0),\n    10: color(26, 26, 26),\n    11: color(26, 26, 26),\n    12: color(26, 26, 26),\n    13: color(26, 26, 26),\n    14: color(128, 128, 128),\n    15: color(0, 0, 0),\n    16: color(0, 0, 0),\n    17: color(0, 0, 0),\n    18: color(0, 0, 0),\n    19: color(0, 0, 0),\n    20: color(0, 0, 0),\n    21: color(0, 0, 0),\n    22: color(0, 0, 0),\n    23: color(255, 255, 255),\n    24: color(255, 255, 255),\n    25: color(255, 255, 255),\n    26: color(255, 255, 255),\n    27: color(255, 255, 255),\n    28: color(255, 255, 255),\n    29: color(255, 255, 255),\n    30: color(255, 255, 255),\n    31: color(255, 255, 255),\n    32: color(0, 0, 0),\n    33: color(0, 0, 0),\n    34: color(52, 184, 40),\n    35: color(52, 184, 40),\n    36: color(52, 184, 40),\n    37: color(0, 0, 0),\n    38: color(0, 0, 0),\n    39: color(0, 0, 255),\n    40: color(72, 131, 133),\n    41: color(0, 0, 0)\n};\n\nvar drawParallax = function()\n{\n/*explainations of the noise() and noiseDetail() are here: http://processingjs.org/reference/noise_/\nhttp://processingjs.org/reference/noiseDetail_/\n*/\n    noiseDetail(3,0.5);\n    //var heightArray = []; //create an array (for debugging)\n    for(var i = 0; i < TILE_MAP_COLS / 4; i += 0.2)//loops through the following code approximately as many times as the map is wide\n    {\n        var height = pow(noise(i, 0, 0) * 7, 1.5);//see processingjs.org/reference/noise_/\n        //heightArray.push(height);//adds the value of height to the end of heightArray\n        pushMatrix();//pushes matrix (http://processingjs.org/reference/pushMatrix_/)\n        scale(0.25, 0.25);//scales the matrix (http://processingjs.org/reference/scale_/)\n        var tileImage = 5;//sets tileImage to 5 (dirt)\n        for(var j = 0; j < height; j++)//loops through the following code as many times as the value of height\n        {\n            if(j > height - 1)//if this is the last time through the loop\n            {\n                tileImage = 8;//tileImage = 8 (grass)\n            }\n            image(tileImages[tileImage], i * 5 * TILE_WIDTH + scrollX, (-j * TILE_HEIGHT) + scrollY + 950);//draws grass or dirt in the proper place.\n            if(tileImage === 8 && random(0, 8) === 0)\n            {\n                image(tileImages[random(34, 36)], i * 5 * TILE_WIDTH + scrollX, ((-j - 1) * TILE_HEIGHT) + scrollY + 950);\n            }\n        }\n        popMatrix();//http://processingjs.org/reference/popMatrix_/\n    }\n    //debug(heightArray);\n};\n\nvar drawDayNight = function()\n{\n    pushMatrix();\n    translate(200, 400);\n    rotate(time);\n    noStroke();\n    fill(255, 255, 0);\n    ellipse(-200, -200, 50, 50);\n    fill(255, 255, 255);\n    ellipse(200, 200, 50, 50);\n    popMatrix();\n};\n\nvar drawBackground = function()\n{\n    //background(216, 245, 252);\n    image(bg, 0, 0);\n    drawDayNight();\n    drawParallax();\n};\n\nvar animFor = function(tX, tY)\n{\n    if (tY in animMap && tX in animMap[tY])\n    {\n        var anim = animMap[tY][tX];\n        if (anim.type === \"powerup\")\n        {\n            anim.yOffset = anim.t*anim.t - 6*anim.t;\n            if (anim.t > 0 && anim.yOffset === 0)\n            {\n                delete animMap[tY][tX];\n            }\n        }\n        \n        anim.t += 1;\n\n        return anim;\n    }\n};\n\nvar drawTile = function(tX, tY)\n{\n    var tileId = tileFor(tX, tY).id;\n    var anim = animFor(tX, tY);\n    if (anim)\n    {\n        image(tileImages[anim.tile], TILE_WIDTH * tX + scrollX + anim.xOffset, TILE_HEIGHT * tY + scrollY + anim.yOffset);\n    }\n    else\n    {\n        var tileImage = tileFor(tX, tY).image;\n        if(!tileImage)\n        {\n            return;\n        }\n\n        if(tileId > 22 && tileId < 32)\n        {\n            image(tileFor(tX, tY).image, TILE_WIDTH * tX + scrollX, TILE_HEIGHT * tY + scrollY + TILE_HEIGHT);\n        }\n        else\n        {\n            image(tileFor(tX, tY).image, TILE_WIDTH * tX + scrollX, TILE_HEIGHT * tY + scrollY);\n        }\n    }\n};\n\nvar dudeImages = {\n    1: dudeIm,\n    2: getImage(\"cute/EnemyBug\"),\n    3: getImage(\"avatars/purple-pi\")\n};\n\nvar otherImages = {\n    1: getImage(\"cute/Heart\")\n};\n\nvar hero = {\n    // these are properties that all kinds of characters have\n    // including the hero\n    x: 0,\n    y: 0,\n\n    xVelocity: 0,\n    yVelocity: 0,\n\n    wounded: false,\n    lastWounded: 0,\n\n    cXOffset: 20,\n    cWidth: TILE_WIDTH - 40,\n    cYOffset: 0,\n    cHeight: TILE_HEIGHT * 2,\n\n    im: 1,\n    \n    player: false,\n\n    // only the hero has the following properties, though\n    jump: 0, // increases as you hold down JUMP, so a brief tap !== a long press\n    running: false,\n\n    facesLeft: false,\n    ySway: 0,\n    \n    power: \"none\",\n\n    dead: false\n};\n\nvar drawItem = function(i, x, y)\n{\n    switch(i)\n    {\n        case 1: image(swordIm, x, y);\n            break;\n        case 2: image(clubIm, x, y);\n            break;\n        case 3: image(daggerIm, x, y);\n            break;\n        case 4: image(bowIm, x, y);\n            break;\n        case 5: image(arrowIm, x, y - 24);\n            break;\n    }\n};\n\n/**********\n * popups *\n **********/\nvar newPopup = function(text, x, y)\n{\n    popups.push({\n        x: x,\n        y: y,\n        \n        age: 0,\n        \n        text: text\n    });\n};\n\nvar drawPopup = function(popup)\n{\n    pushMatrix();\n    translate(popup.x + scrollX, popup.y + scrollY);\n    textSize(30);\n    fill(255, 0, 0);\n    var age = popup.age;\n    if(age > 25)\n    {\n        fill(255, 232, 232);\n    }\n    if(age > 28)\n    {\n        scale((age - 26) * 0.5, 1 / ((age - 26) * 0.5));\n    }\n    text(popup.text, 0, 0);\n    popMatrix();\n};\n\nvar drawPopups = function()\n{\n    for (var i = 0; i < popups.length; i++)\n    {\n        drawPopup(popups[i]);\n    }\n};\n\nvar updatePopups = function()\n{\n    for (var i = 0; i < popups.length; i += 1)\n    {\n        popups[i].y -= ((30 - popups[i].age) / 5);\n        popups[i].age++;\n        if(popups[i].age > 30)\n        {\n            popups.splice(i, 1);\n        }\n    }\n};\n\nvar calcInvX = function(i)\n{\n    return (i % 6 + 2) * 40;\n};\n\nvar calcInvY = function(i)\n{\n    return (ceil((i + 1) / 6) + 1) * 40;\n};\n\nvar equipItem = function(loc)\n{\n    if(inventory[loc] < 1)\n    {\n        return;\n    }\n    hero.power = itemForId[inventory[loc]];\n    equippedItemLocation = loc;\n    itemIdEquipped = inventory[loc];\n    weaponDurability = invMetadata[loc];\n    if(invMetadata[loc] === 0)\n    {\n       invMetadata[loc] = itemForId[inventory[loc]].durability;\n    }\n    itemEquipped = true;\n};\n\nvar findInInv = function()\n{\n    var foundYet = false;\n    for(var i = 0; i < 24; i++)\n    {\n        if(inventory[i] !== 0)\n        {\n            equipItem(i);\n            foundYet = true;\n        }\n        if(foundYet === true)\n        {\n            break;\n        }\n    }\n};\n\nvar putInInv = function(itemId)\n{\n    putInYet = false;\n    for(var i = 0; i < 24; i++)\n    {\n        if(inventory[i] === 0)\n        {\n            inventory[i] = itemId;\n            invMetadata[i] = itemForId[itemId].durability;\n            if(hero.power === \"none\")\n            {\n                findInInv();\n            }\n            putInYet = true;\n            //break;\n        }\n        if(putInYet === true)\n        {\n            break;\n        }\n    }\n};\n\nvar openChest = function(tX, tY)\n{\n    var extraCoins = tileMetadata[tY][tX];\n    newPopup(\"+\" + extraCoins + \"c\", hero.x, hero.y);\n    coins += extraCoins;\n    stats.coins += extraCoins;\n    TILE_MAP[tY][tX] = 4;\n};\n\nvar hitPowerup = function(tX, tY)\n{\n    if (!(tY in animMap))\n    {\n        animMap[tY] = {};\n    }\n\n    animMap[tY][tX] = {\n        tile: tileFor(tX, tY).id,\n        type: \"powerup\",\n\n        xOffset: 0,\n        yOffset: 0,\n        \n        t: 0\n    };\n    openChest(tX, tY);\n};\n\nvar drawDude = function(dude)\n{\n    var mod;\n    if(dude.x === 0)\n    {\n        dude.player = true;\n    }\n    if (dude.wounded && round(t / 3) % 2 === 0)\n    {\n        return;\n    }\n    if (dude.xVelocity !== 0)\n    {\n        if (dude.xVelocity < 0)\n        {\n            dude.facesLeft = true;\n        }\n        else if (dude.xVelocity > 0)\n        {\n            dude.facesLeft = false;\n        }\n        \n        if (dude.yVelocity === 0)\n        {\n            if (dude.ySway === 0)\n            {\n                dude.ySway = 1;\n            }\n            else\n            {\n                if (dude.running)\n                {\n                    mod = 3;\n                }\n                else\n                {\n                    mod = 4;\n                }\n                \n                if ((t % mod) === 0)\n                {\n                    dude.ySway = -dude.ySway;\n                }\n            }\n        }\n    }\n    else\n    {\n        dude.ySway = 0;\n    }\n    \n    var img = dudeImages[dude.im];\n    var dying = dude.dead && (dude.y + scrollY) < height;\n    \n    if (dude.facesleft)\n    {\n        pushMatrix();\n        scale(-1, 1);\n        if(img === dudeIm)\n        {\n            image(img, ((dude.x + scrollX + img.width)/4), (dude.y + scrollY + dude.ySway + 40)/4);\n        }\n        else\n        {\n            image(img, (dude.x + scrollX + img.width - 100), dude.y + scrollY + dude.ySway + 20);\n        }\n        popMatrix();\n    }\n    else\n    {\n        pushMatrix();\n        if(img === dudeIm)\n        {\n            scale(2, 2);\n            image(img, (dude.x + scrollX + img.width - 40) / 2, (dude.y + scrollY + dude.ySway + 40) / 2);\n        }\n        else\n        {\n            image(img, (dude.x + scrollX + img.width - 100), dude.y + scrollY + dude.ySway + 20);\n        }\n        popMatrix();\n    }\n\n    if (dying)\n    {\n        popMatrix();\n    }\n};\n\n/**********\n * arrows *\n **********/\nvar sin1 = function(angle)\n{\n    angle = angle*(PI/180);\n    return (angle*(PI/180))-((angle*(PI/180))^3)/6+((angle*(PI/180))^5)/120;\n};\n\nvar cos1 = function(angle)\n{\n    angle = angle*(PI/180);\n    return 1-((angle*(PI/180))^2)/2+((angle*(PI/180))^4)/24;\n};\n\nvar tan1 = function(angle)\n{\n    return sin1(angle) / cos1(angle);\n};\n\n\nvar arrows = [];\nvar stillArrows = [];\n\nvar newArrow = function(x, y, xVel, yVel)\n{\n    \n    arrows.push({\n        x: x,\n        y: y,\n\n        xVelocity: xVel,\n        yVelocity: yVel,\n        \n        im: arrowIm,\n        \n        ySway: 0,\n        \n        cXOffset: 0,\n        cWidth: 0.1,\n        cYOffset: 0,\n        cHeight: 0.1,\n        \n        rotation: atan(yVel / xVel),\n        \n        age: 0\n    });\n};\n\nvar drawArrow = function(arrow)\n{\n    pushMatrix();\n    scale(1.5, 1.5);\n    translate((arrow.x + scrollX) / 1.5, (arrow.y + scrollY) / 1.5);\n    rotate(arrow.rotation);\n    image(arrowIm, -64, -8);\n    popMatrix();\n};\n\nvar drawArrows = function()\n{\n    for (var i = 0; i < arrows.length; i++)\n    {\n        drawArrow(arrows[i]);\n    }\n};\n\nvar drawStillArrows = function()\n{\n    for (var i = 0; i < stillArrows.length; i++)\n    {\n        drawArrow(stillArrows[i]);\n    }\n};\n\nvar fireArrow = function()\n{\n    heroMouseDiffX = (mouseX * 2)-(hero.x +scrollX) - 50;\n    heroMouseDiffY = (mouseY * 2)-(hero.y+scrollY) - 100;\n    var xVel = cos(atan(heroMouseDiffY /heroMouseDiffX));\n    var yVel = sin(atan(heroMouseDiffY /heroMouseDiffX));\n    if(heroMouseDiffX < 0)\n    {\n        xVel = -xVel;\n        yVel = -yVel;\n    }\n    newArrow(hero.x + 50, hero.y + 100, xVel * 48, yVel * 48);\n    arrowFrameFiredAgo = 0;\n};\n\n/*********\n * NPC\'s *\n *********/\n \nvar NPCs = [];\n\nvar loadNPC = function(id, tX, tY)\n{\n    var im;\n    \n    if(id === 0)\n    {\n        return;\n    }\n    \n    NPCs.push({\n        x: tX * TILE_WIDTH,\n        y: tY * TILE_HEIGHT,\n        \n        xVelocity: 0,\n        yVelocity: 0,\n        \n        wounded: false,\n        \n        im: id,\n        \n        ySway: 0,\n        \n        cXOffset: 0,\n        cWidth: TILE_WIDTH,\n        cYOffset: 0,\n        cHeight: TILE_HEIGHT * 2,\n        \n        id: id,\n        \n        inventory: [3, 1, 2, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n    });\n};\n\nvar loadNPCs = function()\n{\n    for (var tY = 0; tY < TILE_MAP_ROWS; tY += 1)\n    {\n        for (var tX = 0; tX < TILE_MAP_COLS; tX += 1)\n        {\n            if (NPC_MAP[tY][tX] !== 0)\n            {\n                loadNPC(NPC_MAP[tY][tX], tX, tY);\n            }\n        }\n    }\n};\nloadNPCs();\n\nvar drawNPCs = function()\n{\n    for (var i = 0; i < NPCs.length; i += 1)\n    {\n        drawDude(NPCs[i]);\n    }\n};\n\nvar talkToNPC = function(NPC)\n{\n    menu = \"npc\";\n    ingame = false;\n};\n\nvar buyItem = function(itemId)\n{\n    if(coins >= itemForId[itemId].cost)\n    {\n        putInInv(itemId);\n        coins -= itemForId[itemId].cost;\n        stats.spent += oldCoins - coins;\n    }\n};\n\n// sectumsempra\n// ------------\nvar enemies = [];\n\nvar loadEnemy = function(id, tX, tY) {\n    var im;\n    \n    if (id === 0)\n    {\n        return;\n    }\n    \n    enemies.push({\n        x: tX * TILE_WIDTH,\n        y: tY * TILE_HEIGHT,\n        \n        xVelocity: ENEMY_VELOCITY,\n        yVelocity: 0,\n        \n        wounded: false,\n        \n        im: id,\n        \n        ySway: 0,\n        \n        cXOffset: 0,\n        cWidth: TILE_WIDTH,\n        cYOffset: 0,\n        cHeight: TILE_HEIGHT * 2\n    });\n};\n\nvar loadEnemies = function()\n{\n    for (var tY = 0; tY < TILE_MAP_ROWS; tY += 1)\n    {\n        for (var tX = 0; tX < TILE_MAP_COLS; tX += 1)\n        {\n            if (ENEMY_MAP[tY][tX] !== 0)\n            {\n                loadEnemy(ENEMY_MAP[tY][tX], tX, tY);\n            }\n        }\n    }\n};\nloadEnemies();\n\nvar drawEnemies = function()\n{\n    for (var i = 0; i < enemies.length; i += 1)\n    {\n        drawDude(enemies[i]);\n    }\n};\nvar killEnemy = function(i)\n{\n    var extraCoins = round(random(0, 3.5));\n    coins += extraCoins;\n    newPopup( \"+\" + extraCoins + \"c\", hero.x, hero.y);\n    stats.coins += extraCoins;\n    enemies.splice(i, 1);\n    stats.kills++;\n    weaponDurability--;\n    invMetadata[equippedItemLocation] = weaponDurability;\n    if(weaponDurability < 1)\n    {\n        hero.power = \"none\";\n        inventory[equippedItemLocation] = 0;\n        equippedItemLocation = -1;\n        itemIdEquipped = -1;\n        itemEquipped = false;\n        findInInv();\n    }\n};\n\n// drawing\n// -------\nvar drawMapBelowHero = function() {\n    var heroRow = max(floor(hero.y / TILE_HEIGHT), 0);\n    // have to draw rows at the bottom first, and go upward\n    for (var tY = TILE_MAP_ROWS - 1; tY >= heroRow; tY -= 1) {\n        for (var tX = 0; tX < TILE_MAP_COLS; tX += 1) {\n            drawTile(tX, tY);\n        }\n    }\n};\nvar drawMapAboveHero = function() {\n    // have to draw rows at the bottom first, and go upward\n    var heroRow = floor(hero.y / TILE_HEIGHT);\n    \n    if (heroRow >= 0) {\n        for (var tY = heroRow; tY >= 0; tY -= 1) {\n            for (var tX = 0; tX < TILE_MAP_COLS; tX += 1) {\n                drawTile(tX, tY);\n            }\n        }\n    }\n};\n\n// collisions\n// ----------\n\n// tiles adjacent to dudes\nvar pointAdj = function(dude, dir, amt)\n{\n    var x, y;\n    amt = amt || 1;\n\n    if (dir === \"left\")\n    {\n        x = dude.x + dude.cXOffset - amt;\n        y = dude.y + dude.cYOffset;\n    }\n    else if (dir === \"right\")\n    {\n        x = dude.x + dude.cXOffset + dude.cWidth + amt;\n        y = dude.y + dude.cYOffset;\n    }\n    else if (dir === \"below left\")\n    {\n        x = dude.x + dude.cXOffset;\n        y = dude.y + dude.cYOffset + dude.cHeight + amt;\n    }\n    else if (dir === \"below right\")\n    {\n        x = dude.x + dude.cXOffset + dude.cWidth;\n        y = dude.y + dude.cYOffset + dude.cHeight + amt;\n    }\n    else if (dir === \"above left\")\n    {\n        x = dude.x + dude.cXOffset;\n        y = dude.y + dude.cYOffset - amt;\n    }\n    else if (dir === \"above right\")\n    {\n        x = dude.x + dude.cXOffset + dude.cWidth;\n        y = dude.y + dude.cYOffset - amt;\n    }\n    return [x, y];\n};\n\nvar tileCoordsAdj = function(dude, dir, amt)\n{\n    //return tileCoordsForPoint(pointAdj(dude, dir, amt));\n    var x, y;\n    amt = amt || 1;\n\n    if (dir === \"left\")\n    {\n        x = dude.x + dude.cXOffset - amt;\n        y = dude.y + dude.cYOffset;\n    }\n    else if (dir === \"right\")\n    {\n        x = dude.x + dude.cXOffset + dude.cWidth + amt;\n        y = dude.y + dude.cYOffset;\n    }\n    else if (dir === \"below left\")\n    {\n        x = dude.x + dude.cXOffset;\n        y = dude.y + dude.cYOffset + dude.cHeight + amt;\n    }\n    else if (dir === \"below right\")\n    {\n        x = dude.x + dude.cXOffset + dude.cWidth;\n        y = dude.y + dude.cYOffset + dude.cHeight + amt;\n    }\n    else if (dir === \"above left\")\n    {\n        x = dude.x + dude.cXOffset;\n        y = dude.y + dude.cYOffset - amt;\n    }\n    else if (dir === \"above right\")\n    {\n        x = dude.x + dude.cXOffset + dude.cWidth;\n        y = dude.y + dude.cYOffset - amt;\n    }\n    return tileCoordsForPoint(x, y);\n};\n\nvar tileAdj = function(dude, dir, amt)\n{\n    //return tileForPoint(pointAdj(dude, dir, amt)[0], pointAdj(dude, dir, amt)[1]);\n    return tileFor(tileCoordsAdj(dude, dir, amt));\n};\n\n/*var tileCoordsAdj = function(dude, dir, amt) {\n    var x, y;\n    amt = amt || 1;\n\n    if (dir === \"left\") {\n        x = dude.x + dude.cXOffset - amt;\n        y = dude.y + dude.cYOffset;\n    } else if (dir === \"right\") {\n        x = dude.x + dude.cXOffset + dude.cWidth + amt;\n        y = dude.y + dude.cYOffset;\n    } else if (dir === \"below left\") {\n        x = dude.x + dude.cXOffset;\n        y = dude.y + dude.cYOffset + dude.cHeight + amt;\n    } else if (dir === \"below right\") {\n        x = dude.x + dude.cXOffset + dude.cWidth;\n        y = dude.y + dude.cYOffset + dude.cHeight + amt;\n    } else if (dir === \"above left\") {\n        x = dude.x + dude.cXOffset;\n        y = dude.y + dude.cYOffset - amt;\n    } else if (dir === \"above right\") {\n        x = dude.x + dude.cXOffset + dude.cWidth;\n        y = dude.y + dude.cYOffset - amt;\n    }\n    \n    return tileCoordsForPoint(x, y);\n};\n\nvar tileAdj = function(dude, dir, amt) {\n    return tileFor(tileCoordsAdj(dude, dir, amt));\n};*/\n\nvar tileAdjIsBlocking = function(dude, dir, amt)\n{\n    if (dir === \"left\" || dir === \"right\")\n    {\n        return tileAdj(dude, dir, amt).isSolid;\n    }\n    else if (dir === \"below\"|| dir === \"above\")\n    {\n        return tileAdj(dude, dir + \" left\", amt).isSolid || tileAdj(dude, dir + \" right\", amt).isSolid;\n    }\n};\n\nvar checkXCollisions = function(dude)\n{\n    var tal = tileCoordsAdj(dude, \"left\");\n    var tar = tileCoordsAdj(dude, \"right\");\n    // FIXME jump into block above you bug\n    if(tileAdjIsBlocking(dude, \"left\") && dude.xVelocity < 0)\n    {\n        while(tileAdjIsBlocking(dude, \"left\") && !tileAdjIsBlocking(dude, \"right\"))\n        {\n            if(tileFor(tal[0], tal[1]).id === 6 && dude.player)\n            {\n                TILE_MAP[tal[0]][tal[1]] = 7;\n            }\n            dude.x += 1;\n        }\n    }\n    else if(tileAdjIsBlocking(dude, \"right\") && dude.xVelocity > 0)\n    {\n        while(tileAdjIsBlocking(dude, \"right\") && !tileAdjIsBlocking(dude, \"left\"))\n        {\n            if(tileFor(tar[0], tar[1]).id === 6 && dude.player)\n            {\n                TILE_MAP[tar[1]][tar[0]] = 7;\n            }\n            dude.x -= 1;\n        }\n    }\n    if(tileAdj(dude, \"below left\").id === 6)\n    {\n        TILE_MAP[tal[1]][tal[0] - 1] = 7;\n    }\n};\n\nvar checkYCollisions = function(dude)\n{\n    var tal, tar, tab;\n    var curTile = tileCoordsForPoint(dude.x, dude.y);\n    if(tileAdjIsBlocking(dude, \"below\") && dude.yVelocity >0)\n    {\n        tab = tileCoordsAdj(dude, \"below\");\n        if(tileFor(tab[0], tab[1]).isPowerup)\n        {\n            hitPowerup(tab[0], tab[1]);\n        }\n        dude.yVelocity = 0;\n        while(tileAdjIsBlocking(dude, \"below\"))\n        {\n            dude.y -= 1;\n        }\n    }\n    else if(tileAdjIsBlocking(dude, \"above\") && dude.yVelocity < 0)\n    {\n        dude.yVelocity = dude.yVelocity * -1/2;\n\n        tal = tileCoordsAdj(dude, \"above left\");\n        if(tileFor(tal[0], tal[1]).isPowerup)\n        {\n            hitPowerup(tal[0], tal[1]);\n        }\n        else\n        {\n            tar = tileCoordsAdj(dude, \"above right\");\n            if (tileFor(tar[0], tar[1]).isPowerup)\n            {\n                hitPowerup(tar[0], tar[1]);\n            }\n        }\n\n        while (tileAdjIsBlocking(dude, \"above\"))\n        {\n            dude.y += 1;\n        }\n    }\n};\n\nvar checkArrowCollisions = function(arrow)\n{\n    var arrowTileX = floor(arrow.x / TILE_WIDTH);\n    var arrowTileY = floor(arrow.y / TILE_HEIGHT - 1.5);\n    \n    if(tileFor(arrowTileX, arrowTileY).isSolid)\n    {\n        stillArrows.push(arrow);\n        arrows.splice(arrow, 1);\n    }\n};\n\n// input\n// -----\nvar keyJump = false, keyLeft = false, keyRight = false, mouseLeft = false;\n\nvar pause = function()\n{\n    fill(10, 10, 30, 150);\n    noStroke();\n    rect(0, 0, 400, 400);\n    filter(BLUR, 1);\n    ingame = false;\n};\n\nvar checkLeftMouse = function()\n{\n    if(mouseIsPressed && mouseButton === LEFT)\n    {\n        mouseLeft = true;\n    }\n    else\n    {\n        mouseLeft = false;\n    }\n    if(mouseLeft && itemIdEquipped === 4 && arrowFrameFiredAgo > 15)\n    {\n        fireArrow();\n    }\n    arrowFrameFiredAgo++;\n};\n\nvar mouseClicked = function()\n{\n    switch (whichButton)\n    {\n        case \'s\':\n            menu = \'s\';\n            break;\n        case \'h1\':\n            menu = \'h1\';\n            break;\n        case \'h2\':\n            menu = \'h2\';\n            break;\n        case \'h3\':\n            menu = \'h3\';\n            break;\n        case \'a\':\n            menu = \'a\';\n            break;\n        case \'p\':\n            ingame = true;\n            gameStarted = true;\n            menu = \"inventory\";\n            break;\n        case \'m\':\n            menu = \'m\';\n            break;\n        case \"i\":\n            equipItem(whichButtonMetadata);\n            break;\n        case \"NPCInv\":\n            buyItem(NPCs[currentNPC].inventory[whichButtonMetadata]);\n            break;\n    }\n};\n\nvar keyPressed = function()\n{\n    switch(keyCode)\n    {\n        case 87:\n            keyJump = true;\n            break;\n        case 83:\n            hero.running = true;\n            break;\n        case 65:\n            keyLeft = true;\n            break;\n        case 68:\n            keyRight = true;\n            break;\n        case 69:\n            pause();\n            break;\n        case 32:\n            if(currentNPC !== false)\n            {\n                talkToNPC(currentNPC);\n            }\n            break;\n    }\n};\nvar keyReleased = function()\n{\n    switch(keyCode)\n    {\n        case 87:\n            keyJump = false;\n            break;\n        case 83:\n            hero.running = false;\n            break;\n        case 65:\n            keyLeft = false;\n            break;\n        case 68:\n            keyRight = false;\n            break;\n    }\n};\n\n// hero update stuff\n// -----------------\nvar maxHeroSpeed = function()\n{\n    if (hero.running)\n    {\n        if(energy>0){\n                  return 15;  \n        }\n        if(energy<1){\n            return 9;\n        }\n\n\n    }\n    else\n    {\n        return 9;\n    }\n};\n\nvar updateHeroXVelocity = function()\n{\n    if (keyRight)\n    {\n        if (hero.xVelocity < 0)\n        {\n            hero.xVelocity = 0;\n        }\n        hero.xVelocity += 1;\n    } else if (keyLeft) {\n        if (hero.xVelocity > 0)\n        {\n            hero.xVelocity = 0;\n        }\n        hero.xVelocity -= 1;\n    } else {\n        if (hero.xVelocity > 0)\n        {\n            hero.xVelocity -= 0.5;\n        } else if (hero.xVelocity < 0)\n        {\n            hero.xVelocity += 0.5;\n        }\n    }\n\n    if (hero.xVelocity > maxHeroSpeed())\n    {\n        hero.xVelocity = 9;\n    } else if (hero.xVelocity < -maxHeroSpeed())\n    {\n        hero.xVelocity = -9;\n    }\n};\n\nvar updateHeroYVelocity = function()\n{\n    if (keyJump)\n    {\n        if (hero.yVelocity === 0 && tileAdjIsBlocking(hero, \"below\", 2)) {\n            hero.jump = 1;\n        }\n            \n        if (hero.jump > 0 && hero.jump < 7)\n        {\n            hero.jump += 1;\n            hero.yVelocity -= 6;\n        }\n    }\n\n    if (!keyJump || hero.jump >= 7)\n    {\n        hero.jump = 0;\n    }\n\n    if (hero.yVelocity < -50)\n    { // max jump speed\n        hero.yVelocity = -50;\n    } else if (hero.yVelocity > 300)\n    { // terminal velocity\n        // (this is as fast as you can ever fall)\n        hero.yVelocity = 300;\n    }\n};\n\nvar drawHealth = function()\n{\n    getImage(\"cute/Heart\");\n    for (var i = 0; i <= health; i++)\n    {\n        pushMatrix();\n        scale(0.3, 0.3);\n        image(getImage(\"cute/Heart\"), 1200 - (108 * i), 100);\n        popMatrix();\n    }\n};\nvar killHero = function()\n{\n    hero.yVelocity -= 100;\n    hero.dead = true;\n    menu = \'e\';\n    ingame = false;\n};\n\nvar woundHero = function(damage)\n{\n    hero.wounded = true;\n    hero.lastWounded = t;\n    health -= damage;\n    if (health < 0)\n    {\n        killHero();\n    }\n};\n\n\nvar checkEnemyCollisions = function()\n{\n    // this is intentionally under hero stuff,\n    // because it\'s centered around the hero\n    // (I guess it\'s arguable)\n    if (hero.wounded)\n    {\n        return;\n    }\n    \n    for(var i = 0; i < enemies.length; i += 1)\n    {\n        if(dudeIntersectsDude(hero, enemies[i]))\n        {\n            if(itemEquipped && itemForId[itemIdEquipped].type === \"weapon\")\n            {\n                if(itemForId[itemIdEquipped].type === \"weapon\")\n                {\n                    killEnemy(i);\n                }\n            }\n            else\n            {\n                // enemy hit us!\n                woundHero(3);\n            }\n        }\n    }    \n};\n\nvar checkArrowEnemyCollisions = function()\n{\n    for(var i = 0; i < enemies.length; i++)\n    {\n        for(var j = 0; j < arrows.length; j++)\n        {\n            if(arrowIntersectsDude(arrows[j], enemies[i]))\n            {\n                killEnemy(i);\n                arrows.splice(j, 1);\n            }\n        }\n    }    \n};\n\nvar checkNPCCollisions = function()\n{\n    for(var i = 0; i < NPCs.length; i += 1)\n    {\n        if(dudeIntersectsDude(hero, NPCs[i]))\n        {\n            currentNPC = i;\n            //println(i);\n        }\n        else\n        {\n            currentNPC = false;\n        }\n    }    \n};\n\nvar updateHero = function()\n{\n    updateHeroXVelocity();\n    updateHeroYVelocity();\n    \n    hero.yVelocity += GRAVITY;\n    \n    hero.x += hero.xVelocity;\n    hero.y += hero.yVelocity;\n\n    checkXCollisions(hero);\n    checkYCollisions(hero);\n    \n    checkEnemyCollisions();\n    checkNPCCollisions();\n    \n    if(hero.y > TILE_MAP.length * TILE_HEIGHT + 100)\n    {\n        woundHero(1);\n    }\n};\n\nvar scroll = function()\n{\n    var scrollXCoefficient = 0.85;\n    if ((hero.x + scrollX > width * scrollXCoefficient && hero.xVelocity > 0 && scrollX !== 10000) || (hero.x + scrollX < width * scrollXCoefficient && hero.xVelocity < 0 && scrollX < 0))\n    {\n        scrollX -= floor(hero.xVelocity);\n    }\n\n    if ((hero.y + scrollY > height * 1 && hero.yVelocity > 0 && scrollY > 340) || (hero.y + scrollY < height * 1 && hero.yVelocity < 0))\n    {\n        scrollY -= floor(hero.yVelocity);\n    }\n};\ngetImage(\"cute/Blank\");\n// enemy update\n// ------------\nvar pathfind = function(enemy)\n{\n    if(hero.x > enemy.x && dist(hero.x, hero.y, enemy.x, enemy.y) < 500)\n    {\n        enemy.x += enemy.xVelocity;\n    }\n    if(hero.x < enemy.x && dist(hero.x, hero.y, enemy.x, enemy.y) < 500)\n    {\n        enemy.x -= enemy.xVelocity;\n    }\n    \n    enemy.yVelocity += GRAVITY;\n    enemy.y += enemy.yVelocity;\n\n    checkXCollisions(enemy);\n    checkYCollisions(enemy);\n};\n\nvar updateEnemies = function()\n{\n    var enemy;\n    for (var i = 0; i < enemies.length; i += 1)\n    {\n        enemy = enemies[i];\n        pathfind(enemy);\n    }\n};\n\nvar updateNPCs = function()\n{\n    var NPC;\n    for (var i = 0; i < NPCs.length; i += 1)\n    {\n        NPC = NPCs[i];\n        \n        NPC.yVelocity += GRAVITY;\n    \n        NPC.x += NPC.xVelocity;\n        NPC.y += NPC.yVelocity;\n\n        checkXCollisions(NPC);\n        checkYCollisions(NPC);\n    }\n};\n\nvar updateArrows = function()\n{\n    var arrow;\n    for (var i = 0; i < arrows.length; i++)\n    {\n        arrow = arrows[i];\n        \n        arrow.age++;\n        if(arrow.age > 30*15)\n        {\n            arrows.splice(i, 1);\n        }\n        arrow.yVelocity += GRAVITY;\n    \n        arrow.x += arrow.xVelocity;\n        arrow.y += arrow.yVelocity;\n            \n        arrow.rotation = atan(arrow.yVelocity / arrow.xVelocity);\n        if(arrow.xVelocity < 0)\n        {\n            arrow.rotation += 180;\n        }\n        \n        checkArrowCollisions(arrow);\n        \n        if(arrow.x > TILE_MAP_COLS * TILE_WIDTH + 512 || arrow.y > TILE_MAP_ROWS * TILE_HEIGHT + 128)\n        {\n            arrows.splice(i, 1);\n        }\n    }\n    for (var j = 0; j < stillArrows.length; j++)\n    {\n        arrow = stillArrows[j];\n        arrow.age++;\n        if(arrow.age > 30*15)\n        {\n            stillArrows.splice(j, 1);\n        }\n    }\n};\n\n// game-wide updates\n// -----------------\nvar button = function(buttonText, x, y, length, draw)\n{\n    overButton = false;\n    textFont(FONT, 25);\n    buttonFill = color(134, 204, 106);\n    if(mouseX >= x && mouseY >= y && mouseX <= (x + length) && mouseY <= (y + 35))\n    {\n        buttonFill = color(238, 255, 0);\n        overButton = true;\n    }\n    if(draw === true)\n    {\n        stroke(57, 143, 67);\n        strokeWeight(5);\n        fill(buttonFill);\n        rect(x, y, length, 35, 10);\n\n        textAlign(CENTER, BASELINE);\n        fill(42, 42, 200);\n        text(buttonText, x + length/2, y + 27);\n        textAlign(LEFT, 0);\n    }\n};\n\nvar update = function()\n{\n    updatePopups();\n    updateHero();\n    updateEnemies();\n    updateNPCs();\n    updateArrows();\n    checkArrowEnemyCollisions();\n    scroll();\n};\n\nvar drawMinimap = function(scaleFactor) {\n    // TODO make this function clean\n    // (it was never intended to be permanent)\n    // draw a minimap of everything at 1/10 scale\n    // draw the whole tilemap\n    \n    for (var tY = 0; tY < TILE_MAP_ROWS; tY += 1)\n    {\n        for (var tX = 0; tX < TILE_MAP_COLS; tX += 1)\n        {\n            noStroke();\n            fill(tileFor(tX, tY).color);\n            var tileHeight = tileFor(tX, tY).height;\n            rect(tX*TILE_WIDTH*scaleFactor, (tY*TILE_HEIGHT-((tileHeight*TILE_HEIGHT)-TILE_HEIGHT))*scaleFactor, TILE_WIDTH*scaleFactor, TILE_HEIGHT*scaleFactor * tileHeight);\n        }\n    }\n    \n    fill(0, 0, 255);\n    rect(hero.x*scaleFactor, hero.y * scaleFactor, TILE_WIDTH * scaleFactor, TILE_HEIGHT * scaleFactor * 2);\n    \n    fill(255, 0, 0);\n    for (var i = 0; i < enemies.length; i += 1)\n    {\n        rect(enemies[i].x * scaleFactor, enemies[i].y * scaleFactor, TILE_WIDTH*scaleFactor, TILE_HEIGHT * scaleFactor * 2);\n    }\n    \n    // draw the onscreen part\n    noFill();\n    stroke(0, 0, 255);\n    rect(-scrollX*scaleFactor, -scrollY*scaleFactor, SCREEN_COLS*TILE_WIDTH*scaleFactor, SCREEN_ROWS*TILE_HEIGHT*scaleFactor);\n};\n\nvar timer = function()\n{\n    if (hero.wounded && t - hero.lastWounded > 60)\n    {\n        hero.wounded = false;\n    }\n    t += 1;\n    if(time < 360)\n    {\n        time += 0.2;\n    }\n    else\n    {\n        time = 0;\n    }\n    \n};\n\nvar drawDurability = function()\n{\n    var oneDurability = 180 / itemForId[inventory[equippedItemLocation]].durability;\n    strokeWeight(2);\n    fill(0, 0, 255, 100);\n    rect(10, 370, 180, 20, 1);\n    \n    stroke(0, 0, 64);\n    strokeWeight(0.2);\n    fill(32, 32, 255);\n    for(var i = 0; i < weaponDurability; i++)\n    {\n        rect(10 + i * oneDurability, 370, oneDurability, 20);\n    }\n    textAlign(LEFT, CENTER);\n    textSize(12);\n    fill(0, 0, 128, 200);\n    text(\"Durability\", 15, 380);\n};\n\nvar drawGui = function()\n{\n    drawMinimap(0.1);\n    drawHealth();\n    if(hero.power !== \"none\")\n    {\n        drawDurability();\n    }\n};\n\nvar drawTooltip = function(loc)\n{\n    stroke(57, 143, 67);\n    strokeWeight(2);\n    fill(134, 204, 106);\n    rect(150, 246, 170, 32, 2);\n    \n    fill(42, 42, 200);\n    textSize(11);\n    /*if(menu === \"npc\")\n    {\n        //text(\"Durability: \" + itemForId(NPCs[currentNPC].inventory[loc]).durability, 155, 258);\n    }\n    else if(menu === \"inventory\")\n    {\n        //text(\"Durability: \" + itemForId(inventory[loc]).durability, 155, 258);\n    }*/\n};\n\nvar drawMenu = function()\n{\n    textAlign(CENTER, BASELINE);\n    \n    fill(168, 224, 146);\n    stroke(57, 143, 67);\n    strokeWeight(10);\n    rect(50, 50, 300, 300, 20);\n    \n    var word;\n    if(gameStarted)\n    {\n        word = \"Resume\";\n    }\n    else\n    {\n        word = \"Play\";\n    }\n    \n    button(word, 135, 285, 130, true);\n    if (overButton)\n    {\n        whichButton = \'p\';\n    }\n    \n    if(menu === \'m\')\n    {\n        textAlign(CENTER, BASELINE);\n        textFont(FONT, 30);\n        fill(42, 42, 200);\n        text(\"JumpSam\", 200, 100);\n        \n        pushMatrix();\n        scale(1.5, 1.5);\n        image(dudeImages[1], 45, 83);\n        popMatrix();\n        \n        button(\"Stats\", 240, 120, 80, true);\n        if (overButton)\n        {\n            whichButton = \'s\';\n        }\n        \n        button(\"How to play\", 150, 175, 170, true);\n        if (overButton)\n        {\n            whichButton = \'h1\';\n        }\n        \n        button(\"About\", 230, 230, 90, true);\n        if (overButton)\n        {\n            whichButton = \'a\';\n        }\n    }\n    \n    if(menu === \'s\')\n    {\n        textAlign(LEFT, BASELINE);\n        text(\"Kills: \" + stats.kills + \"\\nCoins collected: \" + stats.coins + \"\\nCoins spent: \" + stats.spent, 70, 100);\n        textAlign(CENTER, BASELINE);\n    }\n    \n    if(menu === \'h1\')\n    {\n        textAlign(LEFT, BASELINE);\n        textFont(FONT, 14);\n        text(\"Kill enemies, open chests, talk to\\n    NPCs, and explore!\\n\\nControls:\\n    Jump: W\\n    Move left: A\\n    Move right: D\\n    Sprint: S\\n    Pause: P\\n    Inventory: E\\n    NPC trade: Space\", 74, 80);\n        textFont(FONT, 25);\n        textAlign(CENTER, BASELINE);\n        button(\">\", 285, 285, 35, true);\n        if (overButton)\n        {\n            whichButton = \'h2\';\n        }\n    }\n    if(menu === \'h2\')\n    {\n        textAlign(LEFT, BASELINE);\n        textFont(FONT, 14);\n        \n        text(\"Click on an item in your inventory to\\n    equip it\\nClick on an item in an NPC\'s inventory\\n    to buy it\\nDaggers have 1 durability, and cost 2\\n    coins. Swords have 8 durability, and\\n    cost 10 coins. Clubs have 12\\n    durability, and cost 13 coins.\", 70, 4*20);\n    \n        textFont(FONT, 25);\n        textAlign(CENTER, BASELINE);\n    }\n    \n    if(menu === \"inventory\")\n    {\n        for(var i = 0; i < 24; i++)\n        {\n            stroke(57, 143, 67);\n            strokeWeight(2);\n            fill(134, 204, 106);\n            rect(calcInvX(i), calcInvY(i), 40, 40, 2);\n            button(\"\", calcInvX(i), calcInvY(i), 40, false);\n            if(overButton)\n            {\n                whichButton = \"i\";\n                whichButtonMetadata = i;\n                drawTooltip(i);\n            }\n            \n            if(inventory[i] !== 0)\n            {\n                stroke(42, 42, 255);\n                strokeWeight(2);\n                fill(255, 0, 0);\n                drawItem(inventory[i], calcInvX(i) + 4, calcInvY(i) + 4);\n            }\n        }\n        textSize(14);\n        fill(0, 0, 255);\n        text(\"Coins: \" + coins, 80, 265);\n    }\n    \n    if(menu === \"npc\")\n    {\n        for(var j = 0; j < 24; j++)\n        {\n            stroke(57, 143, 67);\n            strokeWeight(2);\n            fill(134, 204, 106);\n            rect(calcInvX(j), calcInvY(j), 40, 40, 2);\n            \n            button(\"\", calcInvX(j), calcInvY(j), 40, false);\n            if(overButton)\n            {\n                whichButton = \"NPCInv\";\n                whichButtonMetadata = j;\n                drawTooltip(j);\n            }\n            \n            if(NPCs[currentNPC].inventory[j] !== 0)\n            {\n                drawItem(NPCs[currentNPC].inventory[j], calcInvX(j) + 4, calcInvY(j) + 4);\n            }\n        }\n        textSize(14);\n        fill(0, 0, 255);\n        text(\"Coins: \" + coins, 80, 265);\n    }\n    \n    if(menu === \'a\')\n    {\n        textAlign(LEFT, BASELINE);\n        textFont(FONT, 14);\n\n        text(\"This game is unfinished.\\nVote it up if you like it!\\n\\nCredits:\\nJumpgirl: base code\\nTimothy Smith: button function,\\n  (slightly edited by me)\\nSalvago: how to use graphics objects\\nRyan Carlson (me): everything else\", 70, 80);\n        \n        textFont(FONT, 25);\n        textAlign(CENTER, BASELINE);\n    }\n    if(menu === \'e\')\n    {\n        if(win)\n        {\n            textAlign(CENTER, BASELINE);\n            fill(189, 72, 72);\n            textSize(40);\n            text(\"YOU WIN!\", 200, 220);\n            if(health < 1)\n            {\n                text(\"YOU DIED!\", 200, 220);\n            }\n        }\n        else\n        {\n            textAlign(CENTER, BASELINE);\n            fill(189, 72, 72);\n            textSize(40);\n            text(\"YOU DIED!\", 200, 220);\n        }\n    }\n    if(menu !== \'m\')\n    {\n        button(\"<\", 80, 285, 35, true);\n        if (overButton)\n        {\n            whichButton = \'m\';\n        }\n    }\n};\n\nvar reset = function()\n{\n    var weaponDurability = 1;\n    var health = 12;\n    var ingame = false;\n    var menu = \'m\';\n    var kills = 0;\n    var mouseState = 0;\n    var oldMouse = mouseState;\n    var gameStarted = false;\n    var overButton;\n    var whichButton;\n    var buttonFill;\n    var putInYet;\n    var itemEquipped = false;\n    var itemIdEquipped = -1;\n    var win = false;\n    findInInv();\n    drawBackground();\n        scale(0.5, 0.5);\n        drawMapBelowHero();\n        drawEnemies();\n        drawNPCs();\n        drawDude(hero);\n        drawStillArrows();\n        drawArrows();\n        drawMapAboveHero();\n        resetMatrix();\n        fill(0, 0, 0, constrain(sin(time - 180) * 255, -100, 100) + 100);\n        rect(0, 0, 400, 400);\n        drawGui();\n};\nvar runPower = function(){\n    if(energy <100){\n        energy+=0.2;\n    }\n    if(hero.running){\n        energy-=5;\n    }\n    if(energy<=0){\n        energy=0;\n    }\n};\nvar checkWin = function()\n{\n    if(!won && enemies.length === 0)\n    {\n        win = true;\n        won = true;\n        menu = \'e\';\n        ingame = false;\n    }\n};\n//throw {message: \"This program is currently bugged. I will fix it soon. :(\"};\nvar draw = function()\n{\n    if(!initialized)\n    {\n        initialize();\n    }\n    if(!gameStarted)\n    {\n        reset();\n    }\n    resetInGame();\n    checkLeftMouse();\n    checkWin();\n    if(!hero.dead && ingame)\n    {\n        update();\n        drawBackground();\n        scale(0.5, 0.5);\n        drawMapBelowHero();\n        drawEnemies();\n        drawNPCs();\n        drawDude(hero);\n        drawStillArrows();\n        drawArrows();\n        drawMapAboveHero();\n        fill(0, 0, 0, constrain(sin(time - 180) * 255, -100, 100) + 100);\n        rect(0, 0, 800, 800);\n        drawPopups();\n        resetMatrix();\n        drawGui();\n        timer();\n    }\n    if(!ingame)\n    {\n        drawMenu();\n    }\n    runPower();\n    if(ingame){\n        fill(255);\n        textSize(20);\n        text(\"Running Energy Left:\",0,100);\n        fill(255, 0, 0);\n        rect(225,95,100,20);\n        fill(0, 255, 0);\n        rect(225,95,energy,20);\n    }\n};";
window.liveEditor = new LiveEditor({
                el: $("#sample-live-editor"),
                code: code,
                width: 400,
                height: 400,
                editorHeight: "80%",
                autoFocus: true,
                workersDir: "../../build/workers/",
                externalsDir: "../../build/external/",
                imagesDir: "../../build/images/",
                soundsDir: "../../sounds/",
                execFile: outputUrl,
                jshintFile: "../../build/external/jshint/jshint.js",
                newErrorExperience: true,
            });
            liveEditor.editor.on("change", function() {
                window.localStorage["test-code"] = liveEditor.editor.text();
            });
            ScratchpadAutosuggest.init(liveEditor.editor.editor);
            </script>
        </body>
        </html>
        