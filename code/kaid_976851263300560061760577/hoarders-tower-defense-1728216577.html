<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Hoarder's Tower Defense</title>
    <link rel="stylesheet" href="../../build/css/live-editor.core_deps.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.audio.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.tooltips.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.ui.css"/>
<style>
        body {
            padding: 20px;
        }
        h1 {
            padding: 0;
            margin: 0 0 20px 0;
        }
        #sample-live-editor {
            padding: 0;
        }
    </style>
</head>
<body>
    <h1>Hoarder's Tower Defense</h1>
    <div id="sample-live-editor"></div>
    <script src="../../build/js/live-editor.core_deps.js"></script>
    <script src="../../build/js/live-editor.editor_ace_deps.js"></script>
    <script src="../../build/js/live-editor.audio.js"></script>
    <script src="../../build/js/live-editor.shared.js"></script>
    <script src="../../build/js/live-editor.tooltips.js"></script>
    <script src="../../build/js/live-editor.ui.js"></script>
    <script src="../../build/js/live-editor.editor_ace.js"></script>
    <script>
    var outputUrl = "../output.html";
var code = "/**Hoarder's Tower Defense by David Elijah de Siqueira Campos McLaughlin\nOriginal size(400, 400);\nOriginally Created on 2013-06-13T00:57:50Z by kaid_976851263300560061760577\nLast Edited: 2013-06-13T00:57:50Z\nVotes/Spinoffs: 2/2\nOriginally Created: 2016-01-27T20:26:45Z from origin 1106141208 with similarity of 0.9522064484340838\nOriginal Link: https://www.khanacademy.org/computer-programming/hoarders-tower-defense/1728216577\nRetrieved On: 07-Nov-2022 (17:06:58.659179)**/\
";

code = code + "\n/** Note: I fixed your problem. I also made one track slightly red and the other slightly blue. */\n\n/* Daily bonuses (see Space Defender) are here!\nThey are in the help!\nCheck the bottom of the code for challenges!\n\nNew Releases: */\n/** I won\'t add any new towers until the larger canvas size thing comes. You can still vote up, though. */\n\n/** Upgrades are back!!! */\n\n// TODO: Make animation for start\n\n// ----- When making spin-offs, you can change this ----- \\\\\nvar author = \"David Elijah McLaughlin\";\nvar slide = 0;\n\n// 0 = playable, 1 = almost ready\nvar underConstruction = 0;\n// Don\'t EVER delete this. If you do, the game will likely not work anyway.\nif (underConstruction) {\n    throw {\n        message: \"This game is under construction and IS NOT PLAYABLE AT THIS TIME. Please wait while I fix some glitches and add more features.\"+((underConstruction === 1) ? \" It will be ready soon.\" : \"\")\n    };\n}\n\n// ----- Colors. Don\'t change these! ----- \\\\\nvar RED = color(255, 0, 0),\n    GREEN = color(0, 255, 0),\n    BLUE = color(0, 0, 255),\n    WHITE = color(255, 255, 255),\n    BLACK = color(0, 0, 0),\n    YELLOW = color(255, 255, 0),\n    TEAL = color(0, 143, 107),\n    PURPLE = color(140, 0, 255),\n    ORANGE = color(255, 132, 0),\n    GREY = color(124,124,124);\n\nbackground(0, 0, 0);\n\nvar fps = 30; // NEVER make this zero.\nframeRate(fps);\n\n// ----- Game constants. Try tweaking these! ----- \\\\\nvar lives = 400,\n    money = 700,\n    \n    track1Color = color(170, 128, 128),\n    track2Color = color(128, 128, 170),\n    \n    PATH_COLOR = GREY,\n    \n    SELLING_RATIO = 0.75,\n    // When you sell a tower, you get this much times the original cost.\n    \n    \n    // ----- Tower prototype objects ----- \\\\\n    // 360 tower. Shoots in all directions. (yellow ship)\n    the360Tower = {\n        range: 60,\n        delay: 40,\n        damage: 7,\n        cost: 220,\n        \n        upgrades: {\n            1: {\n                message: \"40% Longer range\",\n                cost: 140,\n                code: \"range 1.4\"\n            },\n            2: {\n                message: \"Faster fire rate\",\n                cost: 100,\n                code: \"delay 0.7\"\n            },\n            3: {\n                message: \"More bullets\",\n                cost: 100,\n                code: \"bullets 1.5\"\n            }\n        },\n        image: getImage(\"avatars/orange-juice-squid\"),\n        \n        // special properties\n        bullets: 8\n    },\n    \n    // Regular tower (red ship)\n    regTower = {\n        damage: 15,\n        delay: 25,\n        cost: 130,\n        range: 75,\n        \n        upgrades: {\n            1: {\n                message: \"30% longer range\",\n                cost: 90,\n                code: \"range 1.3\"\n            },\n            2: {\n                message: \"50% more damage\",\n                cost: 160,\n                code: \"damage 1.5\"\n            },\n            3: {\n                message: \"50% faster fire rate\",\n                cost: 180,\n                code: \"delay 0.5\"\n            }\n        },\n        image: getImage(\"avatars/marcimus\")\n    },\n    \n    \n    fastTower = {\n        damage: 5,\n        delay: 10, // Don\'t make the delay zero.\n        cost: 310,\n        range: 60,\n        \n        upgrades: {\n            1: {\n                message: \"2x damage\",\n                cost: 280,\n                code: \"damage 2\"\n            },\n            2: {\n                message: \"Fire rate boost (30%)\",\n                cost: 250,\n                code: \"delay 0.7\"\n            },\n            3: {\n                message: \"35% bigger range\",\n                cost: 300,\n                code: \"range 1.35\"\n            }\n        },\n        image: getImage(\"avatars/old-spice-man\"),\n        \n        // special properties\n        spread: 3\n    },\n    \n    // By the way, the computer uses PI for 3.1415926535...\n    // 3.1415926535897932384626433832795028841971...\n    piTower = {\n        damage: 3 * 3.1415926535, // about 9.5 (9.4248)\n        delay: 18,\n        cost: 200,\n        range: 70,\n        \n        upgrades: {\n            1: {\n                message: \"More hits per shot\",\n                cost: 180,\n                code: \"maxHits 1.6\"\n            },\n            2: {\n                message: \"20% more damage\",\n                cost: 100,\n                code: \"damage 1.2\"\n            },\n            3: {\n                message: \"30% faster reload\",\n                cost: 170,\n                code: \"delay 0.7\"\n            }\n        },\n        image: getImage(\"avatars/mr-pink\"),\n        \n        // special properties\n        maxHits: 5\n    },\n    \n    oj = {\n        damage: 6,\n        delay: 20,\n        cost: 270,\n        range: 70,\n        \n        upgrades: {\n            1: {\n                message: \"Longer slowing\",\n                cost: 180,\n                code: \"slowTime 1.6\"\n            }\n        },\n        image: getImage(\"avatars/orange-juice-squid\"),\n        \n        maxHits: 1,\n        slowFactor: 0.5,\n        slowTime: 30\n    },\n    \n    laser = {\n        damage: 1,\n        delay: 1,\n        cost: 4000,\n        range: 40,\n        \n        upgrades: {\n            \n        },\n        \n        spread: 20,\n        shots: 5\n    },\n    \n    // enemies\n    ENEMY_DELAY = 30,\n    \n    rock = {\n        health: 50,\n        speed: 2.2,\n        moneyGain: 4,\n        image: getImage(\"cute/TreeUgly\")\n    },\n    bug = {\n        health: 32,\n        speed: 3.6,\n        moneyGain: 4,\n        image: getImage(\"cute/EnemyBug\")\n    },\n    strong = {\n        health: 175,\n        speed: 1.8,\n        moneyGain: 9,\n        image: getImage(\"cute/ChestClosed\")\n    },\n    star = {\n        health: 600,\n        speed: 0.8,\n        moneyGain: 24,\n        image: getImage(\"avatars/robot_female_3\")\n    },\n    // Backwards enemy has 300 health and 1.8 speed.\n    // It looks like a bug facing backwards.\n    backwards = {\n        health: 300,\n        speed: 1.8, // because it\'s a backwards enemy!\n        moneyGain: 10,\n        image: getImage(\"cute/EnemyBug\")\n    },\n    boss = {\n        health: 1000,\n        speed: 0.7,\n        moneyGain: 200,\n        image: getImage(\"avatars/robot_male_3\")\n    },\n    coinvac = {\n        health: 1000,\n        speed: 0.7,\n        moneyGain: 250,\n        image : getImage(\"cute/ChestOpen\")\n    },\n    knight = {\n      health: 1000,\n      speed: 1,\n      moneyGain: 200,\n      lifeGain: 50,\n      image : getImage(\"avatars/purple-pi\")\n    },\n    superboss = {\n        health: 3000,\n        speed: 0.5,\n        moneyGain: 500,\n        image: getImage(\"space/beetleship\")\n    },\n    \n    // Difficulty ramps-how fast things get hard\n    ENEMY_HEALTH_MULTIPLIER = 1 + (0.070), // per wave\n    \n    \n    // the track!\n    // The system has been completely redesigned and uses the letters L, R, U, and D for left right up down.\n     track = \"DDDLDDRRDDLLLLUURRRRDDLLLLUULDRRRRRRDDLLLLLDDDRRRRRULLLLURRRRULLLLLL\",\n     track2 = \"DDDRDLURURRDLDRDLDLDLLDLLLL\",\n    \n    \n    // Shows current frame number if true\n    DEBUG = true\n;\n// Don\'t worry if you don\'t understand this\nvar rawBug = getImage(\"cute/EnemyBug\");\nvar gfx = createGraphics(rawBug.width,rawBug.height,JAVA2D);\ngfx.beginDraw();\ngfx.background(255, 0);\ngfx.fill(255, 0);\ngfx.translate(rawBug.width, 0);\ngfx.scale(-1, 1);\ngfx.image(rawBug, 0, 0);\ngfx.endDraw();\n\nvar gfx2 = createGraphics(gfx.width, gfx.height, JAVA2D);\ngfx2.beginDraw();\ngfx2.background(255, 0);\ngfx2.image(gfx, 0, 0);\ngfx2.filter(INVERT);\ngfx2.endDraw();\nbackwards.image = gfx2;\n\n\n/** DAILY BONUSES */\n// START OF FUNCTION\n\n// DO NOT CHANGE THIS!!!\n// The 0 in the 6th entry is supposed to be there.\nvar monthCodes = [null, 6, 2, 2, 5, 0, 3, 5, 1, 4, 6, 2, 4];\n\nvar yearCode = function(y) {\n    if (!y) {\n        y = year();\n    }\n    \n    // Our calendar repeats every 400 years.\n    var mod = (round(y / 100) % 4);\n    var modifiers = [0, 5, 3, 1];\n    var yy = y % 100;\n    \n    var yearCode = floor(yy / 4) + yy;\n    return yearCode + modifiers[mod];\n};\n// Note: This returns the day of the week as a NUMBER.\n/** Return Code\n * 0: Sunday\n * 1: Monday\n * 2: Tuesday\n * 3: Wednesday\n * 4: Thursday\n * 5: Friday\n * 6: Saturday\n */\n\nvar dayOfWeek = function(m, d, y) {\n    // If no parameters passed, get current date\n    if (!m) {m = month();}\n    if (!d) {d = day();}\n    if (!y) {y = year();}\n    \n    if (m > 12) {\n        m = (m - 1) % 12 + 1; // puts m in range [1, 12]\n    }\n    \n    return (monthCodes[m] + d + yearCode(y)) % 7;\n};\n\nvar weekdayTexts = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n\n\nvar makeBonus = function() {\n    var value = dayOfWeek();\n    \n    switch (value) {\n    case 0:\n        lives += 80;\n    break;\n    case 1:\n        the360Tower.delay *= 0.8;\n    break;\n    case 2:\n        rock.health *= 0.75;\n        bug.health *= 0.75;\n        strong.health *= 0.75;\n        \n    break;\n    case 3:\n        regTower.range *= 1.25;\n        the360Tower.range *= 1.2;\n        fastTower.range *= 1.2;\n        piTower.range *= 1.25;\n    break;\n    case 4:\n        regTower.cost *= 0.9;\n        the360Tower.cost *= 0.9;\n        fastTower.cost -= 12;\n        piTower.cost *= 0.9;\n    break;\n    case 5:\n        fastTower.delay *= 0.7;\n    break;\n    case 6:\n        ENEMY_DELAY *= 0.8;\n        ENEMY_DELAY = round(ENEMY_DELAY);\n        piTower.range *= 1.3;\n    break;\n    }\n};\nmakeBonus();\n\n\n// Don\'t mess with this.\nvar frame = {\n    c: 0,\n    rate: 60,\n    last: second(),\n\n    cycle: function() {\n        this.c++;\n        if (this.last !== second()) {\n            this.rate = this.c;\n            this.c = 0;\n            this.last = second();\n        }\n    }\n};\n\n// Copied from Slither\nvar reverseTrack = \"\", reverseTrack2 = \"\";\n\nvar enemyStartX = 260; \nvar enemyStartY = -50; // off-screen\nvar enemyEndX = enemyStartX, enemyEndY = enemyStartY;\nvar enemyEndX2 = enemyEndX, enemyEndY2 = enemyEndY;\n\n//var direction = \"south\";\n\n// How far the path goes in each step\nvar stepSize = 40;\n\n\nvar drawTrack = function(track, firstTime) {\n    var xx = enemyStartX;\n    var yy = enemyStartY;\n    // The starting direction of the enemies\n    //var direction = enemyStartDir;\n    \n    strokeWeight(22);\n    stroke(PATH_COLOR);\n    for (var i = 0; i < track.length; i += 1) {\n        var direction = track[i];\n        \n        var nextX = xx;\n        var nextY = yy;\n        if (direction === \"D\") {\n            nextY += stepSize;\n        } else if (direction === \"R\") {\n            nextX += stepSize;\n        } else if (direction === \"U\") {\n            nextY -= stepSize;\n        } else if (direction === \"L\") {\n            nextX -= stepSize;\n        }\n    \n        line(xx, yy, nextX, nextY);\n        xx = nextX;\n        yy = nextY;\n    }\n    if (firstTime === 1) {\n        enemyEndX = xx;\n        enemyEndY = yy;\n    } else if (firstTime === 2) {\n        enemyEndX2 = xx;\n        enemyEndY2 = yy;\n    }\n};\nvar makeReverseTrack = function(track) {\n    var reverseTrack = \"\";\n    for (var i = track.length - 1; i >= 0; i--) {\n        reverseTrack += (\n            (track[i] === \"L\") ? \"R\" :\n            (track[i] === \"R\") ? \"L\" :\n            (track[i] === \"U\") ? \"D\" :\n            (track[i] === \"D\") ? \"U\" : \"\"\n        );\n    }\n    return reverseTrack;\n};\nreverseTrack = makeReverseTrack(track);\nreverseTrack2 = makeReverseTrack(track2);\n\ndrawTrack(track, 1);\ndrawTrack(track2, 2);\n//////////////////////////////////////////////////////////\n// Game variables. Careful, changing these might break stuff!\n\nvar $global = {\n    get:function(p){return(function(){return(this);})()[p];}\n};\nvar Output = $global.get(\"Output\");\n\nvar State = {\n    FILM: -1,\n    SPLASH: 0,\n    WIN: 1,\n    LOSE: 2,\n    GAME: 99,\n    \n    HELP1: 101,\n    HELP2: 102,\n    HELP3: 103,\n    HELP4: 104,\n    HELP5: 105,\n    \n    UPDATES: 130\n};\nState.LOST = State.LOSE;\n\nvar gameState = State.FILM;\n\nvar fastForward = false;\n\nvar waveActive = false;\nvar enemiesOnField = false, messageShown = false;\nvar messageClosed = true;\nvar messageToShow = \"\";\n\nvar paused = false,\n    wave = 0,\n    t = 0,\n    currentWave = \"\",\n    score = 0,\n    finalFrame = 0,\n    enemyCount = 0 // don\'t ask me why\n;\n\nvar invertColors = false;\nvar gameOverMessages = {};\nvar yyy, hhh;\n\n// Fonts\nvar regFont = createFont(\"\", 20);\nvar boldFont = createFont(\" Bold\", 20);\nvar codeFont = createFont(\"monospace\", 20);\nvar fantasyFont = createFont(\"fantasy\", 20);\n\nvar towerPicked = \"\";\n\nvar started = false;\n\nvar enemies = [],\n    towers = [],\n    missiles = []\n;\n\n\n/* ***************************************************\n * WAVES\n * \n * \nThe strings are codes. Key: Dirt = 0, Fly = 1, Junk = 2, Hoarder = 3, Robber Fly = 4, Hal = 5, Coinvac = 6;\n * ALL waves MUST end with \"E\". E is for End.\n * \n * Edit: now you don\'t have to type E at the end.\n * \n * The wave list in words is at the top of the code (e.g. \"10 rocks\").\n *\n * Note: On waves with more than 40 enemies, I use a +\n * to go to the next line. */\nvar waves = [\n   \"\", // Wave 0 is null\n   //    5     10    15    20    25    30    35    40\n   \"80000 10004E\", // wave 1\n   \"00000 00000 00114E\",// wave 2\n   \"00000 00000 00000 00000 11112E\",//wave 3\n   \"50000 00000 00000 00000 00000 00000 11111 11222E\",//wave4\n   \"00011 10001 11000 11100 01110 00111 00011 10003\"+\n   \"11004 11100 01110 001113E\",//wave 5\n    \n   \"11111 11111 11111 11111 11111 11111 11111 11111E\",//wave6\n   \"11111 11111 11111 11111 11111 00000 00000 00000\"+\n   \"00000 44443E\",//wave 7\n  \"21012 10121 01210 12101 21012 11611E\",//wave 8\n   \"11114 11114 11114 11113E\",//wave 9\n   \"32223 32223 323E\",//wave 10\n    \n   \"44444 44444 44444 44444 0000E\",//wave 11\n   \"00110 01100 11001 10011 00110 01100 11001 10011\"+\n   \"22200 33333 00000 700E\",//wave 12\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"11115 11114 11114 11116 11111 11114 11114 11117E\",\n   //wave 13\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"44444E\",//wave 14\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 000005\"+\n   \"E\",//wave 15\n   \n   \"00000 00000 00000 00000 11111 11111 11111 111112\"+\n   \"00000 00000 00000 00000 11111 11111 11111 111112\"+\n   \"00000 00000 00000 00000 11111 11111 11111 111112\"+\n   \"00000 00000 00000 00000 11111 11111 11111 111112\",\n   //wave16\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"11111 11111 11111 11111 00000 00000 00000 00000\"+\n   \"00000 00000E\",//wave 17\n   \"22222 22222 22222 222\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000\",//wave 18\n   \"22222 22222 22222 22222 22222 22222\",//wave 19\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 11111 11111 11111 11111\"+\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"11111 11111 11111 111113E\",//wave 20\n   \n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 22222\"+\n   \"22222 22222 22222 22222 22222 22222 22222 44444\"+\n   \"44444E\",//wave 21\n   \"00112 00112 00112 00112 00112 00112 00112 00112\"+\n   \"00112 00112 00112 00112 00112 00112 00112 00112\"+\n   \"00112 00112 00112 00112E\",//wave 22 I used copy+paste\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"11111 11111 22222 22222 22222 22222 22222 22222\",//wave23\n   // wave 24 is sorted in groups of 6, not 5\n   \"010010 022001 010010 022001 010010 022001 010010 022001\"+\n   \"010010 022001 010010 022001 010010 022001 010010 022001\"+\n   \"010010 022001 010010 022001 010010 022001 010010 022001\"+\n   \"010010 022001 010010 022001 010010 022001\",//wave 24\n   \"22222 22222 22222 22222 22222 22222 22222 22222\"+\n   \"22222 22222 11111 11111 11111 11111 00000 00000\"+\n   \"00000 00000 00000 000003\",//wave 25\n   \n   \"22222 22222 22222 22222 22222 22222 22222 22222\"+\n   \"22222 22222 22222 22222 22222 22222 22222 22222\",//wave26\n   \"000001000001000001000001000001000001000001000001\"+\n   \"000001000001000001000001000001000001000001000001\"+\n   \"000001000001000001000001\",//wave 27\n   \"222220222221222220222221222220222221222220222221\"+\n   \"222220222221222220222221222220222221222220222221\"+\n   \"222220222221222220222221\",//wave 28\n   \"00011 00011 00011 00011 00011 00011 00011 00011\"+\n   \"00011 00011E\",//wave 29\n   \"00011 00011 00011 00011 00011 00011 00011 00011\"+\n   \"00011 00011 00011 000113E\",//wave 30\n   \n   \"012012 012012 012012 012012 012012 012012 012012\"+\n   \"012012 012012 012012 012012 012012 012012 012012\"+\n   \"012012 012012 012012 012012 012012 012012\",//wave 31\n   \"33333 22222 22222 22222 22222 22222\", //wave 32\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"22222 22222 22222 22222 22222 22222 22222 22222\",//wave33\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"00000 00000 00000 00000 00000 00000 00000 00000\"+\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"11111 11111 11111 11111 11111 11111 11111 11111\"+\n   \"22222 22222 22222 22222 22222 22222 22222 22222\",//wave34\n   \"00011 00011 00011 00011 00011 00011 00011 00011\"+\n   \"00011 00011 00011 00011 00011 000113E\",//wave 35\n   \n   \"01201 01201 00000 01201 01201 11111 01201 22222\",//wave36\n   \"44444 44444 44444 22222 22222 22222 11111 00000\",//wave37\n   \"00000 11111 22222 44444E\",//wave 38\n   \"00000 00001 00011 00111 01111 11111 11112 11122\"+\n   \"11222 12222 22222 22220 22200 22000 20000 00000\",//wave39\n   \"00000 00100 10001 10101 11011 11111 22222 0123E\",//wave40\n   \n   \"00000 00000 11111 11111 00000 00000 11111 11111\"+\n   \"00000 00000 11111 00000 11111 00000 11111 00000\",//wave41\n   \"22222 22222 22022 22122 21212 20202 22222 22222\"+\n   \"22222 22222 22222 22222 22222 22222 22222 22222\",//wave42\n   \"33333 33333 22222 22222 11111 11111 00000 00123\",//wave43\n   \"01234 01234 01234 01234 01234 01234\",//wave44\n   \"E\"\n];\n\n/** WAVE MESSAGES\n * After you beat a wave, you get a message.\n */\n/*var messages = [\"\",\n\"Next wave: 12 dirt and 3 flies. Click the x to close. Space to go to the next wave.\",\n\"Next wave: 20 rocks and 5 bugs. Hold shift to speed up\",\n\"Next wave: 30 rocks and 10 bugs.\",\n\"Next wave: 3 rocks and 3 bugs, repeats 10 times. If you wish upon a star...\",\n\"Remember, click the x on the right to close this bar.\",\n\n\"You can hold the L key to gain extra lives. It costs $2 per 1 life.\",\n\"There are \"+(waves.length-1)+\" waves.\",\n\"You might start seeing daily bonuses. Who knows? Only qindiandefence\",\n\"Tower upgrades are usually better than just adding more towers...\",\n\"...but each tower can only be upgraded 3 times.\",\n\n\"Sometimes you won\'t get these little messages.\",\n\"\",\n\"txeN evaw lliw evah a driew ymene. eB luferac (hint: backwards\",\n\"\",\n\"By the way, I might want to use these messages for the help.\",\n\n\"Remember the L thing: hold down L to gain lives.\",\n\"Hold on!\",\n\"You are doing well!\",\n\"You might want to sell your weak towers. To sell, click the tower and press S. You can also upgrade them.\",\n\"The purple towers can hit many enemies with one shot!\",\n\n\"\",\n\"\",\n\"\",\n\"\",\n\"Wow! Wave 25 already! You\'re doing good!\",\n\n\"I\'m running out of ideas for messages.\",\n\"I see you are enjoying this game, pleasae vote up\",\n\"If you have any questions about the game, feel free to ask\",\n\"\",\n\"\"\n\n];\n\n//for (var i = 1; i < waves.length; i++) {\n  //  var wavei = waves[i];\n    //if (wavei[wavei.length - 1] !== \"E\") {\n      //  waves[i] = waves[i] + \"E\";\n    //}\n//}\n*/\n\n// Security mesures, don\'t mess with these!\nvar error = function(text) {\n    Output.handleError({\n        message: text\n    });\n};\nif (track.length < 3) {\n    error(\"The path must have at least three segments.\");\n}\nif (lives <= 0) {\n    error(\"The game must start with some lives.\");\n}\nif (money <= 0) {\n    error(\"Start with at least some money.\");\n}\nif (waves.length < 1) {\n    error(\"Please do at least 1 wave, but probably more.\");\n}\nif (the360Tower.bullets > 800) {\n    error(\"Okay, thanks a lot for trying to crash the program. Please set the360Tower.bullets to something a little lower!\");\n}\nif (fastTower.delay <= 0) {\n    error(\"Please set the fast tower delay to something positive.\");\n}\n\n/** MISSILES */\n\nvar createMissile = function(x, y, dx, dy, theTower) {\n    var missile = {};\n    \n    // Set missile weapon and damage from tower type\n    missile.weapon = theTower.type;\n    missile.enemiesLeft = 1;\n    \n    missile.range = theTower.range + 25;\n    \n    missile.damage = theTower.damage;\n    \n    if (theTower.type === piTower) {\n        missile.enemiesLeft = round(theTower.maxHits);\n        missile.range = theTower.range + 100;\n    }\n    \n    missile.x = x;\n    missile.y = y;\n    missile.dx = dx;\n    missile.dy = dy;\n    \n    missile.enemiesHit = [];\n    \n    missile.dist = 0;\n    missiles.push(missile);\n    return missile;\n};\n\nvar updateMissiles = function() {\n    for (var i = 0; i < missiles.length; i += 1) {\n        var missile = missiles[i];\n        var dx = missile.dx, dy = missile.dy;\n        missile.x += dx;\n        missile.y += dy;\n        \n        missile.dist += sqrt(dx*dx + dy*dy);\n        if (missile.dist >= missile.range) {\n            missiles.splice(i, 1);\n        }\n    }\n};\n\nvar drawMissiles = function() {\n    for (var i = 0; i < missiles.length; i += 1) {\n        var missile = missiles[i];\n        \n        noStroke();\n        \n        switch (missile.weapon) {\n            case regTower:\n                fill(255, 124, 255);\n            break;\n            case the360Tower:\n                fill(255, 124, 0);\n            break;\n            case fastTower:\n                fill(0, 255, 0);\n            break;\n            case piTower:\n                fill(255, 0, 0);\n            break;\n        }\n        \n        ellipse(missile.x, missile.y, 14, 14);\n    }\n};\n\n \n/**********************************************************\n * Utility functions\n **********************************************************/\n\nvar overButton;\nvar drawButton = function(buttonText, x, y, length, color, buttonHeight, __textSize, handCursor){\n    if (!length) {\n        length = textWidth(buttonText) + 10;\n    }\n    overButton = false;\n    var v = 180;\n    var vb = 220;\n    var val = v;\n    \n    noStroke();\n    \n    if (!buttonHeight) {\n        buttonHeight = 22;\n        __textSize = 12;\n    }\n    // Drop Shadow using Alpha\n    fill(0, 0, 0, 100);\n    rect(x - 2, y + 2, length, buttonHeight + 1, 3);\n    if(mouseX >= x && mouseX <= x + length && mouseY >= y && mouseY <= y + buttonHeight){\n        val = vb;\n        overButton = true;\n        if(mouseIsPressed){\n            x -= 2;\n            y += 2;\n        }\n        if (handCursor) {\n            this.cursor(HAND);\n        }\n    }\n\n    strokeWeight(2);\n    // Button Outline Color\n    stroke(100, 0, 150);\n    fill(val);\n    rect(x, y, length, buttonHeight, 2);\n    textAlign(CENTER, CENTER);\n    fill(0);\n    textSize(__textSize);\n    text(buttonText, x + length / 2, y + buttonHeight / 2);\n};\nvar buttonPressed = false;\n\nvar drawRange = function(x, y, radius) {\n    stroke(255, 255, 255, 140);\n    strokeWeight(max(2, radius / 16));\n    fill(255, 255, 255, 70);\n    ellipse(x, y, radius * 2, radius * 2);\n};\n\nvar findClosest = function(x, y) {\n    var closestDist = Infinity;\n    var closestEnemy = null;\n    for (var i = 0; i < enemies.length; i += 1) {\n        var enemy = enemies[i];\n        var distance = dist(x, y, enemy.x, enemy.y);\n        if (distance < closestDist) {\n            closestDist = distance;\n            closestEnemy = enemy;\n        }\n    }\n    \n    return closestEnemy;\n};\n\nvar isValInArray = function(val, array) {\n    if (typeof array !== \"object\") {\n        return val === array;\n    }\n    for (var i = 0; i < array.length; i++) {\n        if (val === array[i]) {\n            return true;\n        }\n    }\n    return false;\n};\n\nvar roundTo = function(num, a) {\n    if (a === 0) {\n        return num;\n    }\n    return (round(num / a) * a);\n};\n\n\n/***********************************************************\n ****************************\n * Enemies\n ****************************\n **********************************************************/\n\nvar createEnemy = function(enemyType) {\n    var newEnemy = {x: enemyStartX, y: enemyStartY},\n    type = (enemyType === 0 || enemyType === \"0\")?rock :\n        (enemyType === 1 || enemyType === \"1\")?bug : \n        (enemyType === 2 || enemyType === \"2\")?strong :\n        (enemyType === 3 || enemyType === \"3\")?star : \n        (enemyType === 4 || enemyType === \"4\")?backwards :\n        (enemyType === 5 || enemyType === \"5\")?boss: \n        (enemyType === 6 || enemyType === \"6\")?coinvac:\n        (enemyType === 7 || enemyType === \"7\")?knight:\n        (enemyType === 8 || enemyType === \"8\")?superboss:\n        0;\n    if (type === 0) {\n        return;\n    }\n    \n    newEnemy.health = type.health;\n    newEnemy.speed = type.speed;\n    \n    newEnemy.moneyGain = type.moneyGain;\n    \n    newEnemy.type = type;\n    newEnemy.image = type.image;\n    \n    enemyCount++;\n    \n    newEnemy.id = enemyCount; // don\'t ask me why\n    \n    if (type === backwards) {\n        newEnemy.x = enemyEndX;\n        newEnemy.y = enemyEndY;\n        if (random() < 0.5) {\n            newEnemy.track = reverseTrack;\n        } else {\n            newEnemy.track = reverseTrack2;\n        }\n    } else {\n        newEnemy.x = enemyStartX;\n        newEnemy.y = enemyStartY;\n        if (random() < 0.5) {\n            newEnemy.track = track;\n        } else {\n            newEnemy.track = track2;\n        }\n    }\n    \n    newEnemy.distTraveled = 0;\n    newEnemy.distLeft = stepSize;\n    newEnemy.direction = newEnemy.track[0];\n    newEnemy.segment = 0;\n    \n    \n    enemies.push(newEnemy);\n    //return newEnemy;\n};\n\n\nvar drawEnemies = function() {\n    for (var count = 0; count < enemies.length; count++) {\n        pushMatrix();\n        var thisEnemy = enemies[count];\n        var img = thisEnemy.image;\n        if (thisEnemy.type === strong) {\n            translate(thisEnemy.x - 30, thisEnemy.y - 40);\n        } else {\n            translate(thisEnemy.x - 25, thisEnemy.y - 56);\n        }\n        scale(0.5, 0.5);\n        \n        image(img, 0, 0);\n        textSize(30);\n        fill(0, 0, 0);\n        textAlign(CENTER, CENTER);\n        if (thisEnemy.type === strong) {\n            text(ceil(thisEnemy.health), 60, 80);\n        } else {\n            text(ceil(thisEnemy.health), 50, 112);\n        }\n        popMatrix();\n        textAlign(LEFT, DOWN);\n    }\n};\n\nvar debugEnemy = function(index) {\n    var enemy = enemies[index];\n    var problem = false;\n    if (typeof enemy !== \"object\") {\n        println(\"Enemy #\"+index+\" is undefined.\");\n        enemies.splice(index, 1);\n        return;\n    }\n    \n    if (typeof enemy.x === \"undefined\" ||\n        typeof enemy.y === \"undefined\") {\n        \n        println(\"Problem has occured with enemy #\"+index+\": Position is undefined\");\n        problem = 1;\n    }\n    \n    if (!enemy.speed) {\n        println(\"Enemy speed is undefined.\");\n        problem = 1;\n    }\n    \n    if (!enemy.image) {\n        println(\"Enemy picture is undefined\");\n        problem = 1;\n    }\n    \n    if (!enemy.type) {\n        println(\"Enemy type is undefined\");\n        problem = 1;\n    }\n    \n    \n    \n    if (enemy.y < -150 || enemy.x < -150) {\n        println(\"The enemies are way off the screen in the\"+\n                ((enemy.y < -150) ? \" y\" : \" x\") + \n        \" direction!\");\n        problem = 1;\n    }\n    \n    if (problem) {\n        enemies.splice(index, 1);\n    }\n};\n\n\n// It works somewhat, but the enemy is off-centered.\nvar updateEnemies = function() {\n    for (var a = enemies.length - 1; a >= 0; a--) {\n        var enemy = enemies[a];\n        var currentDir = enemy.direction;\n        debugEnemy(a);\n                \n        enemy.distTraveled += enemy.speed;\n        enemy.distLeft -= enemy.speed;\n        if (enemy.distLeft < 0) {\n            var nextDir = enemy.track[enemy.segment + 1];\n            // first go back, then turn, then go again\n            // Go back\n            switch (currentDir) {\n            case \"L\":\n                enemy.x -= enemy.distLeft;\n                break;\n            case \"R\":\n                enemy.x += enemy.distLeft;\n                break;\n            case \"U\":\n                enemy.y -= enemy.distLeft;\n                break;\n            case \"D\":\n                enemy.y += enemy.distLeft;\n                break;\n            }\n            // The excess distance is invalid, so take it off the distTraveled\n            // distLeft will be a negative number, so add it\n            enemy.distTraveled += enemy.distLeft;\n            // Turn and go forward\n            enemy.direction = nextDir;\n            switch (nextDir) {\n            case \"L\":\n                enemy.x -= enemy.speed;\n                break;\n            case \"R\":\n                enemy.x += enemy.speed;\n                break;\n            case \"U\":\n                enemy.y -= enemy.speed;\n                break;\n            case \"D\":\n                enemy.y += enemy.speed;\n                break;\n            default:\n                enemy.x -= enemy.speed;\n            }\n            enemy.distLeft = stepSize;\n            enemy.segment++;\n            \n            // ----- End of this case ----- \\\\\n        } else {\n            switch (currentDir) {\n            case \"L\":\n                enemy.x -= enemy.speed;\n                break;\n            case \"R\":\n                enemy.x += enemy.speed;\n                break;\n            case \"U\":\n                enemy.y -= enemy.speed;\n                break;\n            case \"D\":\n                enemy.y += enemy.speed;\n                break;\n            }\n        }\n        \n        if(enemy.distTraveled >= enemy.track.length*stepSize){\n            if(enemy.type === boss){\n               lives -= 150; \n                         enemies.splice(a, 1);\n            } else if(enemy.type === coinvac){\n              money -= 75;\n              lives -= 20;\n            enemies.splice(a, 1);\n            } else if(enemy.type === knight){\n                lives-=(20+enemy.health);\n                            enemies.splice(a, 1); \n            } else if(enemy.type === superboss){\n                lives-=250;\n                money-=150;\n                            enemies.splice(a, 1); \n            } else {\n                          lives -= enemy.health;\n                            enemies.splice(a, 1); \n \n            }\n\n        }\n    }\n};\n\n\n/***********************************************************\n * Towers\n **********************************************************/\n\nvar placeTower = function(x, y, towertype) {\n    if (!towertype) {\n        return;\n    }\n    var type = (towertype === \"reg\") ? regTower :\n        (towertype === \"the360\") ? the360Tower :\n        (towertype === \"fast\") ? fastTower :\n        (towertype === \"pi\") ? piTower : null;\n    if (type === null) {\n        yyy = -800;\n        hhh = 0;\n        return;\n    }\n    if (money < type.cost) {\n        yyy = -800;\n        hhh = 0;\n        return;\n    }\n    var newTower = {};\n    newTower.x = mouseX;\n    newTower.y = mouseY;\n    if (money > type.cost) {\n        newTower.damage = type.damage;\n        newTower.range = type.range;\n        newTower.delay = type.delay;\n        newTower.type = type;\n        newTower.image = type.image;\n        money -= type.cost;\n    }\n    if (type.bullets) {\n        newTower.bullets = type.bullets;\n    }\n    \n    newTower.lastFired = t;\n    \n    newTower.upgrades = type.upgrades;\n    newTower.upgrades[1].upgraded = false;\n    newTower.upgrades[2].upgraded = false;\n    newTower.upgrades[3].upgraded = false;\n    \n    newTower.angle = 0;\n    \n    newTower.totalCost = type.cost;\n    \n    // Reset towerPicked\n    towerPicked = \"\";\n    yyy = -100;\n    hhh = 0;\n    // Then we add the tower\n    towers.push(newTower);\n    //return newTower;\n};\n\nvar drawTowers = function() {\n    for (var count = 0; count < towers.length; count++) {\n        \n        var theTower = towers[count];\n        // Draw all towers above ranges\n        imageMode(CENTER);\n        pushMatrix();\n        if (theTower.type === regTower) {\n            translate(theTower.x, theTower.y);\n            scale(0.4, 0.4);\n            rotate(theTower.angle);\n            image(regTower.image, 15, -25);\n            \n        } else if (theTower.type === the360Tower) {\n            translate(theTower.x + 6.5, theTower.y + -4);\n            scale(0.4, 0.4);\n            image(the360Tower.image, 0, 0);\n        } else if (theTower.type === fastTower) {\n            \n            translate(theTower.x, theTower.y);\n            rotate(theTower.angle);\n            scale(0.32, 0.4);\n            \n            image(fastTower.image, 4.5, -13);\n            \n        } else if (theTower.type === piTower) {\n            \n            translate(theTower.x, theTower.y);\n            scale(0.5, 0.4);\n            image(piTower.image, 0, 0);\n        }\n        popMatrix();\n    }\n    imageMode(CORNER);\n};\n\nvar drawRanges = function() {\n    \n    for (var i in towers) {\n        var theTower = towers[i];\n        drawRange(theTower.x, theTower.y, theTower.range);\n    }\n};\n\n/////////////////////////////////////////////////////////////\n// Problem?\nvar fireTowerMissiles = function() {\n    \n    if (enemies.length === 0) {\n        return;\n    }\n    \n    for (var i = 0; i < towers.length; i++) {\n        var theTower = towers[i];\n        var fire = true;\n        \n        // Wait for the next round to be chambered\n        if(t - theTower.lastFired < theTower.delay) {\n            continue; // Continue to next tower\n        }\n        \n        // If no enemy is close, don\'t fire\n        \n        var x1 = theTower.x;\n        var y1 = theTower.y;\n        var x2, y2;\n        var dx, dy, angle, enemy, distToEnemy, offx, offy;\n        \n        if (theTower.type === regTower) {\n            \n            // Image offsets\n            enemy = findClosest(x1 + 6, y1 - 7); \n                \n            if (enemy === null) {\n                continue;\n            }\n                \n            x2 = enemy.x; y2 = enemy.y;\n            distToEnemy = dist(x1+6,y1-7,x2,y2);\n            \n            if (distToEnemy < theTower.range + 10) {\n    // The +10 is to account for the thickness of the track.\n                angle = atan2(y2-(y1-7), x2-(x1+6));\n                \n                \n                dx = 8 * cos(angle);\n                dy = 8 * sin(angle);\n                createMissile(x1+6, y1-7, dx, dy, theTower);\n            }\n            \n        } else if (theTower.type === the360Tower) {\n            enemy = findClosest(x1, y1);\n            if (enemy === null) {\n                continue;\n            }\n            x2 = enemy.x; y2 = enemy.y;\n            distToEnemy = dist(x1, y1, x2, y2);\n            if (distToEnemy >= theTower.range + 10) {\n                continue;\n            }\n            if (theTower.bullets <= 0) {\n                continue;\n            }\n            for (var j = 0; j < 360; j += (360 / theTower.bullets)) {\n                var speed = 8;\n                dx = speed * cos(j);\n                dy = speed * sin(j);\n                createMissile(x1, y1, dx, dy, theTower);\n            }\n        \n        } else if (theTower.type === fastTower ||\n                   theTower.type === piTower) {\n            enemy = findClosest(x1, y1);\n            if (enemy === null) {\n                continue;\n            }\n            x2 = enemy.x; y2 = enemy.y;\n            distToEnemy = dist(x1, y1, x2, y2);\n            if (distToEnemy < theTower.range + 10) {\n                angle = atan2(y2 - y1, x2 - x1);\n                \n                dx = 10 * cos(angle);\n                dy = 10 * sin(angle);\n                createMissile(x1, y1, dx, dy, theTower);\n            }\n        }\n        theTower.lastFired = t;\n    }\n    \n};\n\nvar updateTowers = function() {\n    for (var count = 0; count < towers.length; count++) {\n        var thisTower = towers[count];\n        var x1 = thisTower.x, y1 = thisTower.y;\n        var range = thisTower.range + 10;\n        if (thisTower.type !== the360Tower) {\n            var closeEnemy = findClosest(thisTower.x, thisTower.y);\n            if (closeEnemy === null) {\n                continue;\n            }\n            var x2 = closeEnemy.x, y2 = closeEnemy.y;\n            if (dist(x1, y1, x2, y2) < range) {\n                var towerAngle = atan2(y2 - y1, x2 - x1);\n                thisTower.angle = towerAngle;\n            }\n        }\n    }\n    fireTowerMissiles();\n    \n};\n\nvar upgradeTower = function(theTower, code) {\n    var a = code.split(\" \");\n    var property = a[0], multiplier = parseFloat(a[1]);\n    theTower[property] *= multiplier;\n};\n\n\n/************************************************************\n * Collisions\n * Need to check when a missile touches the enemy.\n * ...\n */\n\n/** This is the function that attacks an enemy... */\nvar attackEnemy = function(enemy, damage) {\n              \n             enemy.health -= damage;   \n            \n    if (enemy.health > 0) {\n        return;\n    }\n\n    // Gain money\n    money += enemy.moneyGain;\n    if(enemy === knight){\n        lives+=20;\n    }\n};\n\n\n/** ... and it\'s called in this function... */\nvar checkEnemyCollisions = function() {\n    for (var i = missiles.length - 1; i >= 0; i--) {\n        var missile = missiles[i];\n        var mx = missile.x, my = missile.y;\n        for (var j = enemies.length - 1; j >= 0; j--) {\n            var enemy = enemies[j];\n            if (isValInArray(enemy.id, missile.enemiesHit)) {\n                continue;\n            }\n            var ex = enemy.x, ey = enemy.y;\n            if (dist(mx, my, ex, ey) >= 25) {\n                continue;\n            }\n     if (enemy.type === knight) {\n    if (missile.weapon !== piTower&&missile.weapon!== regTower) {\n        continue;\n    }\n}     if(enemy.type === superboss){\n    if(missile.weapon !== the360Tower&&missile.weapon !== fastTower){\n        continue;\n    }\n}  \n            attackEnemy(enemy, missile.damage);\n            if (enemy.health <= 0) {\n                score++;\n                enemies.splice(j, 1);\n            }\n            missile.enemiesLeft--;\n            if (missile.enemiesLeft <= 0) {\n                missiles.splice(i, 1);\n            }\n            \n            missile.enemiesHit.push(enemy.id);\n        }\n    }\n};\n\n\n// Input\n// yyy and hhh are for the width and \n// height of the \"selection rectangle\".\nvar upgrade = false;\nvar towerToUpg = null;\n\nvar mouseClicked = function() {\n    if(mouseX<100 && mouseY>220 && gameState===State.GAME){\n        if (mouseY < 271) {\n            if (towerPicked === \"reg\") {\n                yyy = -100; hhh = 0;\n                towerPicked = \"\";\n                // Clicking the same tower twice negates\n                // your choice\n            } else {\n                yyy = 220; hhh = (271 - 220);\n                towerPicked = \"reg\";\n            }\n            \n        } else if (mouseY > 271 && mouseY < 316) {\n            \n            \n            if (towerPicked === \"the360\") {\n                yyy = -100; hhh = 0;\n                towerPicked = \"\";\n                // Clicking the same tower twice negates\n                // your choice\n            } else {\n                yyy = 271; hhh = (316 - 271);\n                towerPicked = \"the360\";\n            }\n        } else if (mouseY > 316 && mouseY < 352) {\n            if (towerPicked === \"fast\") {\n                towerPicked = \"\";\n                yyy = -200; hhh = 0;\n            } else {\n                towerPicked = \"fast\";\n                yyy = 316; hhh = (352 - 316);\n            }\n            \n        } else if (mouseY > 352 && mouseY < 400) {\n            if (towerPicked === \"pi\") {\n                towerPicked = \"\";\n                yyy = -470; hhh = 0;\n            } else {\n                towerPicked = \"pi\";\n                yyy = 352; hhh = (400 - 352);\n            }\n        }\n    upgrade = false;\n    } else {\n        upgrade = false;\n        towerToUpg = null;\n        yyy = -100; hhh = 1;\n        for (var i = 0; i < towers.length; i++) {\n            var theTower = towers[i];\n            var x = theTower.x, y = theTower.y;\n            if(abs(mouseX-x) < 15 && abs(mouseY-y) < 10) {\n                upgrade = true;\n                towerToUpg = theTower;\n            }\n        }\n        if (!upgrade && (!messageShown || messageClosed)) {\n            \n            placeTower(mouseX, mouseY, towerPicked);\n            upgrade = false;\n            towerToUpg = null;\n        }\n    }    \n};\n\n\nvar towerToUpg;\nvar nextWave;\nvar keyPressed = function() {\n    if (keyCode === SHIFT) {\n        fastForward = true; // Speed up game\n    } else if (keyCode === 76 && money >= 3) {\n        lives += 1;\n        money -= 3;\n    } else if (keyCode === 32 && !waveActive &&\n        wave !== waves.length - 2 && !enemiesOnField) {\n        nextWave();\n        started = true;\n    } else if (started && keyCode === 80) {\n        // 80 is the key code for P\n        paused = !paused;\n    }\n};\n\nvar keyReleased = function() {\n    if (keyCode === SHIFT) {\n        fastForward = false; // Back to normal\n    } else if (keyCode === 73) {\n        invertColors = !invertColors;\n    }\n};\n\n\n// Drawing.\nvar drawFilm = function(){\n    noStroke();\n    if(slide > 0&&slide<90){\n        background(0, 255, 255);\n        fill(0, 0, 0);\n        rect(60,200,80,50);\n        rect(40,250,120,20);\n        fill(255);\n        ellipse(70,270,30,30);\n        ellipse(140,270,30,30);\n        fill(0, 0, 0);\n        ellipse(70,270,27,27);\n        ellipse(140,270,27,27);\n        fill(200, 0, 200);\n        ellipse(200,270,60,60);\n        textSize(30);\n        text(\"Take care of the house while\\nwe\'re gone, OK Marcimus?\",0,30);\n        fill(255, 0, 0);\n        ellipse(260,270,60,60);\n        fill(0, 0, 255);\n        ellipse(170,330,50,50);\n        fill(0, 255, 0);\n        ellipse(230,332.5,45,45);\n        fill(255, 124, 255);\n        ellipse(290,332.5,45,45);\n    }\n   \n    if(slide >89&&slide<120){\n        background(0, 255, 255);\n        image(getImage(\"avatars/marcimus\"),100,100);\n        fill(255);\n        textSize(30);\n        text(\"Yes sir!\",0,30);\n    }\n    if(slide >119&&slide<180){\n       background(0, 255, 255);\n       image(getImage(\"avatars/marcimus\"),100,100);\n       image(getImage(\"cute/TreeUgly\"),200,200);\n       fill(124, 255, 124);\n       triangle(200,175,300,200,200,250);\n       fill(255);\n       textSize(30);\n       text(\"Eww!\",0,30);\n    }\n    if(slide >179&&slide<270){\n       background(0, 255, 255);\n       image(getImage(\"cute/EnemyBug\"),100,100);\n       image(getImage(\"avatars/orange-juice-squid\"),200,100);\n       fill(255);\n       textSize(30);\n       text(\"How big can flies get?\",0,30);\n    }\n    slide +=1;\n    if(slide>270&&slide<360){\n        background(0);\n        fill(255);\n        textSize(50);\n        text(\"HOARDER\'S TD\",0,50);\n    }\n};\nvar drawSplash = function() {\n    //image(backwards.image, 0, 0);\n    textSize(30);\n    fill(255, 255, 255);\n    text(\"Hoarder\'s\", width/2 - 100, height/2 - 100);\n    pushMatrix();\n    translate(width/2 - 60, height/2 - 25);\n    rotate(-20);\n    fill(51, 255, 0);\n    textSize(40);\n    text(\" Tower Defense\", -50, 0);\n    popMatrix();\n    fill(255, 255, 255);\n    textSize(12);\n    if (author === \"qindiandefence\") {\n        text(\"Made by qindiandefence\", 3, 3, width, height);\n        textAlign(CENTER, CENTER);\n        textSize(15);\n        text(\"If you vote down,\\nPLEASE tell me why.\", width/2 + 50, 30);\n    } else {\n        text(\"Original by qindiandefence\\nSpin-off by \"+author, 3, 3, width, height);\n        fill(255, 255, 255);\n        textAlign(CENTER, CENTER);\n        textSize(20);\n        text(\"Johnny Robot Games present:\", 200, 50);\n    }\n    var xpos = width/2 - 77, ypos = height/2 + 50;\n    pushMatrix();\n    translate(xpos, ypos - 66);\n    scale(0.5, 0.5);\n    image(fastTower.image, 0, 0);\n    image(rock.image, 380, 15);\n    popMatrix();\n    \n    \n    var offset = 14;\n    var size = 20;\n    fill(0, 64, 0);\n    noStroke();\n    ellipse(xpos + 124, ypos, size-3, size-3);\n    fill(0, 128, 0);\n    ellipse(xpos + 124 + offset, ypos, size-2, size-2);\n    fill(0, 192, 0);\n    ellipse(xpos + 124 + 2*offset, ypos, size-1, size-1);\n    fill(0, 255, 0);\n    ellipse(xpos + 124 + 3*offset, ypos, size, size);\n    \n    \n    var y2 = height - 80;\n    var w = 100, h = 40;\n    offset = 120; \n    var x = width/2 - 50;\n    fill(255, 255, 255);\n    noStroke();\n    drawButton(\"Easy\", x - offset, y2 - h/2, w, 0xFFFFFFFF, h, 20, true);\n    if (mouseIsPressed && overButton) {\n        gameState = State.GAME;\n    }\n    \n    drawButton(\"Medium\", x, y2 - h/2, w, 0xFFFFFFFF, h, 20, true);\n    if (mouseIsPressed && overButton) {\n        gameState = State.GAME;\n        money *= 1.3;\n        rock.moneyGain *= 0.75;\n        bug.moneyGain *= 0.75;\n        strong.moneyGain *= 0.75;\n    }\n    \n    drawButton(\"Hard\", x + offset, y2 - h/2, w, 0xFFFFFFFF, h, 20, true);\n    if (mouseIsPressed && overButton) {\n        gameState = State.GAME;\n        rock.health *= 1.4;\n        bug.health *= 1.4;\n        strong.health *= 1.4;\n        backwards.health *= 1.4;\n        lives *= 0.75;\n    }\n    \n    \n    drawButton(\"Help\", x, y2 + h/2 + h/4, w, 0xFFFFFFFF, h, 20, true);\n    \n    if (mouseIsPressed && overButton) {\n        gameState = State.HELP1;\n    }\n    \n    drawButton(\"Updates\", width - 60, height - 30, 60, 0, 30, 12, true);\n    if (overButton && mouseIsPressed) {\n        gameState = State.UPDATES;\n    }\n    drawButton(\"Do not click\", 4, height - 26, 0, 0);\n    if (overButton && mouseIsPressed) {\n        error(\"I told you not to click! Who ever listens to me?\");\n        error(\"Click restart, and this time, don\'t click that \\\"Do not click\\\" button!\");\n    }\n    fill(0);\n    textSize(20);\n    textAlign(LEFT, DOWN);\n    \n    mouseIsPressed = false;\n};\nvar drawTowerInfo;\nvar drawHelp = function() {\n    if (isValInArray(gameState, [State.HELP1, State.HELP2, State.HELP3, State.HELP4, State.HELP5, State.UPDATES])) {\n        image(getImage(\"space/background\"), 0, 0, width, height);\n    }\n    switch (gameState) {\n    case State.HELP1:\n        textFont(regFont, 25);\n        textAlign(CENTER, CENTER);\n        fill(0, 0, 0);\n        if (author === \"qindiandefence\") {\n            text(\"Help for The Ultimate TD\", width/2, 30);\n        } else {\n            textSize(20);\n            text(\"Help for Hoarder\'s\\nTower Defense\", width/2, 40);\n        }\n        \n        textAlign(LEFT, DOWN);\n        textSize(14);\n        text(\"The Basics\\n\\nClick the tower icons in the lower left corner to select towers.\", 7, 60, 400, 200);\n        \n        pushMatrix();\n        noStroke();\n        translate(0, -100);\n        textFont(regFont, 15);\n        drawTowerInfo();\n        popMatrix();\n        \n        textFont(regFont, 15);\n        text(\"Then click on the screen to place a tower. To select a different tower, click that tower icon. To deselect a tower icon, click the icon again.\", 100, 124, 300, 400);\n        textSize(14);\n        text(\" Basic Enemies:\\nMold: \"+rock.health+\" health points (HP), \"+rock.speed+\" speed.\\nJust a basic enemy.\\nFly: \"+bug.health+\" HP, \"+bug.speed+\" speed.\\nFaster but weaker.\\nJunk: \"+strong.health+\" HP, \"+strong.speed+\" speed. Very new\\nand strong garbage.\\nRobber Fly: \"+backwards.health+\" HP, \"+(-backwards.speed)+\" speed.\\nSteals Garbage bags (goes backwards).\\nHoarder (Grace): \"+star.health+\" HP first time,\\nincreases by 100 every wave.\\nVERY slow: \"+star.speed+\" speed\", 130, 200, 270, 400);\n        image(rock.image, 100, 197, 30, 50);\n        image(bug.image, 100, 232, 30, 50);\n        image(strong.image, 100, 280, 30, 30);\n        image(backwards.image, 100, 292, 30, 50);\n        image(star.image, 100, 337, 30, 40);\n        \n        textFont(boldFont, 12);\n        drawButton(\"Back\", 10, height-40, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.SPLASH;\n        }\n        drawButton(\"Next\", width-70, height-40, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP2;\n            mouseIsPressed = false;\n        }\n    break;\n    case State.HELP2:\n        textFont(boldFont, 20);\n        textAlign(CENTER, CENTER);\n        text(\"Towers and Powers\", width/2, 30);\n        pushMatrix();\n        translate(50, 90);\n        scale(0.5, 0.5);\n        imageMode(CENTER);\n        image(regTower.image, 0, 0);\n        image(the360Tower.image, 0, 150);\n        image(fastTower.image, 0, 300);\n        image(piTower.image, 0, 450);\n        imageMode(CORNER);\n        popMatrix();\n        var fastDelay = ceil(max(1, fastTower.delay));\n        \n        textFont(regFont, 13);\n        textAlign(LEFT, DOWN);\n        text(\" I am Marcimus. My dust pans inflict \"+regTower.damage+\" damage points. My reload time (delay) is about \"+(regTower.delay / fps).toFixed(2)+\" seconds, and my range is \"+(regTower.range/width*100).toFixed(0)+\"% of the screen width. I have no special tricks.\", 100, 68, width-120, 100);\n        text(\"I am O.J. Squid. I can do \"+the360Tower.damage+\" damage per ink squirt. My delay is about \"+(the360Tower.delay / fps).toFixed(2)+\" seconds, and my range is \"+(the360Tower.range/width*100).toFixed(0)+\"% of the screen width. I can shoot in \"+the360Tower.bullets+\" directions at once!\", 100, 148, 280, 100);\n        text(\"I am Old Spice Man. My special books deal \"+fastTower.damage+\" damage points. I can shoot \"+(fps / fastDelay).toFixed(0)+\" shots per second, and my range is \"+(fastTower.range/width*100)+\"% of screen width. I am known for being able to hit things fast.\", 100, 223, 285, 100);\n        text(\"I am Fuzzy (My real name is Mr. Pink). My sneezes take away about \"+piTower.damage.toFixed(1)+\" HP from the enemy. My delay is about \"+(piTower.delay / fps).toFixed(2)+\" seconds, and my range is \"+(piTower.range/width*100).toFixed(0)+\"%. I can hit \"+piTower.maxHits+\" enemies with one big sneeze!\", 100, 298, 280, 100);\n        \n        textFont(boldFont, 12);\n        drawButton(\"Back\", 10, 360, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP1;\n            mouseIsPressed = false;\n        }\n        drawButton(\"Next\", 330, 360, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP3;\n            mouseIsPressed = false;\n        }\n    break;\n    case State.HELP3:\n        textFont(boldFont, 25);\n        text(\"Upgrades & Bosses\", 200, 40);\n        textFont(regFont, 16);\n        textAlign(LEFT, DOWN);\n        text(\"When a tower is selected, you see upgrades on the right. Click on the buttons to select an upgrade. Each tower has its own upgrades.\\n\\n\\nBosses are enemies with special abilities. They all have 1000 base HP and are very slow.\\n        Hal: A Super Hoarder. If he gets past into the                   house, he will inflict 150 damage no matter what.\\n\\n         Coinvac: Steals 75 money at the house. Will also\\n         inflict 20 damage breaking into the house.\", 10, 100, 380, 400);\n        image(boss.image,0,225,45,45);\n        image(coinvac.image,0,265,45,55);\n        \n        fill(255);\n        textAlign(CENTER, CENTER);\n        textFont(boldFont, 20);\n        //text(\"Upgrades are out of order.\\nBecause of this, I let towers\\nhave longer range.\", 200, 200);\n        \n        drawButton(\"Back\", 10, 360, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP2;\n            mouseIsPressed = false;\n        }\n        drawButton(\"Next\", 330, 360, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP4;\n            mouseIsPressed = false;\n        }\n    break;\n    case State.HELP4:\n        textFont(boldFont, 25);\n        text(\"Royal Bosses\", 200, 40);\n        textFont(regFont, 16);\n        textAlign(LEFT, DOWN);\n        text(\"Bosses are enemies with special abilities. They all have 1000 base HP and are very slow.\\n \\n       Knight: He works for the king. These corrupt heroes\\n       have a base damage of 20 and added to that is \\ntheir health, which supports the base damage. He will\\ndrop his health potion when killed and give 20 lives!\\nHis armor also makes him immune to some towers.\\n       King (Superboss): A mutated boss with 3000 HP.\\n         He is a mix of other bosses, but his extra health\\nallows him to inflict 250 damage (Hal), steal 150 coins\\n(Coinvac) and can withstand Marcimus and Fuzzy. \", 10, 100, 380, 400);\n        image(knight.image,0,150,40,40);\n        image(superboss.image,0,230,60,60);\n        drawButton(\"Back\", 10, 360, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP3;\n            mouseIsPressed = false;\n        }\n              drawButton(\"Next\", 330, 360, 60, color(255, 255, 255), 30, 16, true);\n                      if (overButton && mouseIsPressed) {\n            gameState = State.HELP5;\n            mouseIsPressed = false;\n        }\n    break;\n    case State.HELP5:\n                fill(0, 0, 0);\n        textAlign(CENTER, CENTER);\n        textSize(30);\n        text(\"Daily Bonuses:\", 200, 50);\n        textAlign(LEFT, TOP);\n        textSize(18);\n        text(\"Sunday: +80 lives.\\nMonday: 360 towers shoot 20% faster.\\nTuesday: Enemies have less HP.\\nWednesday: Towers have longer range.\\nThursday: Towers are less expensive.\\nFriday: Fast towers shoot even faster.\\nSaturday: Enemies are packed more closely. Purple Pi towers have longer range.\\nOriginal game by qindiandefense\", 20, 100, 360, 200);\n                drawButton(\"Back\", 10, 360, 60, color(255, 255, 255), 30, 16, true);\n        if (overButton && mouseIsPressed) {\n            gameState = State.HELP4;\n            mouseIsPressed = false;\n        }\n    break;\n    \n    \n    // ---- Technically, this isn\'t help, but oh well ---- \\\\\n    case State.UPDATES:\n        fill(255, 255, 0);\n        textAlign(CENTER, CENTER);\n        textSize(20);\n        text(\"Update Log\", width/2, 30);\n        textAlign(LEFT, TOP);\n        textSize(13);\n        text(\n\"v10.1: Created update log.\\n\"+\n\"v11.2.5: Completely redesigned the track system.\\n\"+\n\"v11.3: Changed starting screen a little.\\n\"+\n\"v11.3.2: Added nonworking help.\\n\"+\n\"v11.3.3: Added drawButton func\"+\"tion and help.\\n\"+\n\"v11.4.1: Added space background and n\"+\"ew track color.\\n\"+\n\"v11.4.2: Fixed typos in help.\\n\"+\n\"v11.4.4: Added \\\"Towers and Powers\\\" in help.\\n\"+\n\"v11.4.7: Added a few more waves.\\n\"+\n\"v11.5: Doubled all money, and changed things.\\n\"+\n\"v11.6: Started to change the upgrade system.\\n\"+\n\"v12.0: Restored upgrades, and made a n\"+\"ew system of the level messages.\\n\"+\n\"v13.0: Changed some things in Towers and Powers, and fixed the backwards enemy. Moved update log to here.\\n\"+\n\"v13.1: Fixed glitch with fast tower. Merged the code for the fast tower and pi tower in fireTowerMissiles() because they were the same.\\n\"+\n\"v13.1.3: Added a \'do not click\' button for jokes. Also moved the \\\"Challenges / Next Steps\\\".\", 5, 50, width - 10, height);\n    \n    drawButton(\"Back\", 10, height - 32, 0, 0, 22, 12, true);\n    if (overButton && mouseIsPressed) {\n        gameState = State.SPLASH;\n        mouseIsPressed = false;\n    }\n    fill(255, 0, 0);\n    drawButton(\"Challenges / Next steps\\nIdeas for spin-offs\", width - 150, height - 42, 140, 0, 32, 12, true);\n    if (overButton && mouseIsPressed) {\n        gameState = \"next steps\";\n        mouseIsPressed = false;\n    }\n    break;\n    case \"next steps\":\n        fill(255, 255, 0);\n        textAlign(CENTER, CENTER);\n        text(\"CHALLENGES / NEXT STEPS\", width/2, 20);\n        textAlign(LEFT, TOP);\ntext(\"1. Try to make a split track. At the split, some enemies go one way and some go another way. It can be random or alternating.\\n\"+\n\"Hint: Try two track strings and set the enemy\\\'s track in createEnemy().\\n\"+\n\"2. Make a player-controlled tower (e.g. shoots toward mouse)\\n\"+\n\"Hint: Use mouseX and mouseY\\n\"+\n\"3. Make it so the EMH (easy medium hard) also selects the track.\\n\"+\n\"Hint: Try three track strings.\\n\"+\n\"And more!\\n\\n\\n\\nClick to exit and return to the starting screen\", 10, 60, width - 20, height);\nif (mouseIsPressed) {\n    gameState = State.SPLASH;\n    mouseIsPressed = false;\n}\n    break;\n    default:\n    break;\n    }\n    textFont(regFont, 12);\n};\n\n/*gameState = State.WIN;\nscore = floor(random(2000, 8000));\nfinalFrame = floor(random(0, 50000));\nupdateStep = finalFrame;*/\nvar drawWin = function() {\n    \n    background(0, 0, 0);\n    imageMode(CENTER);\n    for (var i = 0; i < 15; i++) {\n        var thisImage = (i % 3 === 0) ? regTower.image :\n        (i % 3 === 1) ? the360Tower.image : fastTower.image;\n        image(thisImage,\n            165 + 100 * sin(87.2 * i) + (10 * i + 40 * sin(0.2 * (i+1) * finalFrame)),\n            ((577*i) % 300)+60 + 40*cos(17.8*finalFrame),\n            80, 80\n        );\n    }\n    \n    imageMode(CORNER);\n    \n    textSize(60);\n    fill(0, 255, 0);\n    textAlign(CENTER, CENTER);\n    text(\"You win!!\", 200, 50);\n    \n    textSize(20);\n    fill(255);\n    textAlign(LEFT, CENTER);\n    //This part is sort of copied from Mercury Subspace.\n    text(\"For deleting\", 40, 120);\n    text(\"enemies, you kept the house clean!\", 40, 270);\n    \n    \n    textSize(70);\n    text(min((t - finalFrame) * 53, score),40,205);\n    \n    textAlign(LEFT, DOWN);\n    \n    strokeWeight(3);\n    stroke(0, 255, 255);\n    noFill();\n    var y = 373;\n    arc(267, y, 200, 200, -30, 0);\n    fill(0, 255, 255);\n    triangle(367, y + 15, 375, y, 359, y);\n    textSize(14);\n    pushMatrix();\n    translate(320, y - 45);\n    rotate(-30);\n    text(\"Play again!\", -3, 0);\n    popMatrix();\n};\n\nvar verbs = [\n    \"You deleted\",\n    \"You destroyed\",\n    \"You canceled\",\n    \"You exploded\",\n    \"You removed\",\n    \"You crushed\",\n    \"You defended\",\n    \"You wiped out\",\n    \"You annihilated\",\n    \"You survived\"\n];\n\nvar nouns = [\n    \"enemies!\",\n    \"bad things!\",\n    \"baddies!\",\n    \"hazards!\",\n    \"problems!\"\n];\nvar ehm = ENEMY_HEALTH_MULTIPLIER;\nvar percent = round((ehm - 1) * 100 * 10) / 10;\nvar tips = [\n    \"The 360 towers and the purple pi towers\\n\"+\n    \"are usually the best near the end.\",\n    \"The enemies\' health grow exponentially,\\n\"+\n    \"by \"+percent+\"% per wave.\",\n    \"Press and hold shift to speed up the game.\",\n    \"Try to place towers so they cover more room.\",\n    \"If there is a loop in the track, place a\\n\"+\n    \"360 tower in the middle of the loop.\"\n];\n\nvar drawLose = function() {\n    background(0, 0, 0);\n    textSize(40);\n    fill(255, 0, 0);\n    textAlign(LEFT, CENTER);\n    text(\"Aww man!\\nYou\'re a hoarder!\", 40, 60);\n    \n    textSize(20);\n    fill(255);\n    textAlign(LEFT, CENTER);\n    \n    //This part is sort of copied from Mercury Subspace.\n            \n    text(gameOverMessages.verb, 40, 150);\n    text(gameOverMessages.noun, 40, 250);\n    \n    textSize(70);\n    var speed = 7;\n    if (wave <= 10) {speed = 7;}\n    else if (wave > 10 && wave <= 18) {speed = 17;}\n    else if (wave > 18 && wave <= 25) {speed = 33;}\n    else {speed = 47;}\n    \n    text(min((t - finalFrame) * speed, score), 40, 200);\n    \n    textAlign(LEFT, DOWN);\n    textSize(14);\n    fill(255, 255, 0);\n    text(\"Tip: \"+gameOverMessages.tip, 40, 290);\n    \n    strokeWeight(3);\n    stroke(0, 255, 255);\n    noFill();\n    var y = 373;\n    arc(267, y, 200, 200, -30, 0);\n    fill(0, 255, 255);\n    triangle(367, y + 15, 375, y, 359, y);\n    pushMatrix();\n    translate(320, y - 45);\n    rotate(-30);\n    text(\"Try again!\", 0, 0);\n    popMatrix();\n};\n\nvar drawInfo = function() {\n    textAlign(LEFT, DOWN);\n    fill(255, 255, 255);\n    noStroke();\n    rect(0, 0, 125, 80);\n    fill(0);\n    textSize(12);\n    text(\"Money: \"+round(money)+\"\\nWave: \"+wave+\"\\nLives: \"+round(lives), 7, 14);\n    if (!started) {\n        text(\"Press SPACE to start!\", 7, 49, 111, 30);\n    } else {\n        if (!waveActive && enemies.length === 0) {\n            fill(0, 200, 0);\n        } else {\n            fill(255, 0, 0);\n        }\n        text(\"Press SPACE for the next wave!\", 7, 49, 111, 30);\n    }\n    if (DEBUG) {\n        textSize(12);\n        fill(255, 255, 255);\n        rect(0, 47, 125, 33);\n        fill(0, 0, 0);\n        text(\"Frame: \"+t, 10, 59);\n        text(\"Mouse: (\"+mouseX+\", \"+mouseY+\")\", 10, 73);\n    }\n};\n\nvar drawTowerInfo = function() {\n    textSize(15);\n    fill(255);\n    var w = 93, y = 220;\n    rect(0, y, w, 400 - y);\n    image(regTower.image, -6, 202, 70, 70);\n    image(the360Tower.image, 0, 250, 68, 68);\n    image(fastTower.image, -2, 297, 58, 69);\n    image(piTower.image, 3, 354, 49, 41);\n    fill(0);\n    text(regTower.cost, 59, 254);\n    text(the360Tower.cost, 59, 299);\n    text(fastTower.cost, 59, 341);\n    text(piTower.cost, 59, 378);\n    noFill();\n    strokeWeight(4);\n    stroke(0, 0, 255);\n    rect(0, yyy, w, hhh);\n};\n//drawTrack();\n\nvar drawUpgrades = function() {\n    if (towerToUpg === null  ||  !upgrade) {\n        return;\n    }\n    stroke(255, 0, 0);\n    fill(0, 0, 255, 50);\n    ellipse(towerToUpg.x, towerToUpg.y, 60, 60);\n    \n    var left = 313;\n    stroke(255, 255, 255);\n    strokeWeight(3);\n    line(left, 0, left, 400);\n    noStroke();\n    fill(0, 0, 0, 167);\n    rect(left + 2, 0, 100, 500);\n    fill(255, 255, 0);\n    textSize(12);\n    textAlign(CENTER, CENTER);\n    text(\"UPGRADES \\nClick the buttons to upgrade.\", left + 2, 10, width - left, 66);\n    \n    for (var num in towerToUpg.upgrades) {\n        textAlign(LEFT, DOWN);\n        var cannotUpgrade = true;\n        var upg = towerToUpg.upgrades[num];\n        if (upg.upgraded || upg.cost > money) {\n            fill(255, 0, 0);\n            cannotUpgrade = true;\n        } else {\n            fill(0, 255, 0);\n            cannotUpgrade = false;\n        }\n        text(\"#\"+num+\": \"+upg.message, \n             left + 5, // x\n             20 + (num * 80), // y\n             (width - left) - 10, // width of the text-box\n             40 // height of box\n        );\n        drawButton(\"Cost: \"+upg.cost, left + 10, 52 + (num * 80), 60, 0, 22, 12, true);\n        if (overButton && mouseIsPressed) {\n            if (!cannotUpgrade) {\n                upgradeTower(towerToUpg, upg.code);\n                money -= upg.cost;\n                upg.upgraded = true;\n                upgrade = false;\n                towerToUpg.totalCost += upg.cost;\n            }\n        }\n    }\n    \n    var sellGain = towerToUpg.totalCost * SELLING_RATIO;\n    drawButton(\"Sell for:\\n$\"+(sellGain.toFixed(2)), left + 10, height - 50, (width - left) - 20, 0, 34, 12, true);\n    if (overButton && mouseIsPressed) {\n        money += sellGain;\n        upgrade = false;\n        towers.splice(towers.indexOf(towerToUpg), 1);\n    }\n};\n\nvar progress = 0; // which enemy in the wave\nnextWave = function() {\n    wave++;\n    if (typeof waves[wave] !== undefined &&\n        typeof waves[wave] !== \"undefined\") {\n        currentWave = waves[wave];\n        waveActive = true;\n        progress = 0;\n        \n        rock.health *= ENEMY_HEALTH_MULTIPLIER;\n        bug.health *= ENEMY_HEALTH_MULTIPLIER;\n        strong.health *= ENEMY_HEALTH_MULTIPLIER;\n        star.health += 100;\n    }\n};\n\n/*var message = function() {\n    if (!messages[wave]) {\n        messages[wave] = \"\";\n    }\n    var moneyGain = 60 + wave;\n    messageToShow = \"Wave \"+(wave)+\" passed. \"+moneyGain+\" money earned.\\n\"+messages[wave];\n    money += moneyGain;\n    messageShown = true;\n    messageClosed = false;\n};*/\n\nvar timer = function() {\n    if (enemies.length === 0) {\n        enemiesOnField = false;\n    }\n    if (!waveActive) {\n        return;\n    }\n    if (t % ENEMY_DELAY === 0) {\n        var enemyCode = currentWave[progress];\n        if (enemyCode === \"E\") {\n            waveActive = false;\n        } else if (enemyCode === \" \") {\n            enemyCode = currentWave[progress+1];\n            if (enemyCode === \"E\") {\n                waveActive = false;\n            } else {\n                progress++;\n                createEnemy(enemyCode);\n                enemiesOnField = true;\n                messageShown = false;\n            }\n        } else {\n            createEnemy(enemyCode);\n        }\n        progress++;\n    }\n};\n\nvar transitionStates = function() {\n    if (gameState === State.GAME && lives <= 0) {\n        gameState = State.LOST;\n        finalFrame = t;\n        \n        gameOverMessages = {\n            verb: verbs[floor(random() * verbs.length)],\n            noun: nouns[floor(random() * nouns.length)],\n            tip: tips[floor(random() * tips.length)]\n        };\n    }\n    else if(gameState === State.GAME && \n        wave >= waves.length - 2 && !waveActive &&\n        enemies.length === 0) {\n        gameState = State.WIN;\n        finalFrame = t;\n    }\n    if (!messageShown && enemies.length === 0 && wave) {\n        //message();\n        messageShown = true;\n    }\n};\n\n\n\n/********* MAIN GAME LOOP *******************************\n * All the updating functions (updateEnemies, updateTowers, \n * etc) go in this function, update().\n * All the drawing functions (drawEnemies, drawTowers, etc)\n * go in drawGame();\n ***********************************************************/\n\nvar update = function() {\n    updateTowers();\n    \n    updateEnemies();\n    updateMissiles();\n    \n    checkEnemyCollisions();\n    \n    timer();\n    \n    t++;\n};\n\nvar drawGame = function() {\n    PATH_COLOR = track1Color;\n    drawTrack(track, false);\n    PATH_COLOR = track2Color;\n    drawTrack(track2, false);\n    drawRanges();\n    drawEnemies();\n    drawTowers();\n    drawMissiles();\n    \n    drawInfo();\n    drawTowerInfo();\n    drawUpgrades();\n    \n    \n    if (DEBUG) {\n        fill(255, 255, 255);\n        textAlign(LEFT, DOWN);\n        if (enemies[0]) {\n            text(\"First enemy position: (\"+enemies[0].x.toFixed(0)+\", \"+enemies[0].y.toFixed(0)+\")\", 122, 380);\n        }\n    }\n    \n    if (messageShown && !messageClosed) {\n        var opacity = 200;\n        fill(255, 255, 255, opacity);\n        stroke(0, 0, 0, 150);\n        strokeWeight(4);\n        rect(-100, height - 80, width + 200, 200);\n        fill(0, 0, 0);\n        textSize(16);\n        text(messageToShow, 10, height - 70, (width - 20), 60);\n        drawButton(\"Close\", width - 45, height - 70, 40, 0, 22, 12, true);\n        if (overButton && mouseIsPressed) {\n            messageClosed = true;\n        }\n    }\n};\n\n\n// The draw loop!\nvar draw = function() {\n    this.cursor(ARROW);\n    frame.cycle();\n    status(\"Money: \"+money + \"  Wave: \"+wave + \"  Lives: \"+lives);\n    background(0, 0, 0);\n    if (gameState === State.GAME) {\n        image(getImage(\"space/background\"), 0, 0, 400, 400);\n        fill(255, 255, 255, 30);\n        noStroke();\n        rect(0, 0, 400, 400);\n    }\n    if(slide>360){\n    gameState=State.SPLASH;\n    }\n    if (gameState === State.SPLASH) {\n        drawInfo();\n        drawTowerInfo();\n        drawGame();\n    } else if (gameState === State.SPLASH) {\n        drawSplash();\n    } else if (gameState === State.WIN) {\n        drawWin();\n        t++;\n    } else if (gameState === State.LOST) {\n        drawLose();\n        t++;\n    } else if (gameState === State.FILM){\n        drawFilm();\n    }\n    \n    \n    // Don\'t update if paused\n    if (!paused && gameState === State.GAME) {\n        update();\n        if (fastForward) {\n            update();\n            update(); // update x3 if in fast forward mode\n        }\n        // update() has an internal step counter called updateStep. Don\'t use frameCount or debugStep.\n    }\n    \n    transitionStates();\n    \n    \n    if(paused) {\n        textSize(100);\n        fill(255, 0, 0);\n        text(\"Paused\", 30, 230);\n    }\n    \n    drawHelp();\n    \n    if (invertColors) {\n        filter(INVERT);\n    }\n}; \n ";
window.liveEditor = new LiveEditor({
                el: $("#sample-live-editor"),
                code: code,
                width: 400,
                height: 400,
                editorHeight: "80%",
                autoFocus: true,
                workersDir: "../../build/workers/",
                externalsDir: "../../build/external/",
                imagesDir: "../../build/images/",
                soundsDir: "../../sounds/",
                execFile: outputUrl,
                jshintFile: "../../build/external/jshint/jshint.js",
                newErrorExperience: true,
            });
            liveEditor.editor.on("change", function() {
                window.localStorage["test-code"] = liveEditor.editor.text();
            });
            ScratchpadAutosuggest.init(liveEditor.editor.editor);
            </script>
        </body>
        </html>
        