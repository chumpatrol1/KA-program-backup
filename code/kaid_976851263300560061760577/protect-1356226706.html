<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Protect!</title>
    <link rel="stylesheet" href="../../build/css/live-editor.core_deps.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.audio.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.tooltips.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.ui.css"/>
<style>
        body {
            padding: 20px;
        }
        h1 {
            padding: 0;
            margin: 0 0 20px 0;
        }
        #sample-live-editor {
            padding: 0;
        }
    </style>
</head>
<body>
    <h1>Protect!</h1>
    <div id="sample-live-editor"></div>
    <script src="../../build/js/live-editor.core_deps.js"></script>
    <script src="../../build/js/live-editor.editor_ace_deps.js"></script>
    <script src="../../build/js/live-editor.audio.js"></script>
    <script src="../../build/js/live-editor.shared.js"></script>
    <script src="../../build/js/live-editor.tooltips.js"></script>
    <script src="../../build/js/live-editor.ui.js"></script>
    <script src="../../build/js/live-editor.editor_ace.js"></script>
    <script>
    var outputUrl = "../output.html";
var code = "/**Protect! by David Elijah de Siqueira Campos McLaughlin\nOriginal size(400, 400);\nOriginally Created on 2013-02-06T22:05:28Z by kaid_976851263300560061760577\nLast Edited: 2013-02-06T22:05:28Z\nVotes/Spinoffs: 0/0\nOriginally Created: 2013-02-06T22:10:15Z from origin 1355147256 with similarity of 0.9999064137758922\nOriginal Link: https://www.khanacademy.org/computer-programming/protect/1356226706\nRetrieved On: 07-Nov-2022 (17:08:00.120786)**/\
";

code = code + "\nframeRate(100);\nnoStroke();\n//==============================================================\n// Missile Commander\n// Â© 2013 dnacalkins\n// for educational purposes at Khan Academy\n//==============================================================\n/***********************************************************\n * Use the mouse to shoot rockets at the incoming barrage\n * of bombs.  Defend your cities at ALL COSTS!\n ************************************************************/ \n//####################################################\n// A.   GAME PARAMETERS\n//####################################################\n\nvar EXP_SIZE   = 100;        // full size of explosions\nvar EXP_DELAY  = 1;        // frames at full size\nvar LOW_LIMIT  = 320;       // screen low limit for plr rockets\nvar MSL_RATE   = 0.1;       // enemy speed increase per level\nvar CITY_BONUS = 3000;     // points needed for extra cities\n\n\n\n//####################################################\n// B.   GAME VARIABLES\n//####################################################\n\nvar actors     = [];        // current objects\nvar ammo       = [];        // silo ammo count\nvar altitude   = [];        // plane altitudes\nvar bombs      = [];        // current explosions\nvar cities     = [];        // city flags / bonus[6]\nvar mslAttack  = [];        // missile split (Y) points\nvar plnAttack  = [];        // plane attack (X) points\nvar scene      = [];        // active objects\n\nvar bonus      = 0;         // point multiplier\nvar climb      = 0;         // bonus increase\nvar clips      = 100000;         // reserve ammo\nvar clock      = 0;         // game clock\nvar extra      =12500;         // target points for new city\nvar goal       = 0;         // working var for City Bonus\nvar level      = 0;         // wave level\nvar missiles   = 0;         // wave missile count\nvar paused     = 0;         // current wait state\nvar planes     = 0;         // wave plane count\nvar rate       = 0;         // current missile delay\nvar score      = 0;         // game score\nvar ships      = 10;         // wave ship count\nvar slew       = 0;         // dampens speed increase\nvar state      = 0;         // current game state\n\n// color control\nvar clr={sky:0, gnd:1, city:2, msl:3, pln:4, shp:5, txt:6};\n\n// enumerations State, Role, Points\nvar sta={info:0, ready:1, play:3, bonus:4, pause:5, end:6}; \nvar rol={plr:0, msl:1, pln:2, shp:3, exp:4};\nvar pts={amo:5, msl:25, pln:50, shp:150, cty:100}; \n\n\n\n//####################################################\n// C.   DRAWING ROUTINES\n//####################################################\n \n\n\nvar drawGround = function(){\n   noStroke();\n   fill(clr.sky);\n   rect(0, 0, 400, 360);\n   fill(255, 255, 255, 30);\n   rect(0, LOW_LIMIT, 400, 401-LOW_LIMIT);\n   fill(clr.gnd);\n   rect(0, 340, 400, 60);\n   rect(0, 330, 20, 10);\n   rect(380, 330, 20, 10);\n   triangle(20, 330, 20, 340, 30, 340);\n   triangle(380, 330, 380, 340, 370, 340);\n};\n\n\nvar drawCities = function(){\n   var i, x;\n   fill(clr.city);\n   noStroke();\n   for (i=1; i<5; i++){\n      if (cities[i]>0){\n         x=i*90-48;\n         rect(x, 340, 48, 4);\n         rect(x, 336, 44, 4); x+=4;\n         rect(x, 332, 4, 4);  x+=4;\n\n         rect(x, 324, 4, 12);  x+=8;\n         rect(x, 328, 4, 8);  x+=8;\n         rect(x, 328, 4, 8);  x+=4;\n         rect(x, 332, 4, 4);  x+=8;\n         rect(x, 332, 4, 4); \n\n      }\n   }\n};\n \nvar drawAmmo = function(){\n   var i, x, y, z;\n   fill(clr.city);\n   noStroke();\n   if ((ammo[0]>0) && (cities[0]>0)){\n      x=0; y=1;\n      for (z=0; z<ammo[0]; z++){\n         rect(x*14+8, y*14+312, 4, 10);\n         rect(x*14+4, y*14+320, 4, 4);         \n         rect(x*14+12, y*14+320, 4, 4);         \n         x+=1;\n         if(x===y){x=0; y+=1;}\n      }\n   }\n   if ((ammo[1]>0) && (cities[5]>0)){\n      x=0; y=1;\n      for (z=0; z<ammo[1]; z++){\n         rect(388-x*14, y*14+312, 4, 10);\n         rect(384-x*14, y*14+320, 4, 4);         \n         rect(392-x*14, y*14+320, 4, 4);         \n         x+=1;\n         if(x===y){x=0; y+=1;}\n      }\n   }\n    if (clips>0){\n      x=205-(clips*10);\n      for (i=0; i<clips; i++){   \n         rect(x, 358, 12, 8);\n         x+=20;\n      }\n   }\n};\n\n\nvar drawScore = function(){\n  textSize(28);\n  fill(clr.txt);\n  textAlign(CENTER, BOTTOM);\n  text(score, 200, 400);\n  text(score, 201, 400);\n};\n\n\nvar drawPlaneA = function(x,y, dir){\n// draws the airplane (left and right)\n    var dr=[ [-8, -16, 4],\n             [-4, -12, 8],\n             [0, -8, 8],\n             [-16, -8, 4],\n             [-16, -4, 32],\n             [0, 0, 8],\n             [-4, 4, 8],\n             [-8, 8, 8],\n             [-12, 12, 4]\n           ], \n        dl=[ [4, -16, 4],\n             [-4, -12, 8],\n             [-8, -8, 8],\n             [12, -8, 4],\n             [-16, -4, 32],\n             [-8, 0, 8],\n             [-4, 4, 8],\n             [0, 8, 8],\n             [8, 12, 4]\n          ], i, d;\n   d=dr;\n   if (dir!==0){d=dl;}\n   fill(clr.pln);\n   noStroke();\n   for (i=0; i<9; i++){\n      rect(x+d[i][0], y+d[i][1], d[i][2], 4);\n   }\n};\n\n\nvar drawPlaneB = function(x,y){\n// draws the space ship (left and right are the same)\n   var i, xx;\n   fill(clr.pln);\n   noStroke();\n   xx=-16;\n   for (i=0; i<8; i++){\n      rect(x+xx, y+xx, 4, 4);\n      rect(x+xx, y-4-xx, 4, 4);\n      xx+=4;\n   }\n   rect(x-4, y-12, 8, 24);\n   rect(x-12, y-4, 24, 8);\n};\n\n\nvar drawShip = function(x,y){\n// draws the smart ship\n   fill(clr.shp);\n   stroke(255);\n   strokeWeight(1);\n   triangle(x-6, y-7, x+6, y-7, x, y+3);\n}; \n\n\nvar drawWorld = function(){\n// combines all fixed-location items into one function.\n   drawGround();\n   drawCities();\n   drawAmmo();\n   drawScore();\n};\n\nvar titleScreen = function(){\n\n   drawGround();\n   textAlign(CENTER, BOTTOM);\n   textSize(48);\n   fill(255);\n   text(\"MISSILE\\nCOMMANDER\", 199, 200);\n   text(\"MISSILE\\nCOMMANDER\", 200, 200);\n   text(\"MISSILE\\nCOMMANDER\", 201, 200);\n   textSize(12);\n   text(\"CLICK TO BEGIN\", 200, 300);\n};\n\n\n\nvar updateScreen = function(){\n// draws the eintire screen in its current configuration\n   var flash=[0xFFC6C6C6, 0xFFFFB868, 0xFFF0A8F0, 0xFFB8A8FF,\n              0xFF80B8FF, 0xFF88E0D8, 0xFFA8E040, 0xFFE8D010];\n   var a, act;\n\n   drawWorld();\n   if (actors.length > 0){\n\n      for (a=0; a<actors.length; a++){\n\n         act=actors[a];\n\n         switch (act.role){\n         case rol.exp:\n            // draw explosions\n            stroke(0);\n            strokeWeight(1);\n            fill(flash[clock%8]);\n            ellipse(act.x, act.y, act.rad, act.rad);\n            break;\n\n         case rol.shp:\n            drawShip(act.x, act.y);\n            break;\n\n         case rol.pln:\n            if (act.typ!==0){\n               drawPlaneA(act.x, act.y, act.dir);\n            } else {\n               drawPlaneB(act.x, act.y);\n            }\n            break;\n\n         case rol.msl:\n            strokeWeight(3);\n            stroke(clr.msl);\n            line(act.sx, act.sy, act.x, act.y);\n            if (act.attack && ((clock % 12) === 0)){\n               noStroke();\n               fill(flash[clock % 4]);\n               rect(act.x-1, act.y-1, 3, 3);\n            }\n            break;\n\n         case rol.plr:\n            strokeWeight(3);\n            stroke(clr.city);\n            line(act.sx, act.sy, act.x, act.y);\n            point(act.tx, act.ty);\n            break;\n         }\n      }\n   }\n};\n\n\n\n//####################################################\n// D.   HELPER ROUTINES\n//####################################################\n\n\n\nvar hasTargets = function(){\n  // indicates if player has any targets left to hit\n  return ((cities[0]+cities[1]+cities[2]+\n          cities[3]+cities[4]+cities[5]) > 0);\n};\n\n\nvar hasCities = function(){\n  // indicates if player has any cities left to defend\n  return ((cities[1]+cities[2]+cities[3]+\n          cities[4]+cities[6]) > 0);\n};\n\n\nvar sortRoles = function(a, b){\n// descending sort functions (for scene.sort in animateActors())\n   return b.role-a.role;\n};\n\n\nvar addPoints = function(p){\n   score += p * bonus;\n   if (score >= extra){\n      if ((level % 10)===0){\n         goal += CITY_BONUS;\n      } \n      extra += goal;\n      if (state===sta.play){\n         cities[6] += 1;\n      } else {\n         scene[6] += 1;\n      }\n      \n   }\n};\n\n\nvar acquireTarget = function(){\n   var tgt=[15, 66, 156, 246, 336, 385];\n   var i=0, r=0, t=0;\n\n   // pick one (somewhat randomly)\n   t = floor(random(0, 6));\n   while (cities[t] === 0){\n      r = floor(random(2, 5));\n      for (i=0; i<r; i++){\n         t = (t + 1) % 6;\n      }\n   }\n   // return screen positions for ammo\n   if ((t===0) || (t===5)){\n      return {tx:tgt[t], ty:340, tgt:t};\n   }\n   // return screen positions for cities\n   return {tx:tgt[t], ty:325, tgt:t};\n};\n\n\nvar launchPlaneAttack = function(x){\n// determines if planes launch multiple strikes\n   var m = floor((50 - level) / 15);\n   var lch = ((floor(random(0, 100))%m) === 0);\n   \n   if (lch && hasTargets()){\n      for (var i=0; i<plnAttack.length; i++){\n         if (x === plnAttack[i]){return true;}\n      }\n   }\n   return false;\n};\n\n\nvar launchMissileAttack = function(y){\n// determines if missiles split into multiple strikes\n   var m = floor((40 - level) / 9);\n   var lch = ((floor(random(0, 100))%m) === 0);\n   \n   if (lch && hasTargets()){\n      for (var i=0; i<mslAttack.length; i++){\n         if (y === mslAttack[i]){return true;}\n      }\n   }\n   return false;\n};\n\n\nvar cullActors = function(){\n// removes killed actors\n   var done = (clips===0) && (hasTargets() === false);\n   var a, act;\n   if (actors.length>0){\n      for (a=actors.length-1; a>=0; a--){\n         act = actors[a];\n         if (act.kill){\n            // restore ammo from clips\n            if (act.role === rol.exp){\n               if ((act.strike===0) || (act.strike===5)){\n                  if (clips > 0){\n                     clips-=1;\n                     ammo[act.strike%2] = 6;\n                     cities[act.strike] = 1;\n                  }\n               }\n            }\n            // remove actor from list\n            actors.splice(a, 1);\n         } else if (done && (act.start > clock)){\n            actors.splice(a, 1);\n         }\n      }\n   }\n};\n\n\nvar nearExplosion = function(x, y, d){\n   var e, dst;\n   if (bombs.length>0){\n      for (e=0; e<bombs.length; e++){\n         dst = dist(x, y, bombs[e].x, bombs[e].y) -\n               (bombs[e].rad/2);\n         if (dst < d) {return true;}\n      }   \n   }\n   return false;\n};\n\n\nvar closestExplosion = function(x, y){\n   var e, dst, bls = {dx:1, dy:1, dst:100};\n\n   if (bombs.length>0){\n      for (e=0; e<bombs.length; e++){\n         dst = dist(x, y, bombs[e].x, bombs[e].y) - (bombs[e].rad/2);\n         if (dst < bls.dst) {\n            bls.dst = dst;\n            bls.dx = (x>bombs[e].x) ? 1 : -1;\n            bls.dy = (y>bombs[e].y) ? 1 : -1;\n         }\n      }   \n   }\n   return bls;\n};\n\n\n\n//####################################################\n// E.   CASTING ROUTINES\n//####################################################\n\n\n\nvar actor = function(){\n   return {\n           role:0,         // identifies actor task\n           sx:0,           // screen start X value \n           sy:0,           // screen start Y value\n           tx:0,           // screen target X value\n           ty:0,           // screen target Y value\n           cue:0,          // game clock modulus\n           step:0,         // current activity mark\n           mark:0,         // final step value\n           start:clock,    // game clock start time\n           kill:false      // remove from guild flag\n          };\n};\n\n\nvar addExplosion = function(x,y,t){\n   var exp     = actor();   // get base object\n   exp.role    = rol.exp;   // set task\n   exp.cue     = 1;         // set timing\n   exp.strike  = t;         // city target value\n   exp.rad     = 0;         // explosion radius\n   exp.x       = x;         // screen X position\n   exp.y       = y;         // screen Y position\n   actors.push(exp);        // save to guild\n};\n\n\nvar addPlane = function(s){\n   var y = altitude[floor(random(0, altitude.length))];\n\n   var pln     = actor();   // get base object\n   pln.role    = rol.pln;   // set task\n   pln.cue     = 1;         // set timing   \n   pln.start   = s;         // set start time\n   pln.mark    = floor(400 * rate);    // set stop value\n   pln.typ     = floor(random(-1, 1)); // set type (plane/ship)\n   pln.sy      = y;         // set screen Y positions\n   pln.ty      = y;         \n   pln.dir     = floor(random(0, 2));  // set direction\n   if (pln.dir===0){        // set screen X positions\n      // flies left to right\n      pln.sx=-40;\n      pln.tx=440;\n   } else {\n      // flies right to left\n      pln.sx=440;\n      pln.tx=-40;\n   }\n   pln.x       = pln.sx;    // set current screen X position\n   pln.y       = pln.sy;    // set current screen Y position\n   actors.push(pln);        // save to guild\n};\n\nvar addMissile = function(x, y, s, a){\n   var tgt = acquireTarget();\n   var dst = dist(x, y, tgt.tx, tgt.ty);\n\n   var msl     = actor();   // get base object       \n   msl.role    = rol.msl;   // set task\n   msl.cue     = 2;         // set timing\n   msl.start   = clock + s; // set start time\n   msl.attack  = a;         // set multi missile mode (T/F)\n   msl.strike  = tgt.tgt;   // set city value (0-6)\n   msl.mark    = floor(dst * rate); // set stop value\n   msl.sx      = x;         // set screen start positions\n   msl.sy      = y;\n   msl.x       = x;\n   msl.y       = y;\n   msl.tx      = tgt.tx;    // set screen target positions\n   msl.ty      = tgt.ty;\n   actors.push(msl);        // save to guild\n};\n\nvar addRocket = function(x, tx, ty){\n   var y=330, dst=dist(x,y, tx, ty);\n\n   var msl     = actor();   // get base object\n   msl.role    = rol.plr;   // set task\n   msl.cue     = 1;         // set timing\n   msl.start   = clock;     // set start time\n   msl.mark    = floor(dst * 0.2);  // set stop value\n   msl.sx      = x;         // set screen positions\n   msl.sy      = y;\n   msl.x       = x;\n   msl.y       = y;\n   msl.tx      = tx;\n   msl.ty      = ty;\n   actors.push(msl);        // save to guild \n};\n\nvar addShip = function(x, y, s){\n   var tgt = acquireTarget();\n   \n   var shp     = actor();   // get base object\n   shp.role    = rol.shp;\n   shp.cue     = 2;\n   shp.start   = s;\n   shp.strike  = tgt.tgt;\n   shp.x       = x;\n   shp.y       = y;\n   shp.tx      = tgt.tx;\n   shp.ty      = tgt.ty;\n   actors.push(shp);\n};\n\n//####################################################\n// F.   GAME MECHANICS\n//####################################################\n\n\nvar movExplosion = function(act){\n   var ang = 91;\n   var sml = 80 + EXP_DELAY;\n   if (act.step > (sml+280)){\n      act.kill=true;\n   } else {\n      if (act.step<80){\n         ang = map(act.step, 0, 80, 0, 90);\n      }\n\n      if ((act.step === 81) && (act.strike >=0)){\n         cities[act.strike]=0;\n         if ((act.strike === 0) || (act.strike===5)){ \n            ammo[act.strike % 2]=0;\n         }\n      }\n      \n      if (act.step>sml){\n         ang = map(act.step, sml, sml+280, 90, 185);\n      }\n      act.rad = EXP_SIZE * sin(ang);\n   }\n};\n\nvar movPlane = function(act){\n   var r;\n\n   if (act.step === act.mark){\n      act.kill=true;\n   } else {\n      act.x = map(act.step, 0, act.mark, act.sx, act.tx)|0;   \n      act.y = map(act.step, 0, act.mark, act.sy, act.ty)|0;\n      if (nearExplosion(act.x, act.y, 14)){\n         act.kill=true;\n         addExplosion(act.x, act.y, -1);\n         addPoints(pts.pln);\n      } else if (launchPlaneAttack(act.x)){\n         if (level < 6){\n            r = floor(random(1, 3));\n         } else {\n            r = floor(random(2, 6));\n         }\n         while (r>0){\n           addMissile(act.x, act.y+15, 0, ((r % 2) === 0));\n           r-=1;\n         }\n      }\n   }   \n\n};\n\n\nvar movMissile = function(act){\n   var r, b;\n   if (act.step === act.mark){\n      act.kill=true;\n      addExplosion(act.x, act.y, act.strike);\n   } else {\n      act.x = map(act.step, 0, act.mark, act.sx, act.tx);   \n      act.y = map(act.step, 0, act.mark, act.sy, act.ty);\n      if (nearExplosion(act.x, act.y, -1)){\n         act.kill=true;\n         addExplosion(act.x, act.y, -1);\n         if (act.y < LOW_LIMIT) {addPoints(pts.msl);}\n      } else if (act.attack && launchMissileAttack(act.y|0)){\n         if (level < 11){\n            r = floor(random(2, 4));\n         } else {\n            r = floor(random(3, 6));\n         }\n         while (r>0){\n            b=(floor(random(0, 20))===11);\n            addMissile(act.x, act.y+1, 0, b);\n            r-=1;\n         }\n         act.kill = true;\n      }    \n   }\n};\n\n\nvar movRocket = function(act){\n   if (act.step === act.mark){\n      act.kill=true;\n      addExplosion(act.x, act.y, -1);\n   } else {\n      act.x = map(act.step, 0, act.mark, act.sx, act.tx);   \n      act.y = map(act.step, 0, act.mark, act.sy, act.ty);\n   }\n};\n\n\nvar movShip = function(act){\n   var tgt, blast = closestExplosion(act.x, act.y);\n   \n   if (act.y >= act.ty){\n      // attack city\n      act.kill = true;\n      if (abs(act.tx - act.x) < 5){\n         addExplosion(act.x, act.y, act.strike);\n      } else {\n         // near miss\n         addExplosion(act.x, act.y, -1);\n      }\n   } else if (nearExplosion(act.x, act.y, 5)){\n      // blown away\n      act.kill = true;\n      addExplosion(act.x, act.y, -1);\n      if (act.y < LOW_LIMIT){\n         addPoints(pts.shp);\n      }\n   } else {\n      // calc move\n      if (cities[act.strike] === 0){\n         if (hasTargets() && (act.y < 250)){\n            tgt = acquireTarget();\n            act.strike = tgt.tgt;\n            act.tx = tgt.tx;\n         }\n      }\n      act.sy = (3 - rate) / 2;\n      act.sx = 0;\n      if ((act.tx + 3) < act.x){\n         act.sx = -act.sy * 0.8; \n      } else if ((act.tx - 3) > act.x){\n         act.sx = act.sy * 0.8; \n      }\n\n      if (blast.dst < 12){\n         act.sx = act.sy * blast.dx;\n         act.sy = act.sy * blast.dy;\n      } else if (blast.dst < 15){\n         act.sx = act.sy * blast.dx / 2;\n      } else if (blast.dst < 19){\n         act.sx = act.sy * blast.dx / 4;\n      }\n      act.x += act.sx;\n      act.y += act.sy;\n   }\n};\n\n\n\nvar fireRocket = function(idx){\n   var xx=[10, 390];\n   if (ammo[idx]>0){\n      ammo[idx]-=1;\n      addRocket(xx[idx], mouseX, mouseY);      \n   } else if (ammo[1-idx]>0){\n      idx = 1 - idx;\n      ammo[idx]-=1;\n      addRocket(xx[idx], mouseX, mouseY);      \n   } else {idx=-1;}\n\n   if (idx>=0){\n      if (ammo[idx]===0){\n         if (clips>0){\n            clips-=1;\n            ammo[idx]+=6;\n         }\n      }\n   }\n};\n\n\nvar makeWaves = function(){\n   var a, r, x, y, enemy, wav=[];\n\n   if (level < 3){\n      wav=[0, 800];\n   } else if (level < 7){\n      wav=[0, 700];\n   } else if (level < 12){\n      wav=[0, 600, 1200];\n   } else if (level < 18){\n      wav=[0, 800, 1500, 2200];\n   } else if (level < 25){\n      wav=[0, 900, 1500, 2100];\n   } else {\n      wav=[0, 600, 1200, 1800, 2400];\n   }\n\n   enemy = missiles;\n   while (enemy>0){\n      r = floor(random(0, wav.length));\n      y = (floor(random(0, 3)) * 20)+5;\n      x = floor(random(10, 390));\n      addMissile(x, -y, wav[r], ((enemy % 3) === 0));\n      enemy -= 1;\n   }\n\n   enemy = ships;\n   while (enemy>0){\n      r = floor(random(0, wav.length));\n      if ((r+1)<wav.length){\n          y = floor(random(1, 8)) * 75;\n      } else {\n          y = floor(random(1, 4)) * 50;\n      }\n      x = floor(random(10, 390));\n      addShip(x, -y, wav[r]);\n      enemy -= 1;\n   }\n};\n\n\nvar initLevel = function(){\n   var gameColors= [0xFF000000,  // 0 black  \n                    0xFF802030,  // 1 red\n                    0xFF286000,  // 2 green\n                    0xFF1040D8,  // 3 dk blue\n                    0xFFFFC800,  // 4 yellow\n                    0xFF90A000,  // 5 olive\n                    0xFFB060C0,  // 6 violet\n                    0xFFE0A800,  // 7 dk yellow\n                    0xFF4880FF,  // 8 lt blue\n                    0xFFE0E0E0,  // 9 dk white\n                    0xFFFFFFFF]; // 10 white\n\n\n   var schemes = [ [ 0, 4, 3, 1, 2, 6,  0 ],   // normal levels\n                   [ 0, 4, 3, 2, 1, 6,  0 ],\n                   [ 0, 3, 5, 1, 6, 6, 10 ],\n                   [ 0, 3, 5, 6, 1, 6, 10 ],\n                   [ 0, 1, 8, 7, 2, 6, 10 ],\n                   [ 0, 1, 8, 2, 7, 6, 10 ],\n                   [ 3, 4, 0, 1, 6, 6,  0 ],   // bonus levels\n                   [ 3, 4, 0, 6, 1, 6,  0 ],\n                   [ 6, 4, 0, 1, 9, 9,  0 ],\n                   [ 6, 4, 0, 9, 1, 9,  0 ],\n                   [ 9, 0, 7, 1, 2, 6, 10 ],\n                   [ 9, 0, 7, 2, 1, 6, 10 ] ];\n   var lvl, pln;\n\n   clock=0;\n\n   // color scheme\n   var sch=floor(level/5)+5;\n   if (((level%5) > 0)||(bonus===0)){sch=level%5;} \n   clr.sky=gameColors[schemes[sch][0]];\n   clr.gnd=gameColors[schemes[sch][1]];\n   clr.city=gameColors[schemes[sch][2]];\n   clr.msl=gameColors[schemes[sch][3]];\n   clr.pln=gameColors[schemes[sch][4]];\n   clr.shp=gameColors[schemes[sch][5]];\n   clr.txt=gameColors[schemes[sch][6]];\n\n   if (bonus<1){\n      climb=1;\n   } else {\n      climb += 0.5;\n   }\n   if (bonus<10){bonus = floor(climb);}\n\n   // ammo\n   ammo[0] = 6;\n   ammo[1] = 6;\n   cities[0] = 1;\n   cities[5] = 1;\n   clips = 1 + floor(level/5);\n\n   // attack levels \n   switch (level){\n   case 0:  // (initializing)\n      altitude=[60, 120, 180];        // plane Y \n      plnAttack=[100, 150, 250, 300]; // plane X \n      mslAttack=[100, 200];           // msl Y\n      break; \n   case 5:\n      altitude=[80, 140, 200];\n      break;\n   case 9:\n      plnAttack=[50, 200, 350];\n      break;\n   case 14:\n      mslAttack=[100, 150, 200]; \n      altitude=[80, 140];\n      break;\n   case 25:\n      altitude=[120, 180]; \n      plnAttack=[100, 150, 250, 300];\n      break;\n   }\n\n\n   // enemy missile speed increase\n   if (rate > 0.25){\n      if (rate < 1.5){\n         if (slew > 0.003){slew *= 0.94;}\n      }\n      rate-= slew;\n   }\n\n   // enemies\n   missiles = 4 + floor(level / 3);\n   ships = floor(random(0, 3));\n   missiles += floor(random(level, level+level));\n   if (level>9){\n       missiles += floor(random(1, level/2));\n   }\n   if (level>24){\n      while (missiles>((clips*6)+12)){\n         missiles-=20;\n         ships+=1;\n      }\n   } else if (level>14){\n      while (missiles>((clips*6)+8)){\n         missiles-=15;\n         ships+=1;\n      }\n   } else {\n      while (missiles>((clips*5)+8)){\n         missiles-=10;\n         ships+=1;\n      }\n   }\n   // don\'t show too soon\n   if (level<5){ships=0;}\n   // bonus for getting this far\n   if (level>20){ships = floor(ships/2);}\n\n   makeWaves();\n\n   planes = floor(missiles/10 + (random(0, 3)));\n   pln = planes;\n   lvl = 5 - floor(level/7);\n   if (level<5){lvl+=3;}\n   if (level<15){lvl+=1;}\n   sch=floor(random(0, 6)) * 50;\n\n   while (pln>0){\n      addPlane(sch);\n      sch+=(70*lvl) + (floor(random(1, 4)) * 100);\n      pln-=1;\n   }\n\n//pln = clips*6 + 12;\n//println(\"LVL=\" + level + \"  RAT=\" + rate.toFixed(3) + \"  AMO=\"+ pln + \"  MSL=\" + missiles + \"  PLN=\" + planes + \"  SHP=\" + ships);\n\n\n};\n\n\n\nvar animateActors = function(){\n   var a, t;\n   if (actors.length > 0){\n      scene = [];\n      bombs=[];\n      // determine if its time to act\n      for (a=0; a<actors.length; a++){\n         if (clock > actors[a].start){\n            t = clock - actors[a].start;\n            if ((t % actors[a].cue) === 0){\n               actors[a].step+=1;\n               scene.push(actors[a]);\n            }\n         }\n         // save current explosions for testing\n         if (actors[a].role===rol.exp){bombs.push(actors[a]);}\n      }\n\n// rol={plr:0, msl:1, pln:2, shp:3, exp:4};\n\n      // direct scene (those that need to act)\n      if (scene.length > 0){\n         scene.sort(sortRoles);\n         for (a=0; a<scene.length; a++){\n            switch (scene[a].role){\n            case rol.plr:\n               movRocket(scene[a]);\n               break;\n            case rol.msl:\n               movMissile(scene[a]);\n               break;\n            case rol.pln:\n               movPlane(scene[a]);\n               break;\n            case rol.shp:\n               movShip(scene[a]);\n               break;\n            case rol.exp:\n               movExplosion(scene[a]);\n               break;\n            }\n         }\n         updateScreen();\n         scene = [];\n      }\n   }\n};\n\n\nvar makeReady = function(){\n   if (clock<2){\n      clock=5;\n      drawWorld();\n      textSize(48);\n      textAlign(CENTER, BOTTOM);\n      fill(clr.city);\n      text(bonus + \" X POINTS\", 200, 180);\n   } else if (clock > 150){\n      state = sta.play;\n   }\n};\n\nvar theEnd = function(){\n   var ang, siz, stp=radians(60), red = 0xFF802030; \n   var flash=[0xFFC6C6C6, 0xFFFFB868, 0xFFF0A8F0, 0xFFB8A8FF,\n              0xFF80B8FF, 0xFF88E0D8, 0xFFA8E040, 0xFFE8D010];\n   var rank = [  [  \"You died.\",\n                    \"You were defeated.\",\n                    \"No one survived.\" ],\n                 [  \"You have been captured alive.\",\n                    \"There were many casualties.\",\n                    \"You are declared missing in action.\" ],\n                 [  \"Your friends raised a toast.\",\n                    \"Your funeral was lovely.\",\n                    \"Your picture was in the paper.\" ],\n                 [  \"You gave a heroic effort.\",\n                    \"You gave it your all, but it just wasn\'t enough.\",\n                    \"You almost achieved the impossible.\" ]\n              ];\n\n\n   noStroke();\n   if (clock < 400){\n      background(red);\n      beginShape();\n      fill(flash[clock%8]);\n      for (ang=0; ang<6.2; ang+=stp){\n         vertex(200 + sin(degrees(ang)) * clock, 200 + cos(degrees(ang)) * clock);\n      }\n      endShape();\n   } else if ((clock > 400) && (clock<800)){\n      background(red);\n      beginShape();\n      fill(flash[clock%8]);\n      siz = 800-clock;\n      for (ang=0; ang<6.2; ang+=stp){\n         vertex(200 + sin(degrees(ang)) * siz, 200 + cos(degrees(ang)) * siz);\n      }\n      endShape();\n   } else if (clock < 500) {\n        background(flash[clock%8]);\n   } else {\n        background(red);\n   }\n\n   textAlign(CENTER, BOTTOM);\n   if (clock < 800){\n      textSize(48);\n      fill(red);\n      text(\"THE\\nEND\", 199, 255);\n      text(\"THE\\nEND\", 200, 255);\n      text(\"THE\\nEND\", 201, 255);\n   } else {\n      textSize(12);\n      stp = map(score, 0, 150000, 0, 4)|0;\n      if (stp > 3){stp=3;}\n      siz = floor(random(0, 3));\n      fill(255);\n      text(rank[stp][siz], 200, 300);\n      noLoop();\n   }\n\n};\n\n\n\nvar tallyBonuses = function(){\n\n   var i, x, y;\n   if (scene.length < 1){\n      // save city configuration\n      for (i=0; i<7; i++){\n         scene[i] = cities[i];\n      }\n      bombs = [0, 0];\n   }\n\n   if ((clock % 5) === 0){\n      if (ammo[1]>0){\n         bombs[0] += 1;\n         ammo[1] -= 1;\n         addPoints(pts.amo);\n      } else if (ammo[0]>0){\n         bombs[0] += 1;\n         ammo[0] -= 1;\n         addPoints(pts.amo);\n      } else if (clips > 0){\n         ammo[0] += 6;\n         clips -= 1;\n         if (clips > 0){\n            ammo[1] += 6;\n            clips -= 1;\n         }\n      } else if ((clock % 10) === 0){                        // 50\n         if (cities[1]>0){\n            bombs[1] += 1;\n            cities[1] = 0;\n            addPoints(pts.cty);\n         } else if (cities[2]>0){\n            bombs[1] += 1;\n            cities[2] = 0;\n            addPoints(pts.cty);\n         } else if (cities[3]>0){\n            bombs[1] += 1;\n           cities[3] = 0;\n            addPoints(pts.cty);\n         } else if (cities[4]>0){\n            bombs[1] += 1;\n            cities[4] = 0;\n            addPoints(pts.cty);\n         } else { \n            i = scene[1]+scene[2]+scene[3]+scene[4];\n            if ((i + scene[6]) > 0) {\n               paused=true;\n               fill(255);\n               textAlign(CENTER, BOTTOM);\n               textSize(12);\n               text(\"CLICK ANYWHERE TO CONTINUE\", 200, 300);\n               // add bonus cities\n               if ( (i<4) && (scene[6]>0) ){\n                  i=0;\n                  while (((scene[1]+scene[2]+scene[3]+scene[4]) < 4) && (scene[6] > 0)){\n                     x = floor(random(1, 5));\n                     if (scene[x] === 0){\n                        scene[x] = 1;\n                        cities[x] = 1;\n                        scene[6] -= 1;\n                        i += 1;\n                     }\n                  }\n                  x = 200 - (i * 28);\n                  y = 230;\n                  fill(clr.city);\n                  while (i > 0){\n                     rect(x, y+16, 48, 4);\n                     rect(x, y+12, 44, 4); x+=4;\n                     rect(x, y+8, 4, 4);  x+=4;\n                     rect(x, y, 4, 12); x+=8;\n                     rect(x, y+4, 4, 8);  x+=8;\n                     rect(x, y+4, 4, 8);  x+=4;\n                     rect(x, y+8, 4, 4);  x+=8;\n                     rect(x, y+8, 4, 4); \n                     x += 18;\n                     i -= 1;\n                  }\n                  if(x < 230){\n                     text(\"BONUS CITY ADDED\", 200, 270);\n                  } else {\n                     text(\"BONUS CITIES ADDED\", 200, 270);\n                  }\n               }\n\n            } else {\n               state = sta.end;\n            }\n         }\n      }\n\n      if (!paused){      \n         drawWorld();\n         textAlign(RIGHT, BOTTOM);\n         textSize(24);\n         noStroke();\n         fill(clr.city);\n         y=120;\n         if (bombs[0] > 0){\n            text(bombs[0] * bonus * pts.amo + \" =\", 120, y+18);\n            x = 130;\n            for (i=0; i<bombs[0]; i++){\n               rect(x, y, 4, 10);\n               rect(x-4, y+8, 4, 4);         \n               rect(x+4, y+8, 4, 4);         \n               x += 14;\n               if (x > 340){x= 130; y += 16;}\n            }\n         }\n         y += 40;\n         if (bombs[1] > 0){  \n            text(bombs[1] * bonus * pts.cty + \" =\", 120, y+24);\n            x = 130;\n            for (i=0; i<bombs[1]; i++){\n               rect(x, y+16, 48, 4);\n               rect(x, y+12, 44, 4); x+=4;\n               rect(x, y+8, 4, 4);  x+=4;\n               rect(x, y, 4, 12); x+=8;\n               rect(x, y+4, 4, 8);  x+=8;\n               rect(x, y+4, 4, 8);  x+=4;\n               rect(x, y+8, 4, 4);  x+=8;\n               rect(x, y+8, 4, 4); \n               x += 18;\n            }\n         }\n      }                \n   }\n};\n\n//####################################################\n// G.   SCHEDULED EVENTS\n//####################################################\n\n\n\nvar mousePressed = function(){\n\n\n   if (state === sta.play){\n      if (mouseY<=LOW_LIMIT){\n         if (mouseButton === LEFT){ fireRocket(0);}\n         if (mouseButton === RIGHT){ fireRocket(1);}\n      }\n   }\n   if (state === sta.bonus){\n      if (paused) {\n         paused=false;\n         state=sta.ready;\n         level +=1;\n         // restore cities\n         for (var i=0; i<7; i++){\n            cities[i] = scene[i];\n         }\n         if (!hasCities()){\n            clock=0;\n            state = sta.end;\n         } else {\n           initLevel();\n           if (level===34){\n               clock=0;\n               state=sta.end;\n           }\n         }\n      }\n   }\n   if (state === sta.info){\n      clock=0;\n      paused=true;\n      state = sta.ready;\n   }\n};\n\n\n\n\nvar draw = function(){\n\n// sta={info:0, ready:1, play:3, bonus:4, pause;5, end:6}; \n   clock += 1;\n   switch (state){\n   case sta.play:\n      animateActors();  \n      break;\n   case sta.bonus:\n      tallyBonuses();\n      break;\n   case sta.ready:\n      makeReady();\n      break;\n   case sta.end:\n      theEnd();      \n      break;\n   case sta.pause:\n      break;\n   case sta.info:\n      break;\n   }\n\n   cullActors();\n\n   if (actors.length===0){\n      if (state===sta.play){\n         paused=false;\n         state=sta.bonus;\n         bombs=[];\n         scene=[];\n         clock=0;\n      }\n   }\n\n\n};\n\n\n\n//####################################################\n// H.   PROGRAM ENTRY POINT\n//####################################################\n\ncities = [1,1,1,1,1,1,0];\nextra = CITY_BONUS;\ngoal = CITY_BONUS;\nrate = 1;\nslew = MSL_RATE;\nstate = sta.info;\ninitLevel();\ntitleScreen();";
window.liveEditor = new LiveEditor({
                el: $("#sample-live-editor"),
                code: code,
                width: 400,
                height: 400,
                editorHeight: "80%",
                autoFocus: true,
                workersDir: "../../build/workers/",
                externalsDir: "../../build/external/",
                imagesDir: "../../build/images/",
                soundsDir: "../../sounds/",
                execFile: outputUrl,
                jshintFile: "../../build/external/jshint/jshint.js",
                newErrorExperience: true,
            });
            liveEditor.editor.on("change", function() {
                window.localStorage["test-code"] = liveEditor.editor.text();
            });
            ScratchpadAutosuggest.init(liveEditor.editor.editor);
            </script>
        </body>
        </html>
        