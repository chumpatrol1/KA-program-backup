<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Physics simulation</title>
    <link rel="stylesheet" href="../../build/css/live-editor.core_deps.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.audio.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.tooltips.css"/>
    <link rel="stylesheet" href="../../build/css/live-editor.ui.css"/>
<style>
        body {
            padding: 20px;
        }
        h1 {
            padding: 0;
            margin: 0 0 20px 0;
        }
        #sample-live-editor {
            padding: 0;
        }
    </style>
</head>
<body>
    <h1>Physics simulation</h1>
    <div id="sample-live-editor"></div>
    <script src="../../build/js/live-editor.core_deps.js"></script>
    <script src="../../build/js/live-editor.editor_ace_deps.js"></script>
    <script src="../../build/js/live-editor.audio.js"></script>
    <script src="../../build/js/live-editor.shared.js"></script>
    <script src="../../build/js/live-editor.tooltips.js"></script>
    <script src="../../build/js/live-editor.ui.js"></script>
    <script src="../../build/js/live-editor.editor_ace.js"></script>
    <script>
    var outputUrl = "../output.html";
var code = "/**Physics simulation by David Elijah de Siqueira Campos McLaughlin\nOriginal size(400, 400);\nOriginally Created on 2013-01-14T13:46:43Z by kaid_976851263300560061760577\nLast Edited: 2013-01-14T13:46:43Z\nVotes/Spinoffs: 1/0\nOriginally Created: 2013-01-14T13:46:43Z from origin 1122503811 with similarity of 1.0\nOriginal Link: https://www.khanacademy.org/computer-programming/physics-simulation/1290911174\nRetrieved On: 07-Nov-2022 (17:07:57.988176)**/\
";

code = code + "\n/*************************************************************\n*  Modelling the atoms of an ionic solid like a salt crystal.\n* \n* Particles have either + or - charge, e.g. Na+ and Cl-\n* Bonds only form between ions of a different charge\n* Atoms of like charge repel one another\n* When cold, atoms form a solid with a lattice structure\n* \n* This solid only melts at high temperature (~6 units).\n* At 6 units, the solid slowly heats up before undergoing a\n* phase transition in which it melts and only then the kinetic\n* energy of atoms quickly increases\n* \n* My previous simulation is more like water\n* http://www.khanacademy.org/cs/melting-solid/1113221512\n* The melting temperature is lower and structure of the solid\n* is different\n* \n* Use the slider to change the temperature of the container\n* See how temperature affects the behaviour of the atoms\n* \n* Pressure = total force of atoms on the walls\n* Kinetic energy = histogram of energies for all atoms\n* \n**********************************************************/\n\n/******************************************************\n * Physical and chemical constants\n*******************************************************/\n\n// Force due to gravity\nvar GRAVITY = 0.008;\n\n// Energy lost when a bond forms\nvar BONDING_ENERGY = 0.998;\n\n// Optimum distance between bonded atoms\nvar BOND_LENGTH = 25;\n\n// Force of interaction between atoms\nvar IONIC_BOND_STRENGTH = 0.1;\nvar HYDROGEN_BOND_STRENGTH = 0.01;\n\n// Maximum extent of an interaction between atoms\nvar BOND_LIMIT = 32;\n\n// How close to the optimum length a bond must be for it to be drawn.\nvar BOND_TOLERANCE = 7;\n\n/******************************************************\n * Simulation variables\n*******************************************************/\n\n// Speed of atoms in the walls\nvar wallTemp = 3.1;\n\nvar numAtoms = 100;\nvar atomSize = 3;\nvar hotColour = color(255, 20, 0);\nvar coolColour = color(80, 120, 255);\n\n// Recorded the pressure on the container\nvar pressure = \"Na\";\nvar cumulativeP = 0;\nvar deltaTime = 30;    // Average pressure of this num of frames\n\n//frameRate(10);\n\n// Atom object with a position, velocity and charge\nvar Atom = function(x, y, r, charge) {\n    this.x = x;\n    this.y = y;\n    this.r = r;\n    this.charge = charge;\n    \n    this.dx = wallTemp * (random() - 0.5);\n    this.dy = wallTemp * (random() - 0.5);\n    \n    // Move atom based on its velocity\n    this.move = function() {\n        this.x += this.dx;\n        this.y += this.dy;\n    };\n    \n    // Calculate the kinetic energy of an atom\n    this.temp = function() {\n        return sqrt(this.dx * this.dx + this.dy * this.dy);\n    };\n    \n    this.colour = function() {\n        // Colour based on heat\n        return lerpColor(coolColour, hotColour, this.temp()/8);\n    };\n    \n    // Bounce off walls\n    this.bounce = function() {\n        var temp = sqrt((this.dx*this.dx)+(this.dy*this.dy));\n        var dtemp = (temp + wallTemp) / (2 * temp) ;\n        if (this.x < this.r) {\n            this.x = this.r;\n            this.dx *= -dtemp;\n            cumulativeP += temp;\n        }\n        if (this.x > 400 - this.r){\n            this.x = 400 - this.r;\n            this.dx *= -dtemp;\n            cumulativeP += temp;\n        }\n        if (this.y < this.r) {\n            this.y = this.r;\n            this.dy *= -dtemp;\n            cumulativeP += temp;\n        }\n        if (this.y > 400 - this.r){\n            this.y = 400 - this.r;\n            this.dy *= -dtemp;\n            cumulativeP += temp;\n        }\n    };\n    \n    this.interact = function(that) {\n        var dx = this.x - that.x;\n        var dy = this.y - that.y;\n        var charge_product = this.charge * that.charge;\n        \n        var dist = sqrt(dx * dx + dy * dy);\n        if (dist < BOND_LIMIT) {\n            var force;\n            if (charge_product === 1) {\n                // Repel\n                force = IONIC_BOND_STRENGTH * (BOND_LIMIT - dist);\n            } else if (charge_product === -1) {\n                // Form an ionic bond\n                force = IONIC_BOND_STRENGTH * (BOND_LENGTH - dist); \n            } else {\n                // Form an hydrogen bond\n                force = HYDROGEN_BOND_STRENGTH * (BOND_LENGTH - dist); \n            }\n\n            var theta = atan2(dy, dx);\n            \n            this.dx = BONDING_ENERGY * (this.dx + force * cos(theta));\n            that.dx = BONDING_ENERGY * (that.dx - force * cos(theta));\n            this.dy = BONDING_ENERGY * (this.dy + force * sin(theta));\n            that.dy = BONDING_ENERGY * (that.dy - force * sin(theta));\n        }\n        \n        // Draw bond\n        stroke(180, 180, 200, 250);\n        if (abs(dist - BOND_LENGTH) < BOND_TOLERANCE) {\n            if (charge_product !== 1) {\n                line(this.x, this.y, that.x, that.y);\n            }\n        }\n    };\n};\n\n// Initialise atoms\nvar atoms = [];\nfor (var a = 0; a < numAtoms; a++) {\n    var r = atomSize;\n    var y = r + round(random() * (400 - 2 * r));\n    var x = r + round(random() * (400 - 2 * r));\n    if (a >= numAtoms/2) {\n        var charge = -1;\n    } else {\n        var charge = 1;\n    }\n    atoms.push(new Atom(x, y, r, charge));\n}\n\n// Add a number of water atoms at the top of the screen\nvar addWaterAtom = function() {\n    var r = atomSize;\n    var x = r + round(random() * (400 - 2 * r));\n    atoms.push(new Atom(x, r+2, r, 0));\n};\n\nvar UIBoxX = 8;\nvar UIBoxY = 8;\nvar UIBoxW = 140;\nvar UIBoxH = 40;\nvar UIBoxX2 = 160;\nvar UIBoxW2 = 75;\nvar UIBoxX3 = 250;\nvar UIBoxW3 = 140;\nvar UIBoxH3 = 80;\n\nvar ballX = UIBoxX + 14 + 7 * round(wallTemp*2);\nvar ballY = UIBoxY + 26;\nvar myFont = createFont(\"Times\", 15);\n\n// Draw a information display box\nvar drawBox = function(x, y, w, h, heading) {\n    noStroke();\n    fill(50, 50, 50, 50);\n    rect(x+2, y+2, w, h, 8);\n    fill(255, 255, 255, 230);\n    rect(x, y, w, h, 8);\n    textFont(myFont, 15);\n    fill(10, 10, 10);\n    text(heading, x+10, y+16);\n};\n\nvar drawHeat = function() {\n    var heading = \"Temperature: \" + round(2 * wallTemp - 0.2) / 2;\n    drawBox(UIBoxX, UIBoxY, UIBoxW, UIBoxH, heading);\n    \n    // Draw slider\n    fill(50, 50, 50, 220);\n    rect(UIBoxX+10, UIBoxY+25, UIBoxW-20, 6, 6);\n    fill(160, 160, 180);\n    stroke(10, 10, 10);\n    ellipse(ballX, UIBoxY+28, 13, 13);\n};\n\n// Calculate average pressure over 30 frames and display it\nvar drawPressure = function() {\n    if (frameCount % deltaTime === 0) {\n        pressure = round(10 * cumulativeP / deltaTime) / 10;\n        cumulativeP = 0;\n    }\n    drawBox(UIBoxX2, UIBoxY, UIBoxW2, UIBoxH, \"Pressure\");\n    textFont(myFont, 13);\n    text(pressure + \" units\", UIBoxX2+12, UIBoxY + 32);\n};\n\nvar drawEnergyBox = function() {\n    var energies = [0,0,0,0,0,0,0,0,0,0];\n    var barWidth = round((UIBoxW3 - 36) / energies.length);\n    var graphHeight = UIBoxH3 - 40;\n    var graphWidth = energies.length* barWidth + 3;\n    var graphX = UIBoxX3 + 0.5 * (UIBoxW3 - graphWidth);\n    var graphY = UIBoxY + UIBoxH3 - 15;\n    var scaleY = graphHeight / numAtoms;\n    \n    // Generate histogram\n    var e;\n    var total_energy = 0;\n    for (var i = 0; i < numAtoms; i++) {\n        var energy = atoms[i].temp();\n        total_energy += energy;\n        e = round(energy - 0.5);\n        if (e > energies.length - 1) {\n            e = energies.length - 1;\n        }\n        energies[e]++;\n    }\n    \n    var title = \"Kinetic Energy: \" + round(10 * total_energy/numAtoms)/10;\n    drawBox(UIBoxX3, UIBoxY, UIBoxW3, UIBoxH3, title);\n    stroke(10, 10, 10);\n    line(graphX, graphY, graphX+graphWidth, graphY);\n    \n    noStroke();\n    for (e = 0; e < energies.length; e++) {\n        fill(lerpColor(coolColour, hotColour, (e+0.5)/10));\n        rect(graphX + 3 + e * barWidth, graphY - scaleY*energies[e],\n             barWidth, scaleY * energies[e]);\n        textSize(10);\n        fill(10, 10, 10);\n        text(e, graphX + 4 + (e - 0.5) * barWidth, graphY + 11);\n    }\n    \n};\n\nvar i, j, atom;\nvar running = true;\n\nvar draw = function() {\n    // Clear everything\n    background(242, 243, 250);\n\n    // Run simulation\n    if (running) {\n        // Calculate interaction\n        for (i = 0; i < atoms.length; i++) {\n            atoms[i].dy += GRAVITY;\n            for (j = i+1; j < atoms.length; j++) {\n                atoms[i].interact(atoms[j]);\n            }\n        }\n\n        for (i = 0; i < atoms.length; i++) {\n            atom = atoms[i];\n            atom.move();\n            atom.bounce();\n        }   \n    }\n    \n    // Draw atoms\n    noStroke();\n    for (i = 0; i < atoms.length; i++) {\n        atom = atoms[i];\n        if (atom.charge === 1) {\n            fill(245, 54, 54);\n        } else if (atom.charge === -1) {\n            fill(10, 89, 18);\n        } else {\n            fill(47, 54, 181);\n        }\n        ellipse(atom.x, atom.y, atom.r*2, atom.r*2);\n    }\n    \n    // Info boxes\n    drawHeat();\n    drawPressure();\n    drawEnergyBox();\n    \n    // Handle mouse events\n    if (mouseIsPressed) {\n        // Drag ball for the temperature UI\n        if (mouseX > UIBoxX+14 && mouseX < UIBoxX + UIBoxW - 14 &&\n            mouseY > UIBoxY+14 && mouseY < UIBoxY + UIBoxH) {\n            var x = round((mouseX - UIBoxX - 14) / 7) / 2;\n            wallTemp = x + 0.1;\n            ballX = x * 14 + UIBoxX + 12;\n        }\n    }\n};\n\nvar keyReleased = function() {\n    //println(keyCode);\n    \n    if (keyCode === 32) {\n        // Spacebar toogles pausing \n        if(running) { running = false; }\n        else { running = true;  }\n    } else if (keyCode === 67) {\n        // \'c\' freezes all the atoms;\n        for (i = 0; i < numAtoms; i++) {\n            atoms[i].dx = 0;\n            atoms[i].dy = 0;\n        }\n    } else if (keyCode === 87) {\n        addWaterAtom();\n    }\n};\n\n// Let go when mouse leaves canvas\nvar mouseOut = function() { mouseIsPressed = false; };";
window.liveEditor = new LiveEditor({
                el: $("#sample-live-editor"),
                code: code,
                width: 400,
                height: 400,
                editorHeight: "80%",
                autoFocus: true,
                workersDir: "../../build/workers/",
                externalsDir: "../../build/external/",
                imagesDir: "../../build/images/",
                soundsDir: "../../sounds/",
                execFile: outputUrl,
                jshintFile: "../../build/external/jshint/jshint.js",
                newErrorExperience: true,
            });
            liveEditor.editor.on("change", function() {
                window.localStorage["test-code"] = liveEditor.editor.text();
            });
            ScratchpadAutosuggest.init(liveEditor.editor.editor);
            </script>
        </body>
        </html>
        